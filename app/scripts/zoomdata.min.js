/*
 * Copyright (C) Zoomdata, Inc. 2012-2014. All rights reserved.
 */
!function(a){function b(){this.items=new Array,this.itemsCount=0,this.put=function(a,b){this.containsKey(a)?this.items[a]=b:(this.items[a]=b,this.itemsCount++)},this.get=function(a){return this.containsKey(a)?this.items[a]:null},this.remove=function(a){if(!this.containsKey(a))throw"key '"+a+"' does not exists.";delete this.items[a],this.itemsCount--},this.containsKey=function(a){return"undefined"!=typeof this.items[a]},this.containsValue=function(a){for(var b in this.items)if(this.items[b]==a)return!0;return!1},this.contains=function(a){return this.containsKey(a)||this.containsValue(a)},this.clear=function(){this.items=new Array,itemsCount=0},this.size=function(){return this.itemsCount},this.isEmpty=function(){return 0==this.size()}}function c(a,b,c){this.dec=a,this.group=b,this.neg=c}function d(){for(var a=0;a<l.length;a++){localeGroup=l[a];for(var b=0;b<localeGroup.length;b++)f.put(localeGroup[b],a)}}function e(a,b){0==f.size()&&d();var e=".",g=",",h="-";0==b&&(-1!=a.indexOf("_")?a=a.split("_")[1].toLowerCase():-1!=a.indexOf("-")&&(a=a.split("-")[1].toLowerCase()));var i=f.get(a);if(i){var j=k[i];j&&(e=j[0],g=j[1])}return new c(e,g,h)}var f=new b,g=["ae","au","ca","cn","eg","gb","hk","il","in","jp","sk","th","tw","us"],h=["at","br","de","dk","es","gr","it","nl","pt","tr","vn"],i=["cz","fi","fr","ru","se","pl"],j=["ch"],k=[[".",","],[",","."],[","," "],[".","'"]],l=[g,h,i,j];a.fn.formatNumber=function(b,c,d){return this.each(function(){null==c&&(c=!0),null==d&&(d=!0);var e;e=new String(a(this).is(":input")?a(this).val():a(this).text());var f=a.formatNumber(e,b);return c&&(a(this).is(":input")?a(this).val(f):a(this).text(f)),d?f:void 0})},a.formatNumber=function(b,c){for(var c=a.extend({},a.fn.formatNumber.defaults,c),d=e(c.locale.toLowerCase(),c.isFullLocale),f=(d.dec,d.group,d.neg,"0#-,."),g="",h=!1,i=0;i<c.format.length;i++)if(-1==f.indexOf(c.format.charAt(i)))g+=c.format.charAt(i);else{if(0!=i||"-"!=c.format.charAt(i))break;h=!0}for(var j="",i=c.format.length-1;i>=0&&-1==f.indexOf(c.format.charAt(i));i--)j=c.format.charAt(i)+j;c.format=c.format.substring(g.length),c.format=c.format.substring(0,c.format.length-j.length);var k=new Number(b);return a._formatNumber(k,c,j,g,h)},a._formatNumber=function(b,c,d,f,g){var c=a.extend({},a.fn.formatNumber.defaults,c),h=e(c.locale.toLowerCase(),c.isFullLocale),i=h.dec,j=h.group,k=h.neg,l=!1;if(isNaN(b)){if(1!=c.nanForceZero)return null;b=0,l=!0}"%"==d&&(b=100*b);var m="";if(c.format.indexOf(".")>-1){var n=i,o=c.format.substring(c.format.lastIndexOf(".")+1);if(1==c.round)b=new Number(b.toFixed(o.length));else{var p=b.toString();p=p.substring(0,p.lastIndexOf(".")+o.length+1),b=new Number(p)}var q=b%1,r=new String(q.toFixed(o.length));r=r.substring(r.lastIndexOf(".")+1);for(var s=0;s<o.length;s++)if("#"==o.charAt(s)&&"0"!=r.charAt(s))n+=r.charAt(s);else if("#"==o.charAt(s)&&"0"==r.charAt(s)){var t=r.substring(s);if(!t.match("[1-9]"))break;n+=r.charAt(s)}else"0"==o.charAt(s)&&(n+=r.charAt(s));m+=n}else b=Math.round(b);var u=Math.floor(b);0>b&&(u=Math.ceil(b));var v="";v=-1==c.format.indexOf(".")?c.format:c.format.substring(0,c.format.indexOf("."));var w="";if(0!=u||"#"!=v.substr(v.length-1)||l){var x=new String(Math.abs(u)),y=9999;-1!=v.lastIndexOf(",")&&(y=v.length-v.lastIndexOf(",")-1);for(var z=0,s=x.length-1;s>-1;s--)w=x.charAt(s)+w,z++,z==y&&0!=s&&(w=j+w,z=0);if(v.length>w.length){var A=v.indexOf("0");if(-1!=A)for(var B=v.length-A,C=v.length-w.length-1;w.length<B;){var D=v.charAt(C);","==D&&(D=j),w=D+w,C--}}}return w||-1===v.indexOf("0",v.length-1)||(w="0"),m=w+m,0>b&&g&&f.length>0?f=k+f:0>b&&(m=k+m),c.decimalSeparatorAlwaysShown||m.lastIndexOf(i)==m.length-1&&(m=m.substring(0,m.length-1)),m=f+m+d},a.fn.parseNumber=function(b,c,d){null==c&&(c=!0),null==d&&(d=!0);var e;e=new String(a(this).is(":input")?a(this).val():a(this).text());var f=a.parseNumber(e,b);return f&&(c&&(a(this).is(":input")?a(this).val(f.toString()):a(this).text(f.toString())),d)?f:void 0},a.parseNumber=function(b,c){for(var c=a.extend({},a.fn.parseNumber.defaults,c),d=e(c.locale.toLowerCase(),c.isFullLocale),f=d.dec,g=d.group,h=d.neg,i="1234567890.-";b.indexOf(g)>-1;)b=b.replace(g,"");b=b.replace(f,".").replace(h,"-");var j="",k=!1;("%"==b.charAt(b.length-1)||1==c.isPercentage)&&(k=!0);for(var l=0;l<b.length;l++)i.indexOf(b.charAt(l))>-1&&(j+=b.charAt(l));var m=new Number(j);if(k){m/=100;var n=j.indexOf(".");if(-1!=n){var o=j.length-n-1;m=m.toFixed(o+2)}else m=m.toFixed(j.length-1)}return m},a.fn.parseNumber.defaults={locale:"us",decimalSeparatorAlwaysShown:!1,isPercentage:!1,isFullLocale:!1},a.fn.formatNumber.defaults={format:"#,###.00",locale:"us",decimalSeparatorAlwaysShown:!1,nanForceZero:!0,round:!0,isFullLocale:!1},Number.prototype.toFixed=function(b){return a._roundNumber(this,b)},a._roundNumber=function(a,b){var c=Math.pow(10,b||0),d=String(Math.round(a*c)/c);if(b>0){var e=d.indexOf(".");for(-1==e?(d+=".",e=0):e=d.length-(e+1);b>e;)d+="0",e++}return d}}(jQuery);var Zoomdata=function(a){"use strict";var b={};return b.Visualizations=b.Visualizations||{},b.MVC=_.clone(a.Backbone),b.eventDispatcher=_.clone(b.MVC.Events),a.Backbone.sync=function(a,c,d){var e=_.result(c,"url"),f=c.remote,g=c.secure,h=c.apiKey;return d||(d={}),d.crossDomain||(d.crossDomain=!0),d.xhrFields||(d.xhrFields={withCredentials:!1}),f&&(d.url=[g?"https://":"http://",f+"/",e].join("")),h&&(d.data=$.extend({},d.data,{key:h})),b.MVC.sync(a,c,d)},b.MVC.View=a.Backbone.View.extend({defaults:{},initialize:function(a){this.childViews=[],this.options=$.extend({},this.defaults,a)},_removeChildViews:function(){_.each(this.childViews,function(a){a?a.remove():null}),this.childViews=[]},popChildView:function(a){var b=this.childViews,c=b.indexOf(a);return-1!==c?b.splice(c,1):null},empty:function(){return this._removeChildViews(),this.$el.children().remove(),this},remove:function(){this._removeChildViews(),Backbone.View.prototype.remove.call(this,arguments)},delegateEvents:function(){Backbone.View.prototype.delegateEvents.apply(this,arguments),_.each(this.childViews,function(a){a&&a.delegateEvents&&a.delegateEvents()})}}),b.MVC.Model=a.Backbone.Model.extend({initialize:function(b,c){c=c||{},this.secure=this.collection?this.collection.secure:null,this.remote=this.collection?this.collection.remote:null,this.apiKey=this.collection?this.collection.apiKey:null,"undefined"!=typeof c.apiKey&&(this.apiKey=c.apiKey,delete c.apiKey),"undefined"!=typeof c.remote&&(this.remote=c.remote,delete c.remote,"undefined"!=typeof c.secure?(this.secure=c.secure,delete c.secure):this.secure=!1),a.Backbone.Model.prototype.initialize.apply(this,arguments)},isBootstrapped:function(){return this._bootstrapped=this._bootstrapped||!1,this._bootstrapped?!0:!1},bootstrap:function(){var a=$.Deferred(),b=this;return this.isBootstrapped()?a.resolve(this.toJSON()):this.fetch().done(function(c){b._bootstrapped=!0,a.resolve(c)}).fail(a.reject).progress(a.notify),a.promise()},matchesSearch:function(a,b){b=b||{};var c="g"+(b.caseSensitive?"":"i"),d=b.words?new RegExp("(\\W|^)"+b.needle+"(\\W|$)",c):b.regExp?new RegExp(b.needle,c):new RegExp(b.needle,c);return"undefined"!=typeof b.needle&&""!==b.needle?!!this.get(a).match(d):!1}}),b.MVC.Collection=a.Backbone.Collection.extend({initialize:function(b,c){c=c||{},this.apiKey=null,this.remote=null,this.secure=null,"undefined"!=typeof c.apiKey&&(this.apiKey=c.apiKey,delete c.apiKey),"undefined"!=typeof c.remote&&(this.remote=c.remote,delete c.remote,"undefined"!=typeof c.secure?(this.secure=c.secure,delete c.secure):this.secure=!1),a.Backbone.Collection.prototype.initialize.apply(this,arguments)},add:function(){return a.Backbone.Collection.prototype.add.apply(this,arguments),this},fetchModels:function(a){var b=$.Deferred(),c=0,d=0,e=this.length,f=[],g=this;return this.each(function(h){h.fetch(a).done(function(a){c++,f.push(a),b.notify(h,a),f.length===e&&0===d&&b.resolve(g,f)}).fail(function(a){d++,f.push(a),b.notify(h,a),f.length==e&&d>0&&b.reject(g,f)})}),b},saveModels:function(){var a=$.Deferred(),b=0,c=0,d=[],e=this;return this.each(function(f){f.save().done(function(g){b++,d.push(g),a.notify(f,g),d.length===e.length&&0===c&&a.resolve(e,d)}).fail(function(b){c++,d.push(b),a.notify(f,b),d.length==e.length&&c>0&&a.reject(e,d)})}),a},setIdOrder:function(a){var b=this.comparator,c=function(b){var c=b.cid;return a.indexOf(c)};this.comparator=c,this.sort(),this.comparator=b},hasNewModels:function(){var a=!1;return this.each(function(b){b.isNew()&&(a=!0)}),a},isBootstrapped:function(){return this._bootstrapped=this._bootstrapped||!1,this._bootstrapped?!0:!1},bootstrap:function(a){var b=$.Deferred(),c=this;return this.isBootstrapped()?b.resolve(this.toJSON()):this.fetch(a).done(function(a){c._bootstrapped=!0,b.resolve(a)}).fail(b.reject).progress(b.notify),b.promise()},search:function(a,b){b=b||{};var c=[],d="g"+(b.caseSensitive?"":"i"),e=b.words?new RegExp("(\\W|^)"+b.needle+"(\\W|$)",d):b.regExp?new RegExp(b.needle,d):new RegExp(b.needle,d);return c="undefined"!=typeof b.needle&&""!==b.needle?this.filter(function(b){return!!b.get(a).match(e)}):this.models},fetch:function(){var b=this;return this.trigger("request:collection",this),a.Backbone.Collection.prototype.fetch.apply(this,arguments).done(function(a,c,d){b.trigger("sync:collection",b,d)})}}),b.DataStreamProvider=function(){function a(a){var b=function(a){var b=this;this._dfd=$.Deferred(),this.socket=new WebSocket(a),this.socket.onerror=function(){b._dfd.reject.call(b._dfd,arguments)},this.type="WebSocket",this.publish()};return b.prototype={publish:function(a){var b=this;this.socket.onopen=function(c){var d=Array.prototype.slice.call(arguments,0);b.onOpen&&b.onOpen.apply(b,d),d.unshift("stream:open"),a&&a.trigger.apply(a,d),b._dfd.resolve.call(b._dfd,c)},this.socket.onclose=function(){var c=Array.prototype.slice.call(arguments,0);b.onClose&&b.onClose.apply(b,c),c.unshift("stream:close"),a&&a.trigger.apply(a,c)},this.socket.onmessage=function(c){var d=Array.prototype.slice.call(arguments,0),e=JSON.parse(c.data),f=e.status||"message";b.onMessage&&b.onMessage.apply(b,d),f=e.error?"error":e.status?e.status:"message",d.unshift("stream:"+f),a&&a.trigger.apply(a,d)}},send:function(){var a=this,b=arguments;this._dfd.done(function(){a.socket.send.apply(a.socket,b)})},onOpen:$.noop,onClose:$.noop,onMessage:$.noop,destroy:function(){this.socket.close()}},new b(a)}return{getStream:a}}(),b}(window);!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(a,b){"use strict";function c(a,b){return b>a?"0"+a:a.toString()}function d(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function e(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.hash)||[,""])[1].replace(/\+/g,"%20"))||null}function f(){var a=[],b={};-1!==location.search.indexOf("?")&&(a=location.search.split("?")[1].split("#")[0].split("&"));for(var c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=d[1]}var e=b.server||window.location.hostname,f=b.port||location.port||!1,g=("https:"==location.protocol?"wss":"ws")+"://"+e+(f?":"+f:"")+"/zoomdata/websocket/"+(b.key?"?key="+b.key:"");return{host:g,time:(new Date).getTime(),params:b}}function g(a,b){for(var c=a.visualizations||[],e=b||d("visId"),f=0;f<c.length;f++)if(c[f].visId==e){var g=c[f];return g}}function h(a){var b=["avg","min","max","sum"];return a&&i(a)&&b.push("last_value"),b}function i(a){if(!a)throw new ReferenceError("Source needed");return a.toRequest().cfg.group.metrics.length>1?!1:a.config.attributes.source.sourceFeatures.indexOf("LV_METRIC")>=0}function j(a){var b=["MONEY","INTEGER","NUMBER","COUNT OF","FORMULA"];return b.indexOf(a.toUpperCase())>=0}function k(a){for(var b=a.visualizations,c=d("visId"),e=0;e<b.length;e++)if(b[e].visId==c){var f=b[e];return f.source}}function l(a){return a>=12&&(a-=12),0===a&&(a=12),a}function m(a){var b=new Date(Math.round(a)),d=b.getHours()>=12?" PM":" AM";return l(b.getHours())+":"+c(b.getMinutes(),10)+":"+c(b.getSeconds(),10)+d}function n(a,b,c){var d=new Date(Math.round(a)),e=c?d.getUTCMonth():d.getMonth(),f=c?d.getUTCDate():d.getDate(),g=c?d.getUTCFullYear():d.getFullYear();return e+=1,10>e&&(e="0"+e),b?e+"/"+f+"/"+g:g+"/"+e+"/"+f}function o(a){var b=new Date(Math.round(a)),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return b.getDate()+" "+c[b.getMonth()]+" "+(1900+b.getYear())}function p(a,b){return n(a,b)+" "+m(a)}function q(a){var b=new Date(a),c=b.getTimezoneOffset()/-60;return"GMT"+(c>0?"+":"")+c}function r(){var a=jstz.determine();return a.name()}function s(){return window.pageUserData}function t(a){this.options=$.extend({},this.defaults,a),this.$el=$('<div class="zd-radial-item-filter"></div>'),this.$donut=$('<div class="zd-radial-item-donut"></div>').appendTo(this.$el),this.$filler=$('<div class="zd-radial-item-filler"></div>').appendTo(this.$el),this.$center=$('<div class="zd-radial-item-center"></div>').appendTo(this.$donut),this.positionElements()}var u={},v=_.template('            <div class="fsWrapper">                <div class="well well-small fsHeader">                    <div class="fsHead pull-left"></div>                    <div class="filters"></div>                    <div class="exitFullscreen"><i class="zd icon exit-fullscreen"></i></div>                    <div class="clearfix"></div>                </div>                <div class="well-small well fsBody">                    <div class="fullScreenContainer"></div>                    <div class="fullScreenContainerFooter"></div>                </div>                <div class="bottomPane">                        <div class="paneContent"></div>                 </div>             </div>            <div class="fsExpander"></div>            '),w=b.MVC.View.extend({className:"fullScreenView",template:v,events:{"click .exitFullscreen":"close"},initialize:function(){b.MVC.View.prototype.initialize.apply(this,arguments),this.$el.appendTo("body"),this.$el.hide(0),this.$el.append(this.template()),this.$wraper=this.$(".fsWrapper"),this.$header=this.$(".fsHeader"),this.$head=this.$(".fsHead"),this.$body=this.$(".fullScreenContainer"),this.$labels=this.$(".widgetLabel"),this.$styles=this.$("style"),this.$filters=this.$(".filters"),this.$footer=this.$(".fullScreenContainerFooter"),this.$expander=this.$(".fsExpander"),this.listenTo(b.eventDispatcher,"switch:section",this.close)},render:function(a){var c=this,d=$(".dashboard > .leftPane"),e=$(".dashboard > .bottomPane"),f=a.header,g=a.content,h=a.toolbar,i=a.filters,j=a.labels,k=a.styles,l=(a.styleId,a.time);this.options=$.extend({},this.options,a),this.$body.empty(),this.$head.empty(),this.$filters.empty(),this.$footer.empty(),this._runAnimationShowUp(function(){c.$el.fadeIn(function(){c.$head.append(f),i&&c.$filters.append(i.clone(!0)),h&&c.$body.append(h),j&&c.$body.append(j),b.Utilities.appendStylesWithScoping(k,c.$body[0]),c.$body.append(g),c.$footer.append(l),d.addClass("fullScreen"),e.addClass("fullScreen"),c.delegateEvents(),c.adjustBodySizes(),c._applyClickEvents(!0),c.trigger("open")}),c.$wraper.css({opacity:0}),c.$body.css({opacity:0})}),this.listenTo(b.eventDispatcher,"filters:validate",function(){c.$filters.empty(),c.$filters.append(i.clone(!0)),c._applyClickEvents(!1),c._applyClickEvents(!0)})},_applyClickEvents:function(a){function c(){b.eventDispatcher.trigger("filtersPalette:show")}var d=this.$filters.find(".expbtn");a?d.on("click",c):d.off("click")},_runAnimationShowUp:function(a){a();var b=this,c=this.options.widget.$el,d=c.offset(),e=c.width(),f=c.height(),g=300;this.$expander.css({position:"absolute",top:d.top,left:d.left,width:e,height:f}).show(),$('<style id="transferEffect" type="text/css">.zoomin-transfer {                     background-color: #FFF;                     z-index: 1029;                    margin-top: 25px;                }</style>').appendTo("body"),this.$expander.effect("transfer",{to:$(".midPane"),className:"zoomin-transfer"},g,function(){$("#transferEffect").remove(),b.$expander.hide()}),setTimeout(function(){b.$wraper.css({opacity:1}),b.$body.css({opacity:1})},g-100)},_closeAnimation:function(a,b){if(this.options.widget)if("click"===b){var c=this,d=this.$body.offset(),e=this.$body.width(),f=this.$body.height(),g=(this.$body.find("svg"),300);this.$expander.css({position:"absolute",top:d.top-60,left:0,width:e+70,height:f+120}).show(),$('<style id="transferEffect" type="text/css">.zoomin-transfer {                         background-color: #FFF;                         z-index: 1029;                        margin-top: 25px;                        opacity: 0.8;                    }</style>').appendTo("body"),this.$expander.effect("transfer",{to:this.options.widget.$el,className:"zoomin-transfer"},g,function(){$("#transferEffect").remove(),c.$expander.hide()}),setTimeout(function(){c.$wraper.css({opacity:0}),c.$body.css({opacity:0}),a()},g-100)}else a()},close:function(a){var c=this,d=$(".dashboard > .leftPane"),e=$(".dashboard > .bottomPane"),f=a.type;d.removeClass("fullScreen"),e.removeClass("fullScreen"),this.filtersIndicator&&delete this.filtersIndicator.options.rootFullscreen,this.trigger("startClosing"),this._closeAnimation(function(){c.$el.fadeOut("fast",function(){c.trigger("close")})},f),this._applyClickEvents(!1),this.stopListening(b.eventDispatcher,"visualization:start"),this.stopListening(b.eventDispatcher,"filters:validate")},adjustBodySizes:function(){var a=this.$body.parent().prev(),b=a.offset().top+a.outerHeight()+parseFloat(a.css("margin-bottom"));this.$body.parent().css("top",b)}});u.FullScreenView=new w;var x=_.template('        <div class="modal hide fade">            <div class="modal-header">                <button title="Close" value="dialog-reject" class="close">&times;</button>                <h3 class="dialog-head pull-left"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body">            </div>            <div class="modal-footer dialog-controls">                <button title="<%= rejectButtonTitle %>" value="dialog-reject" class="btn btnNo"><%= rejectButtonLabel %></button>                <button title="<%= acceptButtonTitle %>" value="dialog-accept" class="btn btn-primary btnYes"><%= acceptButtonLabel %></button>            </div>        </div>    ');u.Dialog=b.MVC.View.extend({defaults:{template:x,mode:"dialog",draggable:!1,wide:!1,modal:"static",rejectButtonLabel:"Close",acceptButtonLabel:"Accept",rejectButtonTitle:"Close",acceptButtonTitle:"Accept"},events:{'click button[value="dialog-reject"]':"hide",'click button[value="dialog-accept"]':"accept"},initialize:function(a){var b=this;switch(this.settings=$.extend({},this.defaults,a),this.setElement(this.settings.template({rejectButtonLabel:this.settings.rejectButtonLabel,acceptButtonLabel:this.settings.acceptButtonLabel,rejectButtonTitle:this.settings.rejectButtonTitle,acceptButtonTitle:this.settings.acceptButtonTitle})),this.$el.appendTo("body"),this.$el.modal({show:!1,backdrop:this.settings.modal,keyboard:!1}),this.settings.mode){case"alert":this.$('button[value="dialog-accept"]').hide()}this.$head=this.$(".dialog-head"),this.$body=this.$(".dialog-body"),this.settings.draggable&&this.$el.draggable({start:function(){b.$el.removeClass("fade")},stop:function(){b.$el.addClass("fade")},cursor:"move"}),this.settings.wide&&this.$el.addClass("wide")},render:function(a,b){this.$body.empty(),this.$head.empty(),this.$body.append(a),void 0!==b?(this.$head.append(b),this.$head.show()):this.$head.hide(),this.$el.modal("show"),this.delegateEvents()},onBeforeHide:$.noop,hide:function(){var a=this;this.onBeforeHide()!==!1&&(this.$el.one("hidden",function(){a.trigger("dialog:rejected"),a.remove(),a.onReject()}),this.$el.modal("hide"))},onReject:$.noop,onBeforeAccept:$.noop,accept:function(){var a=this;this.onBeforeAccept()!==!1&&(this.$el.one("hidden",function(){a.trigger("dialog:accepted"),a.remove(),a.onAccept()}),this.$el.modal("hide"))},onAccept:$.noop});var y=_.template('        <span><%= message %></span>        <i title="<%= acceptTitle%>" class="icon-ok icon-white"></i>        <i title="<%= cancelTitle%>" class="icon-remove icon-white"></i>    ');u.ConfirmMessage=b.MVC.View.extend({tagName:"span",className:"label label-warning pull-right confirmMessage",defaults:{template:y,message:"Warning",acceptTitle:"Accept",cancelTitle:"Cancel"},events:{"click .icon-ok":"accept","click .icon-remove":"cancel"},initialize:function(a){this.settings=$.extend({},this.defaults,a),this._deferred=$.Deferred(),this.result=this._deferred.promise()},accept:function(){this.remove(),this._deferred.resolve()},cancel:function(){this.remove(),this._deferred.reject()},render:function(){return this.$el.html(this.settings.template({message:this.settings.message,acceptTitle:this.settings.acceptTitle,cancelTitle:this.settings.cancelTitle})),this.delegateEvents(),this}}),u.getTimestamp=function(a){var b=a.split(" ")[0],c=b.replace(/-/g,"/");a=a.replace(b,c);var d=new Date(a).getTime();return isNaN(d)?parseInt(a,10):d},u.isNotUndefinedOrNull=function(a){return void 0!==a&&null!==a},u.isFirstTime=function(a){var b="zd_first_enter_ts-"+a,c=u.getCookie(b),d=(new Date).getTime(),e=864e5;return $.isNumeric(c)?e>d-+c?!0:!1:(u.setCookie(b,(new Date).getTime()),!0)},u.setCookie=function(a,b,c){var d=new Date;d.setDate(d.getDate()+c);var e=escape(b)+(null===c?"":"; expires="+d.toUTCString());document.cookie=a+"="+e},u.getCookie=function(a){var b=window.sessionStorage.sessionId;if(!u.isNotUndefinedOrNull(b)){var c=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));b=c?decodeURIComponent(c[1]):void 0}return b},u.namespace=function(a,b){var c=[],d=b||window;return a&&(c=a.split(".")),$.each(c,function(a,b){d.hasOwnProperty(b)||(d[b]={}),d=d[b]}),d},u.preventUnsavedGestures=function(){if(navigator.userAgent.match(/Macintosh/)&&navigator.userAgent.match(/Chrome/)){{$(window)}b.Utilities.turnOnPrompt("Are you sure you want to leave the page unsaved?"),b.Utilities.preventSwipeForBack()}},u.preventSwipeForBack=function(a){if(navigator.userAgent.match(/Macintosh/)&&navigator.userAgent.match(/Chrome/)){var b=a||$(window);if("undefined"==typeof b.mousewheel)return;b.mousewheel(function(a,b,c,d){if(!(Math.abs(d)>10||0==c)){var e,f,g=$(a.target).parents();e=!_(g).detect(function(a){var b=$(a).scrollLeft()>0;return b}),f=!_(g).detect(function(a){var b=$(a).scrollLeft()-(a.scrollWidth-a.clientWidth)<0;return b}),0>=c&&e===!0&&f===!1&&a.preventDefault(),c>=0&&e===!1&&f===!0&&a.preventDefault()}})}},u.turnOnPrompt=function(a){var b=$(window),c=a?a:null;b.unbind("beforeunload"),b.bind("beforeunload",function(){return c})},u.turnOffPrompt=function(){$(window).unbind("beforeunload")};var z=Math.sqrt(2);t.prototype={defaults:{start:-30,angle:120,gap:8,radius:200,width:60,color:"rgba(0, 0, 0, 0.7)"},maxAngle:160,positionElements:function(){var a=this,b=this.options.gap,c=this.options.radius,d=Math.max(this.options.angle,1),e=90-this.options.start,f=90-d,g=c*(1+(0>f?Math.sin(-f/180*Math.PI):0)),h=this.options.radius,i=this.options.width,j=parseInt(this.$center.width())||20,k=parseInt(this.$center.height())||20,l=h-i,m=/(iPhone|iPod|iPad)/i.test(navigator.userAgent),n=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);a.$el.css({width:g,height:g,borderWidth:b/2+"px",transform:(m||n)&&1===e?"rotate("+e+"deg)":"rotate("+e+"deg) skew(0deg, "+f+"deg)",transformOrigin:"100% 100%"}),a.$donut.css({left:g-h,top:g-h,width:2*h,height:2*h,borderWidth:i,transform:(m||n)&&1===e?"rotate("+-(d-90)/2+"deg)":"skew(0deg, "+-f+"deg) rotate("+-(d-90)/2+"deg)"}),(m||n)&&(a.$el.css({transition:"0.1s ease-in","-ms-transition":"0.1s ease-in","-moz-transition":"0.1s ease-in","-webkit-transition":"0.1s ease-in"}),a.$donut.css({transition:"0.1s ease-in","-ms-transition":"0.1s ease-in","-moz-transition":"0.1s ease-in","-webkit-transition":"0.1s ease-in"})),a.$filler.css({left:g-l,top:g-l,width:2*l,height:2*l,transform:"skew(0deg, "+-f+"deg)"}),a.$center.css({left:-(l*(z/2-1)+i*(z/4)+j/2),top:-(l*(z/2-1)+i*(z/4)+k/2),transform:"rotate("+((d-90)/2-e)+"deg)"})},get:function(){var a=[];if(0==arguments.length)a=this.options;else if(1==arguments.length)a=this.options[arguments[0]]||null;else for(var b=0;b<arguments.length;b++)a[arguments[b]]=this.options[arguments[b]]||null;return a},set:function(a){"number"==typeof a.start&&(this.options.start=a.start),"number"==typeof a.angle&&(this.options.angle=Math.min(a.angle,this.maxAngle)),"number"==typeof a.gap&&(this.options.gap=a.gap),"number"==typeof a.radius&&(this.options.radius=a.radius),"number"==typeof a.width&&(this.options.width=a.width),"number"==typeof a.color&&(this.options.color=a.color),this.positionElements()},close:function(){var a=this.options;this.set({start:a.start+a.angle/2,angle:0})},remove:function(){this.$el.remove()}},u.Arc=t,u.getURLParameter=d,u.getHashParameter=e,u.parseUrlParams=f,u.getVisualizationDetails=g,u.getSourceDetails=k,u.pad=c,u.hoursToAMPM=l,u.formattedTimeOnly=m,u.formattedDateOnly=n,u.formattedDate=p,u.timeZoneFromTime=q,u.determineTimeZone=r,u.formattedDateMonth=o,u.getPageUserData=s,u.getFunctionsForMetric=h,u.hasLastValue=i,u.isNumericAttributeType=j,u.time={},u.time.getPreviousHour=function(a){return a-u.time.millisecondsIn.hour},u.time.getMaxStepLimit=function(){return 62},u.time.getLowerStep=function(a){var b="",c=["MINUTE","HOUR","DAY","WEEK","MONTH","YEAR"],d=c.indexOf(a),e=d-1;return b=0>e?"MINUTE":c[e]},u.time.getMaxStep=function(a,b){var c=null,d=["MINUTE","HOUR","DAY","WEEK","MONTH","YEAR"],e=d.indexOf(a),f=d.indexOf(b);if(-1===e)throw"Step 1 is wrong";if(-1===f)throw"Step 2 is wrong";return c=e>f?a:b},u.time.getDaysInMonth=function(a,b){var c=new Date(a);return b?(c.setUTCDate(15),c.setUTCMonth(c.getUTCMonth()+1),c.setUTCDate(0),c.getUTCDate()):(c.setDate(15),c.setMonth(c.getMonth()+1),c.setDate(0),c.getDate())},u.time.formatAMPM=function(a,b){var c,d;b?(c=a.getUTCHours(),d=a.getUTCMinutes()):(c=a.getHours(),d=a.getMinutes());var e=c>=12?"pm":"am";c%=12,c=c?c:12,d=10>d?"0"+d:d;var f=c+":"+d+" "+e;return f},u.time.formatAMPMForHours=function(a,b){var c;c=b?a.getUTCHours():a.getHours();var d=c>=12?"pm":"am";c%=12,c=c?c:12;var e=c+" "+d;return e},u.time.getWeekNumber=function(a,b){if(a=new Date(a),b){a.setUTCHours(0,0,0),a.setUTCDate(a.getUTCDate()+4-(a.getUTCDay()||7));var c=new Date(a.getUTCFullYear(),0,1),d=Math.ceil(((a-c)/864e5+1)/7);return[a.getUTCFullYear(),d]}a.setHours(0,0,0),a.setDate(a.getDate()+4-(a.getDay()||7));var c=new Date(a.getFullYear(),0,1),d=Math.ceil(((a-c)/864e5+1)/7);return[a.getFullYear(),d]},u.time.getRangeForStep=function(a,c,d,e){function f(a,b){return b?(a.setUTCMilliseconds(0),a.setUTCSeconds(0),a.setUTCMinutes(0)):(a.setMilliseconds(0),a.setSeconds(0),a.setMinutes(0)),a}function g(a,b){return a.setDate(b?a.getUTCDate()-a.getUTCDay():a.getDate()-a.getDay()),a}var h=new Date(a),i=new Date(c),j=!1;if(i.getTime()%1e4===9999&&"DAY"===d&&e&&(i.setTime(i.getTime()+1),j=!0),c.getTime()-a.getTime()+1<b.Utilities.time.millisecondsIn[d.toLowerCase()]){switch(d){case"MINUTE":break;case"HOUR":f(h,e),f(i,e),e?i.setUTCHours(i.getUTCHours()+1):i.setHours(i.getHours()+1);break;case"DAY":f(h,e),f(i,e),e?(h.setUTCHours(0),i.setUTCHours(0),i.setUTCDate(i.getUTCDate()+1)):(h.setHours(0),i.setHours(0),i.setDate(i.getDate()+1));break;case"WEEK":f(h,e),f(i,e),g(h,e),g(i,e),e?(h.setUTCHours(0),i.setUTCHours(0),i.setUTCDate(i.getUTCDate()+7)):(h.setHours(0),i.setHours(0),i.setDate(i.getDate()+7));break;case"MONTH":f(h,e),f(i,e),e?(h.setUTCHours(0),h.setUTCDate(1),i.setUTCHours(0),i.setUTCDate(1),i.setUTCMonth(i.getUTCMonth()+1)):(h.setHours(0),h.setDate(1),i.setHours(0),i.setDate(1),i.setMonth(i.getMonth()+1));break;case"YEAR":f(h,e),f(i,e),e?(h.setUTCHours(0),h.setUTCDate(0),h.setUTCMonth(0),i.setUTCHours(0),i.setUTCDate(0),i.setUTCMonth(0),i.setUTCFullYear(i.getUTCFullYear()+1)):(h.setHours(0),h.setDate(0),h.setMonth(0),i.setHours(0),i.setDate(0),i.setMonth(0),i.setFullYear(i.getFullYear()+1))}return{min:h,max:i}}switch(d){case"MINUTE":break;case"HOUR":f(h,e),f(i,e),e?i.setUTCHours(i.getUTCHours()):i.setHours(i.getHours());break;case"DAY":if(f(h,e),f(i,e),e){var k=i.getHours(0)>0?1:0;h.setUTCHours(0),i.setUTCHours(0),i.setUTCDate(i.getUTCDate()+k)}else{var k=i.getHours(0)>0?1:0;h.setHours(0),i.setHours(0),i.setDate(i.getDate()+k)}break;case"WEEK":f(h,e),f(i,e),g(h,e),g(i,e),e?(h.setUTCHours(0),i.setUTCHours(0),i.setUTCDate(i.getUTCDate()+7)):(h.setHours(0),i.setHours(0),i.setDate(i.getDate()+7));break;case"MONTH":f(h,e),f(i,e),e?(h.setUTCHours(0),h.setUTCDate(1),i.setUTCHours(0),i.setUTCDate(1),i.setUTCMonth(i.getUTCMonth()+1)):(h.setHours(0),h.setDate(1),i.setHours(0),i.setDate(1),i.setMonth(i.getMonth()+1));break;case"YEAR":f(h,e),f(i,e),e?(h.setUTCHours(0),h.setUTCDate(0),h.setUTCMonth(0),i.setUTCHours(0),i.setUTCDate(0),i.setUTCMonth(0),h.getUTCFullYear()===i.getUTCFullYear()&&i.setUTCFullYear(i.getUTCFullYear()+1)):(h.setHours(0),h.setDate(0),h.setMonth(0),i.setHours(0),i.setDate(0),i.setMonth(0),h.getFullYear()===i.getFullYear()&&i.setFullYear(i.getFullYear()+1))}return{min:h,max:i}},u.time.recalculateLimit=function(a,b,c){var d=1,e=1,f=u.time.getMaxStepLimit();switch(a){case"MINUTE":e=b;break;case"HOUR":e=60*b;break;case"DAY":e=60*b*24;break;case"WEEK":e=60*b*24*7;break;case"MONTH":e=60*b*24*31;break;case"YEAR":e=60*b*24*365}switch(d=e,c){case"MINUTE":d=e;break;case"HOUR":"MINUTE"!==a&&(d=e/60);break;case"DAY":"HOUR"!==a&&(d=e/60/24);break;case"WEEK":"DAY"!==a&&(d=e/60/24/7);break;case"MONTH":"WEEK"!==a&&(d=e/60/24/31);break;case"YEAR":"MONTH"!==a&&(d=e/60/24/365)}return d=Math.ceil(d),d>f?f:d},u.time.getRoundedDateRange=function(a,c,d,e,f){var g="MINUTE",h=0,i=60;if(c.getTime()%1e4===9999&&"DAY"===d&&c.setTime(c.getTime()+1),f)var j="DAY"===d&&a.getUTCHours()>0?1:0;else var j="DAY"===d&&a.getHours()>0?1:0;var k=new Date(a.getTime()),l=new Date(c.getTime());"DAY"===d&&(f?(k.setUTCHours(0),l.setUTCHours(23)):(k.setHours(0),l.setHours(23)));var m=l.getTime()-k.getTime()+j;if(m<=b.Utilities.time.millisecondsIn.hour&&!d)g="MINUTE",h=f?c.getUTCMinutes()-a.getUTCMinutes():c.getMinutes()-a.getMinutes(),i=0>=h?h+61:h+1;else if(m<=b.Utilities.time.millisecondsIn.day&&!d)g="HOUR",h=f?c.getUTCHours()-a.getUTCHours():c.getHours()-a.getHours(),i=0>=h?h+25:h+1;else if(m<=29*b.Utilities.time.millisecondsIn.day&&!d)g="DAY",f?(h=c.getUTCDate()-a.getUTCDate()+(c.getUTCMonth()-a.getUTCMonth())*b.Utilities.time.getDaysInMonth(a,f),i=0>=h?h+b.Utilities.time.getDaysInMonth(a,f):h+1):(h=c.getDate()-a.getDate()+(c.getMonth()-a.getMonth())*b.Utilities.time.getDaysInMonth(a),i=0>=h?h+b.Utilities.time.getDaysInMonth(a):h+1);else if(m<=60*b.Utilities.time.millisecondsIn.day&&!d)if(g="WEEK",f){h=b.Utilities.time.getWeekNumber(c,f)[1]-b.Utilities.time.getWeekNumber(a,f)[1];var n=new Date(a.getUTCFullYear(),11,31);i=0>=h?h+b.Utilities.time.getWeekNumber(n,f)[1]:h+1}else{h=b.Utilities.time.getWeekNumber(c)[1]-b.Utilities.time.getWeekNumber(a)[1];var n=new Date(a.getFullYear(),11,31);i=0>=h?h+b.Utilities.time.getWeekNumber(n)[1]:h+1}else m<=365*b.Utilities.time.millisecondsIn.day&&!d?(g="MONTH",h=f?c.getUTCMonth()-a.getUTCMonth():c.getMonth()-a.getMonth(),i=0>=h?h+13:h+1):m>365*b.Utilities.time.millisecondsIn.day&&!d&&(g="YEAR",h=f?c.getUTCFullYear()-a.getUTCFullYear():c.getFullYear()-a.getFullYear(),i=h+1);if(i-=1,d){switch(d){case"MINUTE":i=m/1e3/60;
break;case"HOUR":i=m/1e3/60/60;break;case"DAY":i=m/1e3/60/60/24;break;case"WEEK":i=m/1e3/60/60/24/7;break;case"MONTH":i=f?12*c.getUTCFullYear()+c.getUTCMonth()-(12*a.getUTCFullYear()+a.getUTCMonth()):12*c.getFullYear()+c.getMonth()-(12*a.getFullYear()+a.getMonth());break;case"YEAR":i=m/1e3/60/60/24/365}g=d,i="MONTH"===d?i:Math.ceil(i)+(e?1:0)}return i=0>=i?1:i,{step:g,amount:i}},u.time.days=[{acr:"Sun",full:"Sunday"},{acr:"Mon",full:"Monday"},{acr:"Tue",full:"Tuesday"},{acr:"Wed",full:"Wednesday"},{acr:"Thu",full:"Thursday"},{acr:"Fri",full:"Friday"},{acr:"Sat",full:"Saturday"}],u.time.months=[{acr:"Jan",full:"January",days:31},{acr:"Feb",full:"February",days:28},{acr:"Mar",full:"March",days:31},{acr:"Apr",full:"April",days:30},{acr:"May",full:"May",days:31},{acr:"Jun",full:"June",days:30},{acr:"Jul",full:"July",days:31},{acr:"Aug",full:"August",days:31},{acr:"Sep",full:"September",days:30},{acr:"Oct",full:"October",days:31},{acr:"Nov",full:"November",days:30},{acr:"Dec",full:"December",days:31}],u.time.millisecondsIn={},u.time.millisecondsIn.sec=1e3,u.time.millisecondsIn.min=60*u.time.millisecondsIn.sec,u.time.millisecondsIn.hour=60*u.time.millisecondsIn.min,u.time.millisecondsIn.day=24*u.time.millisecondsIn.hour,u.time.millisecondsIn.week=7*u.time.millisecondsIn.day,u.time.millisecondsIn.month=31*u.time.millisecondsIn.day,u.time.getEndTimeWithinStep=function(a,b,c){var d=new Date(a);switch(b){case"MINUTE":c?(d.setUTCMilliseconds(0),d.setUTCSeconds(0),d.setUTCMinutes(d.getUTCMinutes()+1)):(d.setMilliseconds(0),d.setSeconds(0),d.setMinutes(d.getMinutes()+1));break;case"HOUR":c?(d.setUTCMilliseconds(0),d.setUTCSeconds(0),d.setUTCMinutes(0),d.setUTCHours(d.getUTCHours()+1)):(d.setMilliseconds(0),d.setSeconds(0),d.setMinutes(0),d.setHours(d.getHours()+1));break;case"DAY":c?(d.setUTCMilliseconds(0),d.setUTCSeconds(0),d.setUTCMinutes(0),d.setUTCHours(0),d.setUTCDate(d.getUTCDate()+1)):(d.setMilliseconds(0),d.setSeconds(0),d.setMinutes(0),d.setHours(0),d.setDate(d.getDate()+1));break;case"WEEK":c?(d.setUTCMilliseconds(0),d.setUTCSeconds(0),d.setUTCMinutes(0),d.setUTCHours(0),d.setUTCDate(d.getUTCDate()+7)):(d.setMilliseconds(0),d.setSeconds(0),d.setMinutes(0),d.setHours(0),d.setDate(d.getDate()+7));break;case"MONTH":c?(d.setUTCMilliseconds(0),d.setUTCSeconds(0),d.setUTCMinutes(0),d.setUTCHours(0),d.setUTCDate(1),d.setUTCMonth(d.getUTCMonth()+1)):(d.setMilliseconds(0),d.setSeconds(0),d.setMinutes(0),d.setHours(0),d.setDate(1),d.setMonth(d.getMonth()+1));break;case"YEAR":c?(d.setUTCMilliseconds(0),d.setUTCSeconds(0),d.setUTCMinutes(0),d.setUTCHours(0),d.setUTCDate(1),d.setUTCMonth(0),d.setUTCFullYear(d.getUTCFullYear()+1)):(d.setMilliseconds(0),d.setSeconds(0),d.setMinutes(0),d.setHours(0),d.setDate(1),d.setMonth(0),d.setFullYear(d.getFullYear()+1))}return d.getTime()},u.log10=function(a){return Math.log(a)/Math.log(10)},u.isRetina=function(){return window.devicePixelRatio>1},u.toTitleCase=function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},u.MODE={NORMAL:0,WIDGET:1,EMBEDDED:2,NATIVE:3};var A=-1;u.mode=function(){if(-1!==A)return A;A=u.MODE.NORMAL;var a=d("__target");if("widget"===a)A=u.MODE.WIDGET;else if("embedded"===a)A=u.MODE.EMBEDDED;else{var b=/(iPhone|iPod|iPad)/i.test(navigator.userAgent),c=/(Safari)/i.test(navigator.userAgent);b&&!c&&(A=u.MODE.NATIVE)}return A},u.getHiddenControls=function(){var a=d("hidecontrol");return a=a?a.split(","):[],console.log("hiddenControls",a),a},u.visualizationStartedUnique={_counter:0},u.visualizationStarted=function(a){var c={WORD_CLOUD:1e3,ZOOMABLE_MAP:2e3,VERTICAL_BARS:100,HEAT_MAP:1e3,MULTI_METRIC_TREND:100,SIDE_BY_SIDE_BARS:900,STACKED_BARS:900,TRENDS:100,PIE:600,PIVOT_TABLE:1e3,DEFAULT:100},d=c.DEFAULT,e=b.main?b.main.currentSection.widgetGrid.collection.length:null;if(a){if(u.visualizationStartedUnique[a.UUID])return!1;u.visualizationStartedUnique[a.UUID]=!0,d=a.customReadyStatusDelay?a.customReadyStatusDelay:c[a.config.type]||c.DEFAULT,d+=1002}b.Utilities.preventSwipeForBack();var f="screenshot_status_ready",g=$("body");return setTimeout(function(){u.visualizationStartedUnique._counter++,e===u.visualizationStartedUnique._counter&&(g.addClass(f),console.log(a.UUID+" started with delay "+d+"ms."))},d),!0},u.isSingleVizualization=function(){return b.main.currentSection.widgetGrid.childViews.length<2},u.isSmallWidget=function(a,b){var c=500,d=380;return c>=a||d>=b},u.getWidgetSizeClass=function(a,b){var c=500,d=380,e=1e3,f=700,g=["small","medium","large"],h=g[1];return(a>e||b>f)&&(h=g[2]),(e>=a||f>=b)&&(a>=c||b>=d)&&(h=g[1]),(c>a||d>b)&&(h=g[0]),h},u.generateUUID=function(){return"xxxxxxxxxxxxxxxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},"undefined"!=typeof Hammer&&(Hammer.plugins.fakeMultitouch(),$(function(){$("body").hammer()})),u.getVersion=function(){var a=$.Deferred();return $.ajax({url:"service/version/",success:function(b){a.resolve(b)},fail:function(){a.reject()}}),a.promise()},u.detectTouchDevice=function(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},u.sourceExists=function(a,b,c){var d=!1;return admin.sources.each(function(a){b.toLowerCase()===a.get("name").toLowerCase()&&a.get("id")!==c&&(d=!0)}),d},u.isIOS=function(){return/(iPhone|iPod|iPad)/i.test(navigator.userAgent)},u.rTrim=function(a){return a.replace(/\s+$/,"")},u.lTrim=function(a){return a.replace(/^\s+/,"")},u.appendStylesWithScoping=function(a,b){a&&a.each(function(a,c){var d=document.createElement("STYLE"),e=!1;$(c.attributes).each(function(a,b){var c=b.name||b.nodeName,f=b.value||""===b.value?b.value:b.nodeValue;e=e||"scoped"===c,d.setAttribute(c,f)}),d.innerHTML=c.innerText||c.textContent||$(c).text(),b.appendChild(d),e&&$(d).scopedPolyFill()})},u.scopedPolyFill=function(a){function b(a,c){if(c&&(a=c),!a.nodeName)return a.jquery?a.each(b):void 0;if("STYLE"===a.nodeName&&!e.scopeSupported){for(var d,g,h,i=a[e.sheet],j=i[e.rules],k=a.parentNode,l=(k.id||(k.id="scopedByScopedPolyfill_"+ ++f),""),m=j.length||0;k;)k.id&&(l="#"+k.id+" "+l),k=k.parentNode;for(;m--;)d=j[m],g=l+" "+d.selectorText.split(",").join(", "+l),g=g.replace(/[\ ]+:root/gi,""),e.changeSelectorTextAllowed?d.selectorText=g:d.type&&1!==d.type||(h=d.style.cssText,i.removeRule?i.removeRule(m):i.deleteRule(m),i.addRule&&h.length>0?i.addRule(g,h):i.insertRule(g+"{"+h+"}",m))}}var c,d,e=function(){var b,c,d,e=a.createElement("style"),f="undefined"!=typeof e.sheet?"sheet":"undefined"!=typeof e.getSheet?"getSheet":"styleSheet",g="undefined"!=typeof e.scoped;a.body.appendChild(e),b=e[f],b.addRule?b.addRule("c","blink"):b.insertRule("c{}",0),c=b.rules?"rules":"cssRules",d=b[c][0];try{d.selectorText="d"}catch(h){}var i="d"===d.selectorText.toLowerCase();return e.parentNode.removeChild(e),{scopeSupported:g,rules:c,sheet:f,changeSelectorTextAllowed:i}}(),f=0;if(a.querySelectorAll)c=a.querySelectorAll("style[scoped]");else{var g,h=[];for(c=a.getElementsByTagName("style"),d=c.length;d--;)g=c[d].getAttribute("scoped"),("scoped"===g||""===g)&&h.push(c[d]);c=h}for(d=c.length;d--;)b(c[d]);return"function"==typeof jQuery&&"object"==typeof jQuery.fn&&(jQuery.fn.scopedPolyFill=function(){return this.each(b)}),b}(document),b.Utilities=u}(window,Zoomdata),function(a,b){"use strict";b.Models=b.Models||{},b.Models.Visualization=b.MVC.Model.extend({urlRoot:"service/visualizations",initialize:function(){b.MVC.Model.prototype.initialize.apply(this,arguments),this.on("change sync",this.setIconUrl),this.setIconUrl()},setIconUrl:function(){var a=this.get("thumbnailId"),b=this.get("type"),c="";if(a)c=this.urlRoot+"/"+this.get("visId")+"/thumbnail/"+a+".svg?v=10220842";else switch(b){case"VERTICAL_BARS":c="images/Template_Bars_Button_sm.png?v=10220842";break;case"BUBBLES":c="images/Template_Bubbles_Button_sm.png?v=10220842";break;case"SCATTERPLOT":c="images/Template_Scatterplot_Button_sm.png?v=10220842";break;case"PIE":c="images/Template_Pie_Button_sm.png?v=10220842";break;case"WORD_CLOUD":c="images/Template_WordCloud_Button_sm.png?v=10220842";break;case"MAP":c="images/Template_ZoomableMap_Button_sm.png?v=10220842";break;case"TRENDS":c="images/Template_TimeTrend_Button_alt_sm.png?v=10220842";break;case"ZOOMABLE_MAP":c="images/Template_ZoomableMap_Button_sm.png?v=10220842";break;case"PIVOT_TABLE":c="images/Template_GridView_Button_sm.png?v=10220842";break;case"HEAT_MAP":c="images/Template_HeatMap_Button_sm.png?v=10220842";break;case"HORIZONTAL_BARS":c="images/Template_HorizBar_Button_sm.png?v=10220842";break;case"SIDE_BY_SIDE_BARS":c="images/Template_MultiBar_Button_sm.png?v=10220842";break;case"MULTI_METRIC_BARS":c="images/Template_MultiBar_Button_sm.png?v=10220842";break;case"VERTICAL_STACKED_BARS":c="images/Template_MultiGroup_Bar_Button_sm.png?v=10220842";break;case"VERTICAL_100PCT_STACKED_BARS":c="images/Template_Vertical_100pct_Stacked_sm.png?v=10220842";break;case"HORIZONTAL_SIDE_BY_SIDE_BARS":c="images/Template_SideBySide_Horiz_Button_sm.png?v=10220842";break;case"MULTI_LINE":c="images/Template_MultiLine_Button_sm.png?v=10220842";break;case"MULTI_METRIC_TREND":c="images/Template_LineAndBar_Button_sm.png?v=10220842";break;case"FINGERPAINT":c="images/Template_Fingerpaint_Button_sm.png?v=10220842";break;default:c="images/Template_Custom_Button_sm.png?v=10220842"}this.set("thumbnailUrl",c,{silent:!0})},saveEnabled:function(a){this.save({enabled:a})}})}(window,Zoomdata),function(a,b){"use strict";var c=b.Models.Visualization;b.Models=b.Models||{},b.Models.SourceVisualization=c.extend({idAttribute:"visId",initialize:function(a,c){return b.Models.Visualization.prototype.initialize.apply(this,arguments),c=c||{},c.sourceId?(this.setSource(c.sourceId),delete c.sourceId):this.attributes.source&&this.attributes.source.sourceId&&this.setSource(this.attributes.source.sourceId),this},setSource:function(a){return this.sourceId=a,this},getSourceId:function(){return this.sourceId||this.collection.sourceId},url:function(){if(this.getSourceId())return"service/sources/"+this.getSourceId()+"/visualizations/"+this.get("visId");throw new Error("sourceId must be defined")}})}(window,Zoomdata),function(a,b){var c=b.Models.SourceVisualization;b.Models=b.Models||{},b.Models.VisualizationConfig=c.extend({idAttribute:"id",fetch:function(){var a=this,c=_.clone(this.attributes),d=$.Deferred();return b.Models.SourceVisualization.prototype.fetch.apply(this,arguments).done(function(){$.extend(!0,a.attributes,c),d.resolve(arguments)}).fail(function(){d.reject(arguments)}),d.promise()}})}(window,Zoomdata),function(a,b){"use strict";b.Models=b.Models||{},b.Models.Filter=b.MVC.Model.extend({defaults:{path:null,operation:"IN",value:[],editable:!1},idAttribute:"path",initialize:function(){_.bindAll(this,"hasAttribute","addAttribute","removeAttribute","hasValue","isEqualToFilter")},hasAttribute:function(a){return"number"==typeof this.attributes.value?this.attributes.value===a:this.attributes.value&&this.attributes.value.indexOf(a.toString())>=0},hasValue:function(){var a=this.attributes.value;return null!==a&&("number"==typeof a||a.length>0)},addAttribute:function(a,b){var c=_.clone(this.get("value"))||[];return-1==c.indexOf(a)&&(c.push(a),this.set("value",c,b)),this},removeAttribute:function(a,b){var c=_.clone(this.get("value")),d=c&&c.indexOf(a);return c&&-1!==d?(c.splice(d,1),this.set("value",c,b),c.length?this:(this.collection&&this.collection.remove(this,b),null)):this},isEqualToFilter:function(a){if(!a)return!1;var b=a.get("operation")===this.get("operation")&&a.get("path")===this.get("path");if(b){var c=this.get("value"),d=a.get("value");b=c===d||2===c.length&&2===d.length&&c[0]===d[0]&&c[1]===d[1]}return b},toRequest:function(){return{path:this.get("path"),value:this.get("value"),operation:this.get("operation")}}})}(window,Zoomdata),function(a,b){"use strict";b.Models=b.Models||{},b.Models.ObjectField=b.MVC.Model.extend({initialize:function(){b.MVC.Model.prototype.initialize.apply(this,arguments),this.on("change:name change:type",this._setComposedId),this._setComposedId()},_setComposedId:function(){this.id=this._composedId()},_composedId:function(){return this.get("name")+this.get("type")},updateFacetValues:function(a,b,c,d){var e=this,f=this.get("name"),g="service/stream/"+this.collection.sourceId+"/facet/"+f+"?from="+c+"&to="+d+(a?"&query="+a:""),h=$.ajax({type:"POST",url:g,data:JSON.stringify(b),contentType:"application/json"}).done(function(){}).fail(function(){console.warn("Couldn't get values for ObjectField ",e.get("name"))});return h.promise()},updateValues:function(a){var b=this,c=this.get("name"),d=this.collection.url()+c+"/values"+(a?"?query="+a:"/"),e=$.ajax({type:"GET",url:d,contentType:"application/json"}).done(function(a){b.values=a}).fail(function(){console.warn("Couldn't get values for ObjectField ",b.get("name"))});return e.promise()}})}(window,Zoomdata),function(a,b){"use strict";b.Collections=b.Collections||{},b.Collections.Filters=b.MVC.Collection.extend({model:b.Models.Filter,toRequest:function(){return this.map(function(a){return{path:a.get("path"),value:a.get("value"),operation:a.get("operation")}})}})}(window,Zoomdata),function(a,b){"use strict";var c=b.MVC.Model.extend({idAttribute:"name"});b.Collections=b.Collections||{},b.Collections.Formulas=b.MVC.Collection.extend({model:c,initialize:function(a,c){return c=c||{},c.sourceId&&(this.sourceId=c.sourceId,delete c.sourceId),b.MVC.Collection.prototype.initialize.apply(this,arguments),this},setSource:function(a){return this.sourceId=a,this},url:function(){if(this.sourceId)return"service/sources/"+this.sourceId+"/formulas/";throw new Error("sourceId must be defined")}})}(window,Zoomdata),function(a,b){"use strict";function c(a){var b="boolean"==typeof a.get("visible")?a.visible:!0;return new d({name:a.get("name"),label:a.get("label"),type:"FORMULA",func:"mvel",visible:b})}var d=b.Models.ObjectField,e=b.Collections.Formulas,f=["ATTRIBUTE","TEXT","NUMBER","MONEY","INTEGER","COUNT OF","FORMULA"];b.Collections=b.Collections||{},b.Collections.ObjectFields=b.MVC.Collection.extend({model:d,volumeField:new d({label:"Volume",name:"count",type:"NUMBER",visible:!0}),noneField:new d({label:"None",name:"none",type:"NONE",visible:!0}),defaults:{},initialize:function(a,c){var d;c=c||{},c.sourceId&&(this.sourceId=c.sourceId,delete c.sourceId),b.MVC.Collection.prototype.initialize.apply(this,arguments),d=this.where({type:"FORMULA"}),this.formulas=new e(d,{secure:this.secure,remote:this.remote,apiKey:this.apiKey,sourceId:this.sourceId}),this.listenTo(this.formulas,"add",this._onFormulaAdd),this.listenTo(this.formulas,"remove",this._onFormulaRemove),this.listenTo(this.formulas,"change",this._onFormulaChange),this.listenTo(this.formulas,"reset",this._onFormulasReset),this.listenTo(this.formulas,"sync",this._syncFormulas)},constructor:function(){b.MVC.Collection.prototype.constructor.apply(this,arguments),this._ensureVolumeField(),this._ensureNoneField(),this.on("all",this._ensureVolumeField),this.on("all",this._ensureNoneField)},_syncFormulas:function(){var a=this.formulas,b=a.map(c),d=this.where({type:"FORMULA"}),e=_.filter(d,function(a){var c=_.find(b,function(b){return b.id!==a.id});return"undefined"==typeof c});this.set(b,{remove:!1}),this.remove(e)},_onFormulaAdd:function(a){var b=c(a);this.add(b,{merge:!0})},_onFormulaRemove:function(a){var b=c(a);this.remove(b,{merge:!0})},_onFormulaChange:function(a){var b=c(a),d=this.get(b.id);d&&d.set(b.toJSON())},_onFormulasReset:function(a){var b=a.map(c);this.add(b)},_ensureVolumeField:function(a){var b=this.volumeField,c=this.get(b.id);c?null:this.add(b,a)},_ensureNoneField:function(a){var b=this.noneField,c=this.get(b.id);c?null:this.add(b,a)},setSource:function(a){return this.sourceId=a,this.formulas.setSource(a),this},url:function(){if(this.sourceId)return"service/sources/"+this.sourceId+"/attributes/";throw new Error("sourceId must be defined")},fetch:function(a){function c(){f++,2==f&&(e._ensureVolumeField(),e._syncFormulas(),g.resolve(e.toJSON()))}function d(a){_.each(a,function(a){if(a.distinctCount){var b={name:a.name,label:a.label,type:"COUNT OF",func:"distinct_count",visible:!0};e.add(b)}})}a=a||{},a.reset=!0;var e=this,f=0,g=$.Deferred(),h=this.formulas.fetch(),i=b.MVC.Collection.prototype.fetch.call(this,a);return i.done(function(a){d(a),c()}).fail(g.reject),h.done(c).fail(g.reject),g.promise()},filterByTypes:function(a){return this.remove(this.filter(function(b){return-1==a.indexOf(b.get("type"))&&"COUNT OF"!=b.get("type")})),this},removeBlueAttributes:function(){return this.remove(this.filter(function(a){return"ATTRIBUTE"!=a.get("type")})),this},filterHidden:function(){return this.remove(this.filter(function(a){return!a.get("visible")})),this},comparator:function(a){return f.indexOf(a.get("type"))}})}(window,Zoomdata),function(a,b){"use strict";var c=b.Models.SourceVisualization;b.Collections=b.Collections||{},b.Collections.SourceVisualizations=b.MVC.Collection.extend({defaults:{},initialize:function(a,c){return c=c||{},c.sourceId&&(this.sourceId=c.sourceId,delete c.sourceId),b.MVC.Collection.prototype.initialize.apply(this,arguments),this},setSource:function(a){return this.sourceId=a,this},model:c,url:function(){if(this.sourceId)return"service/sources/"+this.sourceId+"/visualizations";throw new Error("sourceId must be defined")}})}(window,Zoomdata),function(a,b){"use strict";b.Models=b.Models||{},b.Models.GroupBy=b.MVC.Model.extend({defaults:{name:"",limit:30,sort:{name:"count",dir:"Descending Value"}},setAttribute:function(a,b){return this.set({name:a},b),this},getAttribute:function(){return this.get("name")},getLabel:function(){return this.label},setLimit:function(a,b){return this.set({limit:+a},b),this},getLimit:function(){return+this.get("limit")},setSort:function(a,b){var c=_.clone(this.get("sort"));return c.name=a.name,c.dir=a.dir,this.set({sort:c},b),this},setSortMetric:function(a,b){var c=_.clone(this.get("sort"));return c.name=a,this.set({sort:c},b),this},setSortDirection:function(a,b){var c=_.clone(this.get("sort"));return c.dir=a,this.set({sort:c},b),this},toJSON:function(){var a=b.MVC.Model.prototype.toJSON.call(this,arguments),c=a.sort.dir,d=c;return"Ascending Value"===c&&(d="asc"),"Descending Value"===c&&(d="desc"),a.sort.dir=d,a.limit=+a.limit,a}})}(window,Zoomdata),function(a,b){"use strict";b.Collections=b.Collections||{},b.Collections.GroupBy=b.MVC.Collection.extend({model:b.Models.GroupBy,initialize:function(a,c){return c=c||{},b.MVC.Collection.prototype.initialize.apply(this,arguments),this.options=$.extend({},this.defaults,c),this.options.definition?(this.definition=_.extend({},this.options.definition),this.definition.config=this.definition.config?JSON.parse(this.definition.config):{},delete this.options.definition):this.definition={},c.silent=!1,this.on("add",this.initGroupByLabel,this),this},getName:function(){var a=this.definition.config,b=a&&a.groupNames?a.groupNames[0]:this.definition.name;return b},initGroupByLabel:function(a){var b=this.definition.config,c=b&&b.groupNames?b.groupNames.slice(0):[],d=this.models.indexOf(a);c&&"string"==typeof c[d]&&(a.label=c[d])},getAttribute:function(){var a=this.at(0),b="";return a&&(b=a.getAttribute()),b},getAttributes:function(){return this.pluck("name")},setAttribute:function(a,b){var c=this.at(0);return c&&c.setAttribute(a,b),this},setAttributes:function(a,b){var c=this;return Array.isArray(a)?(a.forEach(function(a,b){c.at(b)&&c.at(b).setAttribute(a,{silent:!0})}),b&&b.silent||this.trigger("change",this)):this.setAttribute(a,b),this},getLimit:function(){var a=this.at(0);return a.getLimit()},setLimit:function(a,b){var c=this.at(0);return c&&c.setLimit(a,b),this}})}(window,Zoomdata),function(a,b){"use strict";{var c=b.Collections.SourceVisualizations,d=b.Collections.ObjectFields,e=b.Collections.Formulas;b.Collections.Attributes}b.Models=b.Models||{},b.Models.Source=b.MVC.Model.extend({urlRoot:"service/sources",initialize:function(){b.MVC.Model.prototype.initialize.apply(this,arguments),this.visualizations=new c(this.attributes.visualizations,{secure:this.secure,remote:this.remote,apiKey:this.apiKey}),this.objectFields=new d(this.attributes.objectFields,{secure:this.secure,remote:this.remote,apiKey:this.apiKey}),this.formulaList=this.objectFields.formulas,this.on("sync",this._onSync),this._onSync()},_onSync:function(){this.updateVisualizations(),this.updateObjectFields()},_detectTypeViaJdbc:function(a,b){return-1!=a.indexOf("redshift.amazonaws.com")?b="REDSHIFT":-1!=a.indexOf("jdbc:oracle")?b="ORACLE":-1!=a.indexOf("jdbc:mysql")?b="MYSQL":-1!=a.indexOf("jdbc:sqlserver")?b="SQLSERVER":-1!=a.indexOf("jdbc:postgresql")?b="POSTGRESQL":a&&-1!=a.indexOf("jdbc:presto")&&(b="PRESTO"),b},_detectTypeViaPathFile:function(a,b){return b=a&&0===a.indexOf("s3")?"S3":"HDFS"},updateVisualizations:function(){var a=this.get("id");this.visualizations.setSource(a),this.visualizations.set(this.attributes.visualizations)},updateObjectFields:function(){var a=this.get("id"),b=new d(this.attributes.objectFields),c=new e(this.attributes.formulas);this.objectFields.setSource(a),this.objectFields.set(b.toArray()),this.formulaList.set(c.toArray())},validate:function(){this.attributes.visualizations=this.visualizations.toJSON()},saveViewCount:$.noop()})}(window,Zoomdata),function(a,b){"use strict";var c=b.Models.Source,d=["name","description","type","streamType","lastModified","viewsCount","storageConfiguration","enabled"].join(",");b.Collections=b.Collections||{},b.Collections.Sources=b.MVC.Collection.extend({url:"service/sources",model:c,initialize:function(a,c){return c=c||{},"boolean"==typeof c.lightweight&&(this.lightweight=c.lightweight,delete c.lightweight),b.MVC.Collection.prototype.initialize.apply(this,arguments)},filterByVisualizations:function(a){var b=[];return this.each(function(c){c.visualizations.where(a).length&&b.push(c)}),b},filterDisabled:function(){return this.remove(this.filter(function(a){return!a.get("enabled")})),this},fetch:function(a){var c=_.clone(a)||{};return("boolean"==typeof c.lightweight?c.lightweight:this.lightweight)&&(c.data=$.extend({},c.data,{fields:d})),b.MVC.Collection.prototype.fetch.call(this,c)}})}(window,Zoomdata),function(a,b){"use strict";b.Models=b.Models||{},b.Models.Metric=b.MVC.Model.extend({defaults:{label:"",name:"",func:""},initialize:function(a,c){return b.MVC.Model.prototype.initialize.apply(this,arguments),c=c||{},this.options=$.extend({},this.defaults,c),this._setModelId(),this},_setModelId:function(){var a,b=this.get("label");this.get("id")||(a=this.collection?this.collection.where({label:b}):[],this.set("id",b+"-"+a.length,{silent:!0}))},isCount:function(){return"count"==this.get("name")},isNone:function(){var a=this.get("name");return"none"==a}})}(window,Zoomdata),function(a,b){"use strict";var c=b.Models.Metric;b.Collections=b.Collections||{},b.Collections.Metrics=b.MVC.Collection.extend({model:c,initialize:function(a){return a=a||{},b.MVC.Collection.prototype.initialize.apply(this,arguments),this.options=$.extend({},this.defaults,a),this}})}(window,Zoomdata),function(a,b){"use strict";function c(a){return a.substring(0,a.lastIndexOf("."))}b.Models=b.Models||{},b.Models.ComponentSource=b.MVC.Model.extend({defaults:{},getConstructorName:function(){return c(this.get("name"))},url:function(){var a="string"==typeof this.remote?this.remote+"/":"",c="string"==typeof this.remote&&"boolean"==typeof this.secure?this.secure?"https://":"http://":"",d=b.MVC.Model.prototype.url.apply(this,arguments);return d+="/"+this.get("uploadDate"),c+a+d},load:function(a){var c=this,d=this.get("type"),e=$.Deferred(),f=this.url(),g=($("head"),a),h=this.apiKey||b.Utilities.getURLParameter("key");switch(d){case"text/template":f+=h?"?unwrapped=true&key="+h:"?unwrapped=true",$.ajax({cache:!0,dataType:"text",url:f}).done(function(a){$("<script type='text/template'>"+a+"</script>").appendTo($("head")),e.resolve()}).fail(function(a,b,d){console.error("Failed to load: "+c.get("name")+" with exception: "+d),e.reject(a)});break;case"text/css":h&&(f+="?key="+h),$.ajax({cache:!0,dataType:"text",url:f}).done(function(a){var b=c.get("visualizationId")||c.collection.visId,d=c.get("id");$(".widgetContent[data-visid="+b+"]").each(function(c,e){var f=$(e).parent();if(f.children('[data-componentid="'+d+'"]').length>0);else{var g=$('<style data-visid="'+b+'" data-componentid="'+d+'" scoped>'+a+"</style>").appendTo(f);g.scopedPolyFill&&g.scopedPolyFill()}});$("body style").length+$("body link").length;e.resolve()}).fail(function(a,b,d){console.error("Failed to load: "+c.get("name")+" with exception: "+d),e.reject(a)});break;default:f+="?namespace="+g+"&function="+this.getConstructorName(),$.ajax({cache:!0,dataType:"script",url:f}).done(function(){e.resolve()}).fail(function(a,b,d){console.error("Failed to load: "+c.get("name")+" with exception: "+d),e.reject(a)})}return e.promise()}})}(window,Zoomdata),function(a,b){"use strict";var c=b.Models.ComponentSource;b.Collections=b.Collections||{},b.Collections.ComponentSources=b.MVC.Collection.extend({model:c,initialize:function(a,c){return c=c||{},c.visId&&(this.setVisId(c.visId),delete c.visId),c.name&&(this.setVisName(c.name),delete c.name),b.MVC.Collection.prototype.initialize.apply(this,arguments),this},getComponentsNamespace:function(){return this.getVisName().replace(/[^\w]/g,"_")},load:function(a){var c=$.Deferred(),d=this.apiKey||b.Utilities.getURLParameter("key"),e="string"==typeof this.remote?this.remote+"/":"",f="string"==typeof this.remote&&"boolean"==typeof this.secure?this.secure?"https://":"http://":"";a=a||this.getComponentsNamespace(),requirejs.config({urlArgs:d?"key="+d:null,paths:{noext:f+e+"js/libs/require/noext"}});var g=[],h=[],i=[];a?this.forEach(function(a){var b=a.url();"text/javascript"===a.get("type")?(g.push("noext!"+b),h.push(a.getConstructorName())):i.push(a)}):(console.error("Namespace is not defined"),c.reject({message:"Namespace is not defined"}));var j=function(d){var e=0;console.log("Loading scripts:"),console.log(d),h.forEach(function(c){"function"==typeof b.Visualizations[a][c]?e++:null}),require.config({waitSeconds:100}),e==d.length?(console.log("Already Loaded: ",a),c.resolve()):require(d,function(){for(var d=0;d<arguments.length;d++){var e=arguments[d],f=h[d];b.Visualizations[a][f]=e}c.resolve()},function(a){c.reject(a)})},k=i.length,l=g.slice(0);if(k>0){var m=0;console.log("Loading resources:"),console.log(i),i.forEach(function(b){b.load(a).done(function(){m++,m==k&&j(l)}).fail(function(a){c.reject(a)})})}else j(l);return c.promise()},execute:function(){this.each(function(){})},url:function(){if(this.visId)return"service/visualizations/"+this.visId+"/source/";throw new Error("Visualization id for the component is not defined")},setVisName:function(a){this.name=a},getVisName:function(){return this.name},setVisId:function(a){this.visId=a}})}(window,Zoomdata),function(a,b){"use strict";b.Models=b.Models||{},b.Models.LibrarySource=b.Models.ComponentSource.extend({defaults:{},initialize:function(a){b.Models.ComponentSource.prototype.initialize.apply(this,arguments),"string"==typeof a&&this.set("name",a)},idAttribute:"id",url:function(){var a="string"==typeof this.remote?this.remote+"/":"",b="string"==typeof this.remote&&"boolean"==typeof this.secure?this.secure?"https://":"http://":"";return b+a+"service/visualizations/libs/"+this.id+"/"+(this.get("uploadDate")||"")},load:function(){var a=this,c=this.get("type"),d=$.Deferred(),e=this.url(),f=($("head"),this.apiKey||b.Utilities.getURLParameter("key"));switch(c){case"text/template":e+=f?"?unwrapped=true&key="+f:"?unwrapped=true",$.ajax({cache:!0,dataType:"text",url:e}).done(function(a){$("<script type='text/template'>"+a+"</script>").appendTo($("head")),d.resolve()}).fail(function(b,c,e){console.error("Failed to load: "+a.get("name")+" with exception: "+e),d.reject(b)});break;case"text/css":f&&(e+="?key="+f),$.ajax({cache:!0,dataType:"text",url:e}).done(function(a){$("<style>"+a+"</style>").appendTo($("head")),d.resolve()}).fail(function(b,c,e){console.error("Failed to load: "+a.get("name")+" with exception: "+e),d.reject(b)});break;default:$.ajax({cache:!0,dataType:"script",url:e+"/"}).done(function(){d.resolve()}).fail(function(b,c,e){console.error("Failed to load: "+a.get("name")+" with exception: "+e),d.reject(b)})}return d.promise()}})}(window,Zoomdata),function(a,b){"use strict";var c=b.Models.LibrarySource;b.Collections=b.Collections||{},b.Collections.LibrariesSources=b.Collections.ComponentSources.extend({model:c,load:function(){var a=$.Deferred(),c=b.Utilities.getURLParameter("key")||this.apiKey,d=[],e=!1,f=[];return this.forEach(function(a){var b=a.url();-1!==b.indexOf("d3.v3.min.js")&&(e=!0,d.push(b)),f.push(b)}),requirejs.config({urlArgs:c?"key="+c:null}),console.log("Loading libraries:"),console.log(f),e?requirejs(d,function(b){window.d3=b,requirejs(f,function(){a.resolve()},function(b){console.error(f," failed to load."),a.reject(b)})},function(b){console.error(d," failed to load."),a.reject(b)}):requirejs(f,function(){a.resolve()},function(b){console.error(b.message),a.reject(b)}),a.promise()},url:function(){return"service/visualizations/libs/"}})}(window,Zoomdata),function(a,b){"use strict";b.Components=b.Components||{},b.Components.MetricFormatter=function(a,b){b="NONE"===b?!1:b;var c=a,d=!1,e=b,f=function(a){return d||(d=new Date(1*a)),d};this.format=function(a){var b=null;switch(d=!1,c){case"MONEY":b=$.formatNumber(a,{format:"$#,##0.00",locale:"us"});break;case"TIME":b=new Date(a).toLocaleString();break;case"DATE":b=f(a).getDay();break;case"MINUTE":if(isNaN(1*a))return"";var g=f(a).getHours(),h=f(a).getMinutes(),i=g>12?g-12:g||12;b=(10>i?"0":"")+i+":"+(10>h?"0"+h:h)+(g>=12?" pm":" am");break;case"HOUR":if(isNaN(1*a))return"";var g=f(a).getHours(),i=g>12?g-12:g||12;b=(10>i?"0":"")+i+(g>=12?" pm":" am");break;case"DAY":if(isNaN(1*a))return"";var j="DAY"==e?f(a).getUTCDate():f(a).getDate(),k="DAY"==e?f(a).getUTCMonth()+1:f(a).getMonth()+1;b=(10>k?"0"+k:k)+" / "+(10>j?"0"+j:j);break;case"WEEK":if(isNaN(1*a))return"";var j="DAY"==e?f(a).getUTCDate():f(a).getDate(),k="DAY"==e?f(a).getUTCMonth()+1:f(a).getMonth()+1;b=(10>k?"0"+k:k)+" / "+(10>j?"0"+j:j);break;case"MONTH":if(isNaN(1*a))return"";var k="DAY"==e?f(a).getUTCMonth()+1:f(a).getMonth()+1,l="DAY"==e?f(a).getUTCFullYear():f(a).getFullYear();b=l+" / "+(10>k?"0"+k:k);break;case"YEAR":if(isNaN(1*a))return"";b="DAY"==e?f(a).getUTCFullYear():f(a).getFullYear();break;default:Math.abs(a)>=1e-4&&Math.abs(a)<=1?b=$.formatNumber(a,{format:"0.####",locale:"us"}):Math.abs(a)>1?b=$.formatNumber(a,{format:"#,##0.##",locale:"us"}):(null===a&&(a=0),b=a?a.toExponential(4).toString():a.toString())}return b}}}(window,Zoomdata),function(a,b){"use strict";function c(a,b){this.setAccessTo(a,b),this.setColorRangeType("gradient")}var d=b.Components.MetricFormatter;b.Components=b.Components||{},b.Components.MetricAccessor=c,c.prototype.setAccessTo=function(a,b){return this.metric=a,this.metric.colors=this.metric.colors||this.metric.savedColors,this.objectField=b,this._updateFormatter(),this},c.prototype._updateDomain=function(a,b){var c,d,e,f,g,h=this,i=b;if(this.objectFields)this.domainValue=this.objectFields.map(function(a){return a.get("label")});else{if(c=d3.extent(a,function(a){return h.raw(a)}),e=(c[1]-c[0])/i,"gradient"!==this.colorRangeType&&(i+=1),0===e)return void(this.domainValue=c.slice(0));if(this.domainValue=this.domainValue||[],4===this.domainValue.length&&"gradient"!==this.colorRangeType)f=this.domainValue[1],g=this.domainValue[2],f<c[0]&&(f=c[0]),g>c[1]&&(g=c[1]),f>g&&(f=g),this.domainValue[0]=c[0],this.domainValue[1]=f,this.domainValue[2]=g,this.domainValue[3]=c[1];else{d=c[0],this.domainValue=[];do this.domainValue.push(d),d+=e;while(this.domainValue.length<i);this.domainValue[this.domainValue.length-1]=c[1]}}},c.prototype._recountDomain=function(){this._formatter=new d(this.objectField.type)
},c.prototype._updateFormatter=function(){this._formatter=new d(this.objectField.type)},c.prototype.isCount=function(){return"count"===this.metric.name},c.prototype.isNone=function(){return"none"==this.metric.name},c.prototype.raw=function(a){var b,c,d=this.isCount(),e=this.isNone();return e?0:(b=this.metric.name,c=d?null:this.metric.func,d&&a.hasOwnProperty("current")&&a.current.hasOwnProperty("count")?a.current.count:a.hasOwnProperty("current")&&a.current.hasOwnProperty("metrics")&&a.current.metrics.hasOwnProperty(b)&&a.current.metrics[b].hasOwnProperty(c)&&a.current.metrics?a.current.metrics[b][c]:null)},c.prototype.formatted=function(a,b){var c=isNaN(a)?this.raw(a):a,d=this.objectField.type;return"count"===d?c:this._formatter.format(c,b)},c.prototype.get=function(a){return this.objectField[a]},c.prototype._updateFormatter=function(){this._formatter=new d(this.objectField.type)},c.prototype.get=function(a){return this.objectField[a]},c.prototype.colorRange=function(){var a=this,b=[];return"none"===this.metric.name?_.each(this.metric.colors,function(){b.push(a.metric.colors[0])}):b=this.metric.colors,_.clone(b)},c.prototype.minimum=function(){return this.domainValue?this.domainValue[0]:0},c.prototype.maximum=function(){return this.domainValue?this.domainValue[this.domainValue.length-1]:0},c.prototype.domain=function(){return _.clone(this.domainValue)},c.prototype.setColorRangeType=function(a){this.colorRangeType=a}}(window,Zoomdata),function(a,b){"use strict";b.Models=b.Models||{},b.TIME_WINDOW_SCALE={HOUR:"HOUR",ROLLING_HOUR:"ROLLING_HOUR",DAY:"DAY",WEEK:"WEEK",MONTH:"MONTH",QUARTER:"QUARTER",YEAR:"YEAR",CUSTOM:"CUSTOM",ALL:"ALL"},b.Models.TimeWindowScale=b.MVC.Model.extend({idAttribute:"value"})}(window,Zoomdata),function(a,b){"use strict";var c=b.Utilities,d=c.time.millisecondsIn,e=b.Collections.Metrics,f=(b.Components,b.Models.GroupBy,b.Collections.GroupBy);b.Models=b.Models||{},b.Models.Time=b.MVC.Model.extend({defaults:{paused:!1,speed:1,minSpeed:1,timeWindow:"ROLLING_HOUR",time:null,tz:c.determineTimeZone(),min:0,max:(new Date).getTime(),speedValues:[1,10,60,3600,86400,864e3,5184e3],speedNames:["1x","10x","60x","1h/sec","1d/sec","10d/sec","60d/sec"],live:!1},startTimeFunctions:{},initialize:function(a){_.bindAll(this,"firstMinuteTime","firstHourTime","rollingTime","getStartTime","getEndTime"),this.set("LIVE"==a.time?{time:(new Date).getTime(),live:!0}:"number"!=typeof a.time?{time:c.getTimestamp(a.time),paused:!0}:{time:a.time,paused:!0}),this.on("change:timeWindow",this._updateLimits)},firstMinuteTime:function(a){var b=new Date(a);return b.setMinutes(0,0,0),b.getTime()},firstHourTime:function(a){var b=new Date(a);return b.setHours(0,0,0,0),b.getTime()},rollingTime:function(a){return a-d.hour},getStartTimeStamp:function(){return this.get("fromTime")},getEndTimeStamp:function(){var a=this.get("time");return a},getStartTime:function(a,b,d){var e=this.get("ALL"==this.get("timeWindow")?"min":"fromTime");return a?c.formattedDate(e,b)+" "+c.timeZoneFromTime(e):"DAY"===d?c.formattedDateOnly(e,b,!0):c.formattedDate(e,b)},getEndTime:function(a,b,d){var e=this.get("time");return a?c.formattedDate(e,b)+" "+c.timeZoneFromTime(e):"DAY"===d?c.formattedDateOnly(e,b):c.formattedDate(e,b)},formattedCustomDate:function(a,b,d){return b=1*b,a?c.formattedDate(b,d)+" "+c.timeZoneFromTime(b):c.formattedDate(b,d)},getStartTimeForComparisonPeriod:function(a){var b=this.get("fromTime"),d=new Date(b);if("YESTERDAY"===a)d.setDate(d.getDate()-1);else if("WEEK_AGO"===a)d.setDate(d.getDate()-7);else{var e=a.split("-"),f=new Date(1*e[0],1*e[1]-1,1*e[2]);f.setHours(d.getHours()),f.setMinutes(d.getMinutes()),f.setSeconds(d.getSeconds()),d=f}return b=d&&d.getTime()||b,c.formattedDate(b,!0)+" "+c.timeZoneFromTime(b)},getEndTimeForComparisonPeriod:function(a){var b=this.get("time"),d=new Date(b);if("YESTERDAY"===a)d.setDate(d.getDate()-1);else if("WEEK_AGO"===a)d.setDate(d.getDate()-7);else{var e=a.split("-"),f=new Date(1*e[0],1*e[1]-1,1*e[2]);f.setHours(d.getHours()),f.setMinutes(d.getMinutes()),f.setSeconds(d.getSeconds()),d=f}return b=d&&d.getTime()||b,c.formattedDate(b,!0)+" "+c.timeZoneFromTime(b)},getStartTimeForTimeWindowScaleAndComparisonPeriod:function(a,b){var d=this.get("fromTime"),e=new Date(d);if("YESTERDAY"===b)e.setDate(e.getDate()-1);else if("WEEK_AGO"===b)e.setDate(e.getDate()-7);else{var f=b.split("-"),g=new Date(1*f[0],1*f[1]-1,1*f[2]);g.setHours(e.getHours()),g.setMinutes(e.getMinutes()),g.setSeconds(e.getSeconds()),e=g}return"HOUR"===a?(e.setMinutes(0),e.setSeconds(0)):"DAY"===a&&(e.setHours(0),e.setMinutes(0),e.setSeconds(0)),d=e&&e.getTime()||d,c.formattedDate(d,!0)+" "+c.timeZoneFromTime(d)},getEndTimeForTimeWindowScaleAndComparisonPeriod:function(a,b){var d=this.get("time"),e=new Date(d);if("YESTERDAY"===b)e.setDate(e.getDate()-1);else if("WEEK_AGO"===b)e.setDate(e.getDate()-7);else{var f=b.split("-"),g=new Date(1*f[0],1*f[1]-1,1*f[2]);g.setHours(e.getHours()),g.setMinutes(e.getMinutes()),g.setSeconds(e.getSeconds()),e=g}return"HOUR"===a?(e.setMinutes(59),e.setSeconds(59)):"DAY"===a&&(e.setDate(e.getDate()+1),e.setHours(0),e.setMinutes(59),e.setSeconds(59),e.setHours(-1)),d=e&&e.getTime()||d,c.formattedDate(d,!0)+" "+c.timeZoneFromTime(d)}}),b.Models.Datum=b.MVC.Model.extend({idAttribute:"group"});var g={"Descending Value":"valueDescending","Ascending Value":"valueAscending",Alphabetical:"alphabetical","Reverse Alphabetical":"reverseAlphabetical"},h={valueDescending:"Descending Value",valueAscending:"Ascending Value",alphabetical:"Alphabetical",reverseAlphabetical:"Reverse Alphabetical"},i=b.Models.Filter,j=b.Collections.Filters;b.Models.State=b.MVC.Model.extend({defaults:{groupBy:null,timeWindowScale:"ROLLING_HOUR",comparison:!1,comparisonPeriod:"YESTERDAY",sort:{dir:"DESC",name:"count"},limit:1e3,clientSort:"valueDescending"},initialize:function(a,c){c||(c={});var d,h=this,i=this.defaults,k={},l=c.config,m=c.config&&c.config.get("source"),n=m.variables,o=m.filters||[],p=m.minSpeed?m.minSpeed:1,q=p>1?p:1,r=m.startFrom;switch(this.options=this.options||{},c.config&&(this.config=c.config,delete c.config),c.objectFields&&(this.options.fields=c.objectFields.toJSON(),delete c.objectFields),"BEGINNING"===r&&(d=this.options.fields.filter(function(a){return a.name===m.date})[0],d&&(r=d.min,"ROLLING_HOUR"===m.timeWindowScale&&(r+=36e5))),this.metrics=new e(this._retrieveMetrics()),p){case 86400:i.timeWindowScale="WEEK";break;case 3600:i.timeWindowScale="DAY";break;default:i.timeWindowScale="ROLLING_HOUR"}this.time=new b.Models.Time({time:r,speed:q,minSpeed:p,timeWindow:m.timeWindowScale}),this.on("change:timeWindowScale",function(a,b){h.time.set("timeWindow",b)}),k.limit=n.Limit,k.sort=this.metrics.size()>0?"Bottom"==n["Limit Results by Rank"]?{name:this.metrics.at(0).get("name")||"count",dir:"asc"}:{name:this.metrics.at(0).get("name")||"count",dir:"desc"}:{name:"count",dir:"desc"},this.queryBuilderSource=m.variables.queryBuilderSource,this.filters=new j(o),this.groupBy=new f(this._retrieveGroupBy(),this._retrieveGroupByDefinition()),("TRENDS"===l.get("type")||"MULTI_METRIC_TREND"===l.get("type"))&&(m.timeTrendStep=m.timeTrendStep||"DAY"),k.timeTrendStep=m.timeTrendStep,k.timeWindowScale=m.timeWindowScale||i.timeWindowScale,k.comparison="On"===n.Comparison,k.comparisonPeriod=n._comparisonPeriod||m.comparisonPeriod||"YESTERDAY",k.sort=k.sort||i.sort,k.clientSort=g[n.Sort]||i.clientSort,k.delay=m.delay,k.delayUnit=m.delayUnit,k.timestampField=m.date,this.set(k)},_retrieveGroupByDefinition:function(){var a=this._retrieveGroup(),b=this._retrieveGroups();return{definition:b||a}},_retrieveGroupBy:function(){var a=this,b=this.config,c=[],d="",e=b&&b.get("source"),f=e.variables,g=a._retrieveGroup(),h=a._retrieveGroups();if(h)if(f&&f[h.name])c=JSON.parse(f[h.name]);else if(d=h.defaultValue,d&&""!==d)c=[JSON.parse(h.defaultValue)];else{var i=JSON.parse(h.config).groupLevel||2;c=a._getDefaultGroups(i)}else g&&(f&&f[g.name]?c=[JSON.parse(f[g.name])]:(d=g.defaultValue,c=d&&""!==d?[JSON.parse(g.defaultValue)]:a._getDefaultGroup()));return("TRENDS"===b.get("type")||"MULTI_METRIC_TREND"===b.get("type"))&&(c=[{name:e.date||"_ts",limit:10,sort:{name:"date",dir:"Ascending Value"}}]),("ZOOMABLE_MAP"===b.get("type")||"ZOOMABLE_MAP"===b.get("templateType"))&&(c=[{name:f.State,limit:1e4,sort:{name:"count",dir:"Descending Value"}}]),c},_getDefaultGroup:function(){var a,b,c="ATTRIBUTE",d={name:"",limit:10,sort:{name:"count",dir:"Descending Value"}};return a=this.options.fields,b=_.findWhere(a,{type:c}),d.name=b?b.name:"none",d},_getDefaultGroups:function(a){var b,c="ATTRIBUTE",d=[];b=this.options.fields;for(var e=0;e<b.length;e++){var f=b[e];if(f.type===c){var g={name:f.name,limit:10,sort:{name:"count",dir:"Descending Value"}};if(d.push(g),d.length>=a)break}}return d},_retrieveGroup:function(){var a=this.config.get("variables"),b=_.findWhere(a,{type:"group"});return b||(b=!1),b},_retrieveGroups:function(){var a=this.config.get("variables"),b=_.findWhere(a,{type:"multi-group"});return b||(b=!1),b},_retrieveMetrics:function(){function a(a){var b=a.name,c=e[b]||"none",g=c.split(":"),h=g[0],i=d.filter(function(a){return a.name===h})[0],j=g[1]||i.func||("count"!==h&&"none"!=h?"sum":null),k={};g[2]&&(k=JSON.parse(g[2].replace(/\|/g,":")),$.extend(a,k)),f.push($.extend(k,{label:b,name:h,func:j,id:b}))}function b(b){var c=b.name,g=e[c].split(" ");"color"===b.metricType?a(b):g.forEach(function(a){var b=a.split(":")[0],e=d.filter(function(a){return a.name===b})[0],g=a.split(":")[1]||e.func;f.push({label:c,name:b,func:g,id:c+"-"+f.length})})}var c=this.config.get("variables"),d=this.options.fields||[],e=this.config.get("source").variables,f=[];return c.forEach(function(c){"metric"==c.type?a(c):"multi-metric"==c.type?b(c):null}),f},addFilter:function(a,b){var c,d,e,f,g=this.filters;if(b=b||{},Array.isArray(a))return this.filters.add(a,_.extend({merge:!0},b)),this;if(a instanceof i?null:a=new i(a),d=a.get("path"),f=a.get("operation"),e=a.get("value"),c=g.findWhere({path:d})){var h=!1;b.silent=!0,"number"==typeof e||"number"==typeof c.get("value")||"number"==typeof e[0]?(c.set("value",e,b),h=!0):(_.each(e,function(a){c.hasAttribute(a,b)||(h=!0,c.addAttribute(a,b))}),_.each(c.get("value"),function(d){a.hasAttribute(d,b)||c.removeAttribute(d,b)})),c.get("operation")!==f&&(h=!1,c.set("operation",f,b)),h&&c.trigger("change")}else this.filters.add(a,b);return this},addFilters:function(a){var b=this;a=_.sortBy(a,function(a){return b.filters.findWhere({path:a.path})}),a.forEach(function(c,d){b.addFilter(c,{silent:d!==a.length-1})})},removeFilter:function(a,b){function c(a){var c,e,f,g=d.filters;return a instanceof i?null:a=new i(a),e=a.get("path"),f=a.get("value"),c=g.findWhere({path:e}),c&&1===f.length&&c.hasAttribute(f[0],b)?(c.removeAttribute(f[0],b),d):"undefined"==typeof f[0]||f.length>1?(d.filters.remove(c),d):void 0}var d=this;if($.isArray(a))for(var e=0;e<a.length;e++)c(a[e]);else c(a);return this},setFilter:function(a,b){var c,d,e=this.filters;a instanceof i?null:a=new i(a),d=a.get("path"),c=e.findWhere({path:d}),c?c.set(a.attributes,b):this.addFilter(a,b)},toRequest:function(){var a=this.time.get("live"),b=this.config.get("source"),c=this.queryBuilderSource||b.variables.queryBuilderSource,d=b.variables._limitPeriod;d&&(b.variables._TempLimitPeriod=d,delete b.variables._limitPeriod);var e=$.extend({},this.attributes),f=(this.config.get("source").startFrom,this.get("timestampField")),g=(this.get("timeWindowScale"),{});e.time=!f||a?null:this.time.get("time"),e.tz=86400==this.time.get("minSpeed")||"DAY"===b.dataResolution?"GMT":this.time.get("tz"),e.speed=this.time.get("speed"),g.pauseAfterRead=this.time.get("paused");var h="count",i="desc";this.get("sort")&&(delete e.sort,g=g||{},this.metrics.size()>0&&(h=this.metrics.at(0).get("name")),i=this.get("sort").dir,g.sort={name:h,dir:i}),this.groupBy&&(delete e.groupBy,g=g||{},g.group={},g.group.limit=1,g.group.fields=this.groupBy.toJSON(),g.group.fields.forEach(function(a){g.group.limit=g.group.limit*+a.limit;var b=_.clone(a.sort);b.name="count"===b.name?h:b.name,a.sort=b}),1===g.group.fields.length&&g.group.limit&&delete g.group.limit,g.group.metrics=g.group.metrics||[],this.metrics.each(function(a){a.isCount()||a.isNone()||g.group.metrics.push({name:a.get("name"),func:a.get("func").toUpperCase()})}),this.get("timeTrendStep")&&(delete e.timeTrendStep,g.group.timeTrendStep=this.get("timeTrendStep"))),this.filters.length>0&&(delete g.filters,g=g||{},g.filters=this.filters.toRequest()),this.get("sort")&&(delete e.sort,delete g.sort),c&&(g=g||{},g.queryBuilderSource=c);var j=this.get("comparisonPeriod");return e.comparisonPeriod=this.dataToFormatString(this.getTimeByType(e.time,j)),g&&(e.cfg=g),e.volume?delete e.volume:null,e.color?delete e.color:null,e.timestampField=f,e},getTimeByType:function(a,b){var c=b,d=a&&a<=new Date?new Date(a):new Date,e=new Date(d);e.setDate(d.getDate()-1);var f=new Date(d);f.setDate(d.getDate()-7);var g=new Date(d);g.setDate(d.getDate()-30);var h=new Date(d);h.setDate(d.getDate()-365);var i=new Date(d);switch(i.setDate(d.getDate()-365),b){case"YESTERDAY":c=e;break;case"WEEK_AGO":c=f;break;case"LAST_MONTH":c=g;break;case"MONTH_YEAR_AGO":c=h;break;case"LAST_YEAR":c=i}return c},dataToFormatString:function(a){var b="";return b=a.getFullYear?a.getFullYear()+"-"+(a.getMonth()+1<10?"0":"")+(a.getMonth()+1)+"-"+(a.getDate()<10?"0":"")+a.getDate():a},isSingleGroupBy:function(){var a=!0,b=this.groupBy;return b.length>1&&(a=!1),a},convertToBookmark:function(){var a=this,b=this.config.get("source"),c=this.metrics.pluck("label"),d=$.extend({},b,{filters:this.filters.toJSON(),timeWindowScale:this.get("timeWindowScale"),timeTrendStep:this.get("timeTrendStep"),startFrom:this.time.getEndTime(),sourceId:b.sourceId,sourceName:b.sourceName});if(d.variables=d.variables||{},d.variables.Sort=h[this.attributes.clientSort],d.variables.Comparison=this.get("comparison")?"On":"Off",d.variables._comparisonPeriod=this.get("comparisonPeriod"),this.isSingleGroupBy()){var e="",f=null,g=_.findWhere(a.config.get("variables"),{type:"group"});g&&(e=g.name,f=this.groupBy.at(0),d.variables[e]=JSON.stringify(f.toJSON()))}else{var e="",f=null,g=_.findWhere(a.config.get("variables"),{type:"multi-group"});g&&(e=g.name,f=this.groupBy,d.variables[e]=JSON.stringify(f.toJSON()))}return c.forEach(function(a){d.variables[a]=""}),this.metrics.map(function(b){var c,e,f=b.get("label"),g=b.get("name"),h=b.get("func");d.variables.hasOwnProperty(f)?d.variables[f]+=(d.variables[f].length>0?" ":"")+("count"==g?g:g+":"+h):null,a.colorMetric&&a.colorMetric.id===b.id&&(1===d.variables[f].split(":").length&&(d.variables[f]+=":"),c=a.colorMetric.get("colors")||a.colorMetric.get("savedColors"),"string"!=typeof c&&(c=JSON.stringify(c)),"distinct"===a.divergingColorRange&&(e=a.colorMetricDomain),d.variables[f]+=":"+JSON.stringify({colorNumb:a.colorNumb,legendType:a.legendType,divergingColorRange:a.divergingColorRange,autoShowColorLegend:a.colorMetric.get("autoShowColorLegend"),savedColors:c,domain:e}).replace(/:/g,"|"))}),d},isTimeTrends:function(){return"TRENDS"===this.config.get("type")||"MULTI_METRIC_TREND"===this.config.get("type")||"TRENDS"===this.config.get("templateType")||"MULTI_METRIC_TREND"===this.config.get("templateType")}})}(window,Zoomdata),function(a,b){"use strict";b.Utilities;b.Collections=b.Collections||{},b.Collections.Graph=Backbone.Collection.extend({model:b.Models.Datum,metric:null,initialize:function(a,b){_.bindAll(this,"setSortOrder"),this.metric=b.metric},setSortOrder:function(a){this.comparator="valueAscending"===a?function(a){return this.metric.raw(a.attributes)}:"valueDescending"===a?function(a){return-this.metric.raw(a.attributes)}:"alphabetical"===a?function(a){return a.get("group")}:"reverseAlphabetical"===a?function(a,b){return a.get("group")>b.get("group")?-1:a.get("group")<b.get("group")?1:0}:"date"===a?function(a){return 1*a.get("group")}:null,this.comparator&&this.sort()}})}(window,Zoomdata),function(a,b){"use strict";var c={},d=b.Utilities;c.Slider=b.MVC.View.extend({defaults:{orientation:"vertical",range:!1,value:50,min:0,max:100},initialize:function(a){var c=this,d={start:function(a,b){c.trigger("slide:start",b.value,c),c.data.set("value",b.value,{silent:!0})},stop:function(a,b){c.trigger("slide:stop",b.value,c),c.data.set("value",b.value,{silent:!0})},change:function(a,b){c.trigger("slide:change",b.value,c),c.data.set("value",b.value,{silent:!0})}};this.options=$.extend({},this.defaults,a),this.data=new b.MVC.Model({min:this.options.min,max:this.options.max,value:this.options.value}),this.$el.slider($.extend({},d,this.options)),this.listenTo(this.data,"change",this.render)},render:function(){return this.$el.slider(this.data.attributes),this},value:function(a){function b(){return d.data.get("value")}function c(a){d.data.set("value",a)}var d=this;return"number"==typeof a?(c(a),this):b()},min:function(a){function b(){return d.data.get("min")}function c(a){d.data.set("min",a)}var d=this;return"number"==typeof a?(c(a),this):b()},max:function(a){function b(){return d.data.get("max")}function c(a){d.data.set("max",a)}var d=this;return"number"==typeof a?(c(a),this):b()}});var e=_.template('            <button class="arrow-left btn" title="left" value="left"><i class="icon-arrow-left"></i></button>            <button class="arrow-right btn" title="right" value="right"><i class="icon-arrow-right"></i></button>        '),f=_.template('            <div class="btn-group-vertical">                <button class="arrow-up btn" title="up" value="up"><i class="icon-arrow-up"></i></button>                <button class="arrow-down btn" title="down" value="down"><i class="icon-arrow-down"></i></button>            </div>        '),g=_.template('            <button class="arrow-left btn" title="left" value="left"><i class="icon-arrow-left"></i></button>            <div class="btn-group-vertical">                <button class="arrow-up btn" title="up" value="up"><i class="icon-arrow-up"></i></button>                <button class="arrow-down btn" title="down" value="down"><i class="icon-arrow-down"></i></button>            </div>            <button class="arrow-right btn" title="right" value="right"><i class="icon-arrow-right"></i></button>        ');c.Arrows=b.MVC.View.extend({_horizontalTemplate:e,_verticalTemplate:f,_allTemplate:g,defaults:{direction:"all"},events:{'click button[value="up"]':"_onUpClick",'click button[value="down"]':"_onDownClick",'click button[value="left"]':"_onLeftClick",'click button[value="right"]':"_onRightClick"},initialize:function(a){switch(this.childViews=[],this.options=$.extend({},this.defaults,a),this.options.direction){case"vertical":this.template=this._verticalTemplate;break;case"horizontal":this.template=this._horizontalTemplate;break;case"all":default:this.template=this._allTemplate}},render:function(){return this.$el.html(this.template()),this},_onUpClick:function(){this.trigger("translate:up")},_onDownClick:function(){this.trigger("translate:down")},_onLeftClick:function(){this.trigger("translate:left")},_onRightClick:function(){this.trigger("translate:right")}}),c.Zoomable=b.MVC.View.extend({className:"zoomable",defaults:{snapToEdges:!0,maxScale:!1,minScale:!1,eventNamespace:"zoomable:",mouseWheel:!1},initialize:function(a){var c=this;this._enabled=!0,this.childViews=[],this.options=$.extend({},this.defaults,a),this.$content=$('<div class="zoomable-content"></div>').appendTo(this.$el),b.Utilities.MODE.NATIVE!==b.Utilities.mode()&&(this._zoomHammer=this.$content.zoomHammer(this.options).data("zoomHammer"),this.$el.on("zoomable:transformstart",function(){c.trigger("transform:start",c)}),this.$el.on("zoomable:transformend",function(){c.trigger("transform:end",c)}),this.$el.on("zoomable:transform",function(){c.trigger("transform:transition",c)}))},disable:function(a){var b=a?a.resizeStart:null;this._zoomHammer&&this._zoomHammer.disable(),this.$el.hasClass("zoomable-disabled")||b?null:this.$el.addClass("zoomable-disabled"),this._enabled=!1},enable:function(a){var b=a?a.resizeStop:null;this._zoomHammer&&this._zoomHammer.enable(),this.$el.hasClass("zoomable-disabled")&&!b?this.$el.removeClass("zoomable-disabled"):null,this._enabled=!0},isEnabled:function(){return this._enabled},getMinScale:function(){return this._zoomHammer&&this._zoomHammer.parsedScale().min||1},setMinScale:function(a){return a||(a=this._zoomHammer.options.minScale),this._zoomHammer.options.minScale=a,this},getMaxScale:function(){return this._zoomHammer&&this._zoomHammer.parsedScale().max||1},setMaxScale:function(a){return a||(a=this._zoomHammer.options.maxScale),this._zoomHammer.options.maxScale=a,this},getScale:function(){return this._zoomHammer&&this._zoomHammer.scale()||1},getTranslation:function(){return this._zoomHammer&&this._zoomHammer.translate()||null},zoom:function(a,b,c){return this._zoomHammer&&this._zoomHammer.move({scale:a},b,c),this},translate:function(a,b){return a=a||{},"number"==typeof a.x?a.left=a.x:null,"number"==typeof a.y?a.top=a.y:null,delete a.x,delete a.y,this._zoomHammer&&this._zoomHammer.move(a,b),this},refresh:function(a,b){this._zoomHammer&&this._zoomHammer.adjust(a,b)},render:function(a){return this.$content.html(a),this}});var h=_.template('        <div class="modal hide fade <%= customClass %>" >            <div class="modal-header">                <button title="Close" value="dialog-reject" class="close">&times;</button>                <h3 class="dialog-head pull-left"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body">            </div>            <div class="modal-footer dialog-controls">                <button title="<%= rejectButtonTitle %>" value="dialog-reject" class="btn btnNo" aria-hidden="true"><%= rejectButtonLabel %></button>                <button title="<%= acceptButtonTitle %>" value="dialog-accept" class="btn btn-primary btnYes"><%= acceptButtonLabel %></button>            </div>        </div>    ');c.Dialog=b.MVC.View.extend({template:h,defaults:{mode:"dialog",draggable:!1,wide:!1,modal:"static",rejectButtonLabel:"Close",acceptButtonLabel:"Accept",rejectButtonTitle:"Close",acceptButtonTitle:"Accept",containment:"body",docked:!0,customClass:""},events:{'click button[value="dialog-reject"]':"hide",'click button[value="dialog-accept"]':"accept",'click button[value="dialog-back"]':"back"},initialize:function(a){b.MVC.View.prototype.initialize.apply(this,arguments),_.bindAll(this,"back");var c=this;switch(a=a||{},a.actions&&(this.actions=a.actions,delete a.actions),a.template&&(this.template=a.template,delete a.template),this.settings=$.extend({},this.defaults,a),this.removeOtherDocked(),$(".modal-backdrop.zd-overlay").remove(),this.setElement(this.template({rejectButtonLabel:this.settings.rejectButtonLabel,acceptButtonLabel:this.settings.acceptButtonLabel,rejectButtonTitle:this.settings.rejectButtonTitle,acceptButtonTitle:this.settings.acceptButtonTitle,customClass:this.settings.customClass})),this.$el.appendTo("body"),this.$el.modal({show:!1,backdrop:this.settings.modal,keyboard:!1}),this.settings.mode){case"palette":this.$(".dialog-controls").hide();break;case"alert":this.$('button[value="dialog-accept"]').hide()}this.$head=this.$(".dialog-head"),this.$body=this.$(".dialog-body"),this.$actions=$('<div class="zd-dialog-actions btn-group btn-block"></div>'),this.setActions(a.actions),this.settings.draggable&&this.$el.draggable({handle:this.$(".dialog-head, .header"),start:function(){c.$el.removeClass("fade"),"function"==typeof c.settings.draggable.onDragStart&&c.settings.draggable.onDragStart.apply(this,arguments)},stop:function(){c.$el.addClass("fade"),"function"==typeof c.settings.draggable.onDragStop&&c.settings.draggable.onDragStop.apply(this,arguments)},cursor:"move",containment:this.settings.containment}),this.settings.wide&&this.goWide(),this.$el.one("hidden",function(){c.trigger("dialog:rejected"),c.remove(),c.onReject(),c.onHide()}),this.listenTo(b.eventDispatcher,"visualization:add",function(){this.hide()}),this.listenTo(b.eventDispatcher,"admin-control:clicked",this.removeOtherDocked)},removeOtherDocked:function(){var a=$(".modal.zd-palette.docked"),b=$(".modal.zd-infopopup.docked");$(".control-rounded").removeClass("active"),$(".control-button").removeClass("active"),$(".header-control").removeClass("active"),a.remove(),b.remove()},setActions:function(a){var b=this;return a?this.actions=a:a=this.actions,this.$actions.empty(),_.each(this.actions,function(a){var c=$(j({type:a.type,label:a.label,title:a.title||a.label}));b.$actions.append(c),c.on("click",a.callback),c.css({width:100/b.actions.length+"%"})}),this},clearActions:function(){return this.actions=null,this.$actions.empty(),this},render:function(a,c){return this.$el.attr("data-name",c),this.$body.empty(),this.$head.empty(),this.$body.append(a),void 0!==c?(this.$head.append(c),this.$head.show()):this.$head.hide(),this.$el.modal("show"),this._onFullScreenMode()&&(this.zIndex=this.zIndex||this.$el.zIndex(),this.$el.zIndex(this.zIndex+10),this.listenToOnce(b.eventDispatcher,"widget:fullOff",this.hide)),this.$el.find('button[value="dialog-back"]').on("click",this.back),this.actions&&0==this.$(this.$actions).length?this.$body.after(this.$actions):null,this.delegateEvents(),b.eventDispatcher.trigger("dialog:show"),this},goWide:function(){return this.$el.hasClass("wide")?null:this.$el.addClass("wide"),this.resetSizes(),this},goNormal:function(){return this.$el.hasClass("wide")?this.$el.removeClass("wide"):null,this.resetSizes(),this},resetSizes:function(){return this.$el.css({width:"",height:""}),this.$body.css({width:"",height:""}),this.adjustBodySizes(),this},adjustBodySizes:function(){var a=this.$el,b=$(this.settings.containment),c=b.offset(),d=this.$el.offset(),e=d,f={};d.left+=44,d.top+=44,e.left=d.left-c.left,e.top=d.top-c.top,e.right=b.width()-e.left-a.width(),e.bottom=b.height()-e.top-a.height(),e.left<0?(f.maxWidth+=e.left,f.marginLeft=parseInt(this.$el.css("margin-left"))-e.left):null,e.right<0?(f.maxWidth+=e.right,f.marginRight=parseInt(this.$el.css("margin-right"))-e.right):null,f.maxHeight=b.height()-e.top-d,this.$el.css(f),this.$body.css({maxHeight:f.maxHeight})},position:function(a){var b=this.$el.data().modal;return a=a||{},b&&b.$element.css({left:a.left||"auto",top:a.top||"auto",right:a.right||"auto",bottom:a.bottom||"auto"}),(a.of||a.my||a.at||a.collision)&&(this.$el.position({of:a.of,my:a.my,at:a.at,collision:a.collision,within:$(this.settings.containment),using:a.using}),this.adjustBodySizes()),this},positionInToolbar:function(a){this.position({of:a,my:"right+40px bottom-20px",at:"center top",collision:"flip flip"});var b=this.$el,c=($(this.settings.containment),a.getBoundingClientRect()),d=document.body.offsetWidth,e=(document.body.offsetHeight,d-(c.width+c.left)),f=c.left,g={left:0,top:c.top,width:0,height:0},h=(parseInt(b.css("maxWidth"),10),{left:10,top:-35});g.width=f>e?f-120:e-40,g.left=c.width+c.left-40,b.css({margin:0,left:g.left+"px",top:g.top+50+"px",width:g.width+"px"}),this.$pointer.css({left:h.left+"px","-webkit-transform":"scale(1, -1)","-moz-transform":"scale(1, -1)","-ms-transform":"scale(1, -1)"})},onBeforeHide:$.noop,hide:function(){if(this.onBeforeHide()!==!1){var a=this;this.$el.hasClass("rail-control")?this.$el.animate({left:-1*this.$el.width()},300,function(){a.$el.modal("hide")}):this.$el.fadeOut(200,function(){a.$el.modal("hide")})}},onReject:$.noop,onBeforeAccept:$.noop,accept:function(){var a=this;this.onBeforeAccept()!==!1&&(this.$el.off("hidden"),this.$el.one("hidden",function(){a.trigger("dialog:accepted"),a.remove(),a.onAccept(),a.onHide()}),this.$el.modal("hide"))},back:function(){this.onBack()},_onFullScreenMode:function(){return $(".fullScreenView").is(":visible")},onAccept:$.noop,onHide:$.noop,onBack:$.noop});var i=_.template('        <div class="modal hide zd-palette <%= customClass %>">            <div class="modal-header zd-palette-titlebar">                <button title="Close" value="dialog-reject" class="zd icon close" />                 <button title="" value="dialog-back" class="zd icon back" style="display:none;" />                 <div class="zd icon header"/>                 <h3 class="dialog-head zd-palette-header"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body zd-palette-body">            </div>            <div class="zd-palette-background">            </div>            <div class="zd-palette-background small">            </div>        </div>    '),j=_.template('            <button title="<%=title%>" class="zd btn btn-<%=type%>"><%=label%></button>        ');c.Palette=c.Dialog.extend({template:i,events:{"mousedown .modal-header":"moveToFront",'click button[value="dialog-reject"]':"hide","click .zd-palette-background":"hideDocked","keypress input":"keyEnterPressed"},defaults:{template:h,mode:"palette",draggable:!0,docked:!1,modal:!0,containment:"body",minWidth:250,minHeight:100,defaultWidth:264},keyEnterPressed:function(a){b.Views.SearchBox.prototype.keyEnterPressed.apply(a,arguments)},initialize:function(a){b.MVC.View.prototype.initialize.apply(this,arguments);var d=this;a=a||{},_.bindAll(this,"showBackButton","hideBackButton"),c.Dialog.prototype.initialize.apply(this,arguments),this.$body.css({maxHeight:"none"}),$(this.settings.containment).length&&this.$body.css({height:$(this.settings.containment).height()-this.$el.offset().top-79}),this.$el.on("dragstop",function(){d.adjustBodySizes()}),this.options.draggable&&this.setDragEvents()},render:function(){return c.Dialog.prototype.render.apply(this,arguments),this.$el.resizable({containment:".zd-main",alsoResize:this.$body,minWidth:this.settings.minWidth,minHeight:this.settings.minHeight}).data().modal.$backdrop.addClass("zd-overlay"),this.isDocked()?null:this.undock(),this.actions?this.$body.append(this.$actions):null,this},setDragEvents:function(){var a=this,c={left:b.main.$section.find(".leftPane").width()+2,top:b.main.$header.height()};this.palettePosition=c,this.settings.draggable={onDragStart:function(){a.$el.removeClass("docked"),a.$el.addClass("undocked"),a.settings.docked=!1,a.$("div.zd-palette-background").remove()}}},isDocked:function(){return this.settings.docked},undock:function(){return this.$el.removeClass("docked"),this.$el.hasClass("undocked")?null:this.$el.addClass("undocked"),this.$("div.zd-palette-background").hide(),this.settings.docked=!1,this},dock:function(a){function b(){var a=!c.$("div.zd-palette-background").length>0;a&&(c.$el.css({width:c.settings.defaultWidth,height:$(c.settings.containment).height()}),c.$body.css({width:c.settings.defaultWidth-24,height:$(c.settings.containment).height()-c.$head.parent().height()-24}))}var c=this;return this.position(a),this.$el.removeClass("undocked"),this.$el.hasClass("docked")?null:this.$el.addClass("docked"),this.$("div.zd-palette-background").show(),this.settings.docked=!0,b(),this},hide:function(){this.$el.removeClass("active"),this.$el.removeClass("fade"),c.Dialog.prototype.hide.apply(this,arguments)},hideDocked:function(){this.settings.docked&&this.hide()},moveToFront:function(){this._onFullScreenMode()?($(".zd-palette").zIndex($(".leftPane").zIndex()-2),this.$el.zIndex($(".leftPane").zIndex()-1)):($(".zd-palette").zIndex(1018),this.$el.zIndex(1019))},showBackButton:function(){this.$('button[value="dialog-back"]').show()},hideBackButton:function(){this.$('button[value="dialog-back"]').hide()},remove:function(){this.clearActions(),b.Controls.Dialog.prototype.remove.apply(this,arguments)}});var k=_.template('        <div class="modal hide zd-infopopup <%= customClass %>" >            <div class="modal-header zd-infopopup-titlebar">                <button title="Close" value="dialog-reject" class="zd icon close" />                <button title="" value="dialog-back" class="zd icon back" style="display:none;" />                  <h3 class="dialog-head zd-infopopup-header"></h3>                <div class="clearfix"></div>            </div>            <div class="modal-body dialog-body zd-infopopup-body">            </div>            <div class="zd-infopopup-background">            </div>            <div class="zd-infopopup-background small">            </div>        </div>    ');
c.InfoPopup=c.Dialog.extend({template:k,events:{"click .zd-infopopup-background":"hide","keypress input":"keyEnterPressed"},defaults:{autohide:!0,mode:"palette",draggable:!1,resizable:!1,modal:!1,containment:"body"},keyEnterPressed:function(a){c.Palette.prototype.keyEnterPressed.apply(a,arguments)},initialize:function(a){function d(){e._lastPostiton?e.position():null}var e=this;this.options=$.extend({},this.options,a),this._lastPostiton=null,this._repostionCallback=_.debounce(d,300),$.extend(this.events,c.Dialog.prototype.events),c.Dialog.prototype.initialize.apply(this,arguments),this.$pointer=$('<div class="zd-infopopup-pointer"><div class="zd-infopopup-pointer-arrow"></div> </div>'),$("body").one("dragstart",function(){e.hide()}),this.$el.on("dragstart",!1),$(window).on("resize",this._repostionCallback),(1==this.options.autohide||"string"==typeof this.options.autohide&&-1!==this.options.autohide.search("onStop"))&&this.listenTo(b.eventDispatcher,"visualization:stop",this.hide)},render:function(){return c.Dialog.prototype.render.apply(this,arguments),this.$(".zd-infopopup-background").show(),this.$el.addClass("docked"),this.$el.on("mousewheel","textarea",function(a,b,c,d){a.preventDefault();var e=$(this).scrollTop();$(this).scrollTop(e+d)}),this},position:function(a){function b(a,b){d.$el.css(a),d._showPointer(b)}var d=this;return a=a||this._lastPostiton||{},this._lastPostiton=a,a.using=a.using||b,c.Dialog.prototype.position.call(this,a)},_showPointer:function(a){var b=this.options.pointerWidth?this.options.pointerWidth:14,c=a.element,d=a.target,e={},f="behind",g=b+"px solid transparent",h=b+"px solid rgba(50, 50, 50, 0.9)",i=parseInt(this.$el.css("border-radius"));if(d.center={left:d.left+d.width/2,top:d.top+d.height/2},c.center={left:c.left+c.width/2,top:c.top+c.height/2},e.vertical=d.center.top-c.center.top,e.vertical=e.vertical<0?e.vertical+"px":"+"+e.vertical+"px",e.horizontal=d.center.left-c.center.left,e.horizontal=e.horizontal<0?e.horizontal+"px":"+"+e.horizontal+"px",c.left+c.width<=d.center.left&&(f+=" right"),c.left>=d.center.left&&(f+=" left"),c.top+c.height<=d.center.top&&(f+=" bottom"),c.top>=d.center.top&&(f+=" top"),f=f.split(" ").splice(1),1==f.length){switch(this.$pointer.appendTo(this.$el),f[0]){case"left":this.$pointer.css({"border-top":g,"border-bottom":g,"border-right":h}).position({my:"right center",at:"left center"+e.vertical,of:this.el}),0===d.width&&a.element.element.css({left:"+=20"});break;case"right":this.$pointer.css({"border-top":g,"border-bottom":g,"border-left":h}).position({my:"left center",at:"right center"+e.vertical,of:this.el}),0===d.width&&a.element.element.css({left:"-=20"});break;case"top":this.$pointer.css({"border-top":h,"border-right":g,"border-left":g}).position({my:"center bottom",at:"center"+e.horizontal+" top",of:this.el});break;case"bottom":this.$pointer.css({"border-right":g,"border-top":h,"border-left":g}).position({my:"center top",at:"center"+e.horizontal+" bottom",of:this.el})}var j={};switch(j.top=parseInt(this.$pointer.css("top")),j.left=parseInt(this.$pointer.css("left")),j.offset=this.$pointer.offset(),f[0]){case"left":break;case"right":c.top+i>j.offset.top&&this.$pointer.css("top",j.top+i);break;case"top":break;case"bottom":c.left+i>j.offset.left&&this.$pointer.css("left",j.left+i)}}},remove:function(){$(window).off("resize",this._repostionCallback),c.Dialog.prototype.remove.apply(this,arguments)}});var l=_.template('        <div class="modal hide zd-smallpopup <%= customClass %>" >            <div class="modal-body dialog-body zd-smallpopup-body">            </div>            <div class="zd-smallpopup-background">            </div>            <div class="zd-smallpopup-background small">            </div>        </div>    ');c.SmallPopup=c.Dialog.extend({template:l,events:{"click .zd-smallpopup-background":"hide","keypress input":"keyEnterPressed"},defaults:{mode:"palette",draggable:!1,resizable:!1,modal:!1,containment:"body"},keyEnterPressed:function(a){c.Palette.prototype.keyEnterPressed.apply(a,arguments)},initialize:function(){function a(){d._lastPostiton?d.position():null}var d=this;this._lastPostiton=null,this._repostionCallback=_.debounce(a,300),$.extend(this.events,c.Dialog.prototype.events),c.Dialog.prototype.initialize.apply(this,arguments),this.$pointer=$('<div class="zd-smallpopup-pointer"><div class="zd-smallpopup-pointer-arrow"></div></div>'),$("body").one("dragstart",function(){d.hide()}),this.$el.on("dragstart",!1),$(window).on("resize",this._repostionCallback),this.listenTo(b.eventDispatcher,"visualization:stop",this.hide)},render:function(){return c.Dialog.prototype.render.apply(this,arguments),this.$(".zd-smallpopup-background").show(),this.$el.on("mousewheel","textarea",function(a,b,c,d){a.preventDefault();var e=$(this).scrollTop();$(this).scrollTop(e+d)}),this},position:function(a){function b(b,c){b.top-=a.pointerTop||0,d.$el.css(b),d._showPointer(c)}var d=this;return a=a||this._lastPostiton||{},this._lastPostiton=a,a.using=a.using||b,c.Dialog.prototype.position.call(this,a)},_showPointer:function(a){var b=a.element,c=a.target,d={},e="behind",f="10px solid transparent",g="10px solid rgb(230, 230, 230)";if(c.center={left:c.left+c.width/2,top:c.top+c.height/2},b.center={left:b.left+b.width/2,top:b.top+b.height/2},d.vertical=c.center.top-b.center.top,d.vertical=d.vertical<0?d.vertical+"px":"+"+d.vertical+"px",d.horizontal=c.center.left-b.center.left,d.horizontal=d.horizontal<0?d.horizontal+"px":"+"+d.horizontal+"px",b.left+b.width<c.center.left&&(e+=" right"),b.left>c.center.left&&(e+=" left"),b.top+b.height<c.center.top&&(e+=" bottom"),b.top>c.center.top&&(e+=" top"),e=e.split(" ").splice(1),1==e.length)switch(this.$pointer.appendTo(this.$el),e[0]){case"left":this.$pointer.css({"border-top":f,"border-bottom":f,"border-right":g}).position({my:"right center",at:"left center"+d.vertical,of:this.el});break;case"right":this.$pointer.css({"border-top":f,"border-bottom":f,"border-left":g}).position({my:"left center",at:"right center"+d.vertical,of:this.el});break;case"top":this.$pointer.css({"border-top":g,"border-right":f,"border-left":f}).position({my:"center bottom",at:"center"+d.horizontal+" top",of:this.el});break;case"bottom":this.$pointer.css({"border-right":f,"border-top":g,"border-left":f}).position({my:"center top",at:"center"+d.horizontal+" bottom",of:this.el})}},remove:function(){$(window).off("resize",this._repostionCallback),c.Dialog.prototype.remove.apply(this,arguments)},closeModal:function(){this.$el.fadeOut(300)}}),c.PalettePopup=c.InfoPopup.extend({initialize:function(){return b.MVC.View.prototype.initialize.apply(this,arguments),_.bindAll(this,"showBackButton","hideBackButton"),c.InfoPopup.prototype.initialize.apply(this,arguments),this.$el.on("dragstart",!1),this},render:function(){var a={top:12,bottom:66};return c.InfoPopup.prototype.render.apply(this,arguments),this.$el.addClass("zd-palettepopup"),this.settings.handlers&&this.showHandlers(),this.$body.css("max-height",this.options.containment.height()-a.top-a.bottom-(this.$el.outerHeight()-this.$body.height())),this},showHandlers:function(){var a=this;this.handlers=this.options.handlers,this.$footer=$('<div class="zd-infopopup-footer"></div>'),this.$el.append(this.$footer),_.each(this.handlers,function(b){var c=b.tagName||"button",d=$("<"+c+' class="">'+b.title+"</"+c+">");b.icon&&d.prepend('<i class="zd icon '+b.icon+'"></i>'),b.className&&d.addClass(b.className),d.click(function(){b.callback()}),a.$footer.append(d)})},showBackButton:function(){return b.Controls.Palette.prototype.showBackButton.apply(this,arguments),this},hideBackButton:function(){return b.Controls.Palette.prototype.hideBackButton.apply(this,arguments),this}}),c.DetailsPopup=c.Dialog.extend({template:k,events:{"click .zd-infopopup-background":"hide"},defaults:{mode:"palette",draggable:!1,resizable:!1,modal:!1,containment:"body"},initialize:function(){$.extend(this.events,c.Dialog.prototype.events),c.Dialog.prototype.initialize.apply(this,arguments)}});var m=_.template('        <div>             <div class="zd-side-pane">                <div class="zd-side-pane-header"/>                <button value="closeSidePane" class="close">&times;</button>                <div class="zd-side-pane-body"/>            </div>        </div>     '),n=_.template('        <div class="zd-modal sidepane">             <div class="zd-side-pane">                <div class="zd-side-pane-loading"/>                <div class="zd-side-pane-header"/>                <div class="zd-side-pane-body"/>            </div>        </div>     ');c.SidePane=b.MVC.View.extend({initialize:function(){function a(){var a=b.user||new b.Models.User;a.bootstrap().done(function(){var b=a.get("name");window.localStorage["sidePaneHasBeenClosedBy"+b]="true"}),c.$el.hide(),b.eventDispatcher.trigger("sidepane:manualhide")}b.MVC.View.prototype.initialize.apply(this,arguments),_.bindAll(this,"render","hide","show","close","getHeader","visible");var c=this;this.hasCloseButton=this.options.hasCloseButton,this.template=this.hasCloseButton?m:n,this.setElement(this.template()),this.$el.appendTo("body"),this.hide(),this.$loading=this.$(".zd-side-pane-loading"),this.$body=this.$(".zd-side-pane-body"),this.$header=this.$(".zd-side-pane-header"),this.$closeButton=this.$(".close"),this.hasCloseButton||(this.$(".zd-side-pane").on("click",function(a){a.stopPropagation()}),this.$el.on("click",a))},events:{"click .close":"hide"},render:function(a){return this.$body.empty(),this.$body.append(a),this.delegateEvents(),this},hide:function(){this.$el.hide()},show:function(){$(".zd-side-pane").parent("div").hide(),this.$el.show(),this.$el.find("input").blur()},close:function(){this.$el.remove()},getHeader:function(){return this.$header},visible:function(){return this.$el&&this.$el.is(":visible")}});var o=_.template('        <span><%= message %></span>        <i title="<%= acceptTitle%>" class="icon-ok icon-white"></i>        <i title="<%= cancelTitle%>" class="icon-remove icon-white"></i>    ');c.ConfirmMessage=b.MVC.View.extend({tagName:"span",className:"label label-warning pull-right confirmMessage",defaults:{template:o,message:"Warning",acceptTitle:"Accept",cancelTitle:"Cancel"},events:{"click .icon-ok":"accept","click .icon-remove":"cancel"},initialize:function(a){this.settings=$.extend({},this.defaults,a),this._deferred=$.Deferred(),this.result=this._deferred.promise()},accept:function(){var a=this;return this.$el.fadeOut(function(){a.remove(),a._deferred.resolve()}),!1},cancel:function(){var a=this;return this.$el.fadeOut(function(){a.remove(),a._deferred.reject()}),!1},render:function(){return this.$el.html(this.settings.template({message:this.settings.message,acceptTitle:this.settings.acceptTitle,cancelTitle:this.settings.cancelTitle})),this.$el.hide().fadeIn(),this.delegateEvents(),this}}),c.Notification=b.MVC.View.extend({defaults:{delay:3e3,type:"info"},events:{click:"remove"},initialize:function(a){a=a||{},a.template&&(this.template=a.template,delete a.template),this.options=$.extend({},this.defaults,a),this.$el.addClass("zd notification alert alert-"+this.options.type).appendTo("body").hide()},render:function(a){var b=this;return this.empty(),this.$el.append(a),"error"!=this.options.type?setTimeout(function(){b.remove()},this.options.delay):this.$el.append('<div class="closeError zd icon remove"></div>'),this.$el.slideDown(),this},remove:function(){var a=this,c=arguments;this.$el.slideUp(function(){b.MVC.View.prototype.remove.apply(a,c)})}}),c.Popover=function(){var a=b.MVC.View.extend({contentView:null,_data:!1,_container:!1,_stopHide:!1,_setEvents:!1,_setHeadEvents:!1,_buttons:{},_headTemplate:'<span style="overflow: hidden;display: block;"><%=name%></span>',_bodyTemplate:'<div class="span4" style="margin-left:0">                     <div class="row-fluid">                           <div class="popoverWindow" id="popowerWindow_1" style="min-height:<%=height%>px;">                        <div style="height: <%=height-40%>px; overflow: auto;">                         <% _.each(data, function(period) { %>                            <div class="span12 popoverSmallHeader">                                <%=period.name%>                             </div>                              <div class="span12 popoverDataInfo">                                Time Window                                 <div><%=period.time%></div>                             </div>                              <% _.each(period.values, function(val) { %>                                <div class="span12 popoverDataInfo">                                    <%=val.name%>                                     <div><%=val.value%></div>                                 </div>                              <%});%>                        <%});%>                        </div>                             <div class="span12 popoverFooter">                                <span></span>                                <div class="btn-group">                                    <button class="btn<% if (buttons.zoom == false) {%> dis<%}%>" data-type="zoom">Zoom In</button>                                    <button class="btn<% if (buttons.details == false) {%> dis<%}%>" data-type="details">Details</button>                                    <button class="btn<% if (buttons.trend == false) {%> dis<%}%>" data-type="trend" data-name="_ts">Trend</button>                                    <% if (buttons.twitter) {%><button class="btn" data-type="twitter" data-name="_ts">Twitter</button><%}%>                                </div>                            </div>                        </div>                        <div class="popoverWindow" id="popowerWindow_2" style="display:none;min-height:<%=height%>px;">                            <div style="height: <%=height%>px; overflow: auto;">                                 <% _.each(zoomInFields, function(val) { %>                                    <div class="span12 popoverDataInfo">                                        <div class="popoverZoomTo" data-name="<%=val.name%>"><%=val.label%></div>                                     </div>                                  <%});%>                            </div>                        </div>                                            </div>                </div>',initialize:function(a){b.MVC.View.prototype.initialize.apply(this,arguments),_.bindAll(this,"render","buildPopoverHeader","buildPopoverBody","show","hide","setTemplate","data","stopHide"),a=$.extend({setEvents:!1,setHeadEvents:!1,body:!1,head:!1,container:$("body"),buttons:!1},a),this._buttons={zoom:!0,details:!1,trend:!1,twitter:!1};return"function"==typeof a.setEvents&&(this._setEvents=a.setEvents),"function"==typeof a.setHeadEvents&&(this._setHeadEvents=a.setHeadEvents),a.body&&(this._bodyTemplate=a.body),a.buttons&&(this._buttons=$.extend(this._buttons,a.buttons)),a.head&&(this._headTemplate=a.head),a.container&&(this._container=a.container),$("#popoverElement").remove(),$("body").append($("<div>").attr("id","popoverElement").css({position:"absolute",width:1,height:1,display:"none","z-index":1010}).append("<div>")),this.render()},render:function(){var a=this;return $("#popoverElement>div").popover({html:!0,title:function(){return a.buildPopoverHeader()},content:function(){return a.buildPopoverBody()}}).on("show",function(){console.log("popover shown"),$(".zd-main-section").off("click").on("click",function(b){a.hide(b)}),b.eventDispatcher.trigger("freezeTime")}).on("hide",function(){console.log("popover hidden"),$(".zd-main-section").off("click"),b.eventDispatcher.trigger("unfreezeTime")}),b.eventDispatcher.trigger("rendered"),this.listenToOnce(b.eventDispatcher,"visualization:stop",function(){$("#popoverElement").remove()}),this},buildPopoverHeader:function(){var a=$(_.template(this._headTemplate,this._data));return"function"==typeof this._setHeadEvents&&this._setHeadEvents(a,this._data),a},buildPopoverBody:function(){this._data.buttons=this._buttons,this._data.height=Math.max(250,Math.min(500,$("body").height()/2));var a=$(_.template(this._bodyTemplate,this._data));return"function"==typeof this._setEvents&&this._setEvents(a,this._data),a},hideDelay:!1,show:function(a,c){var d=c.x,e=c.y;this._data=a;var f=this;$("#popContainer").attr("class",b.main.$section.width()<500?"span3":"span4"),$("#popoverElement .popoverFooter .btn-group").css("paddingLeft",b.main.$section.width()<500?"6%":"15%");var g=$("body").height(),h=null,i=null,j=null,k=0,l=0,m=b.Utilities.MODE.WIDGET!==b.Utilities.mode()&&g>=450?300:10,n=b.Utilities.MODE.WIDGET!==b.Utilities.mode()&&g>=450?50:10;l=Math.max(200,Math.min(Math.max(e,m),g-n)),h=$("#popoverElement"),h.css({top:l,left:d}).show().find("div").popover("show"),i=$("#popoverElement .popover"),j=$("#popoverElement .arrow"),d+1*i.width()>b.main.$section.width()+$("#popContainer").width()/2&&h.css("left",Math.max(10,d-i.width()-10)).find(".popover").removeClass("right").addClass("left");var o=$("#popoverElement>.popover").height();l+o/2>g-n&&(l=g-n-o/2,h.css("top",l)),k=e-(l+i.position().top);var p=o,q=2,r=j[0].offsetHeight;k=Math.min(p-r/2-q,k),k=Math.max(r/2+2*q,k),j.css("top",k),this.hideDelay=!0,setTimeout(function(){f.hideDelay=!1},200)},hide:function(a){return this._stopHide?void(this._stopHide=!1):void(void 0!==a&&($(a.target).parents(".popover").length||$(a.target).parent(".bar").length||this.hideDelay)||$("#popoverElement>div:first").popover("hide"))},setTemplate:function(a,b){void 0!==b&&b?this._headTemplate=a:this._bodyTemplate=a},data:function(){return this._data},stopHide:function(){this._stopHide=!0}});return a}(),c.TwittViewer=b.MVC.View.extend({contentView:null,_data:!1,_stopHide:!1,_setEvents:!1,_bodyTemplate:"<div></div>",initialize:function(a){b.MVC.View.prototype.initialize.apply(this,arguments),a=$.extend({setEvents:!1,body:!1},a);return"function"==typeof a.setEvents&&(this._setEvents=a.setEvents),a.body&&(this._bodyTemplate=a.body),$("#twittViewerElement").remove(),$("body").append($("<div>").attr("id","twittViewerElement").attr("class","modal hide fade").attr("tabindex","-1").attr("role","dialog").attr("aria-labelledby","myModalLabel").attr("aria-hidden","true")),this.render()},render:function(){return $("#twittViewerElement").html(this.buildTwittViewerBody()),$("#twittViewerElement").modal({show:!1}),this},buildTwittViewerBody:function(){console.log(this._data);var a=$(_.template(this._bodyTemplate,this._data)());return"function"==typeof this._setEvents&&this._setEvents(a,this._data),a},show:function(a){this._data=a;$("#twittViewerElement").modal("show")},hide:function(){$("#twittViewerElement").modal("hide"),b.eventDispatcher.trigger("twittViewerHide")},data:function(){return this._data}});var p=_.template('        <span class="zd-radial-item-label"><%=label%></span>    ');c.RadialMenu=b.MVC.View.extend({className:"zd-radial-menu",defaults:{template:p,arc:{start:-40,end:220,gap:4,radius:66,width:44,color:"rgba(0, 0, 0, 0.7)"},arcClosed:{radius:66,width:44,start:89,angle:2}},events:{},initialize:function(a){var c;return a=a||{},this.items=[],this.icons=[],this.closed=[],this.position={left:"50%",top:"50%"},b.MVC.View.prototype.initialize.apply(this,arguments),c={start:90,end:90,gap:0,radius:this.options.arc.radius,width:this.options.arc.width},this.start=$('<div class="zd-radial-start"></div>'),this._renderStart(c),this.end=$('<div class="zd-radial-end"></div>'),this._renderEnd(c),a.items&&(this.reset(a.items),delete this.options.items),this},render:function(a){var b=this;return a=a||{},this.empty(),""===a.group?this.$el.addClass("zd-empty-group"):this.$el.removeClass("zd-empty-group"),this.$el.append(this.start.show()),this.$el.append(this.end.show()),this.start.off("transitionend"),this.end.off("transitionend"),this.start.on("click",function(){b.items[0].arc.$donut.click()}).on("mouseenter",function(){b.items[0].arc.$donut.hasClass("active")?null:b.items[0].arc.$donut.addClass("active")}).on("mouseleave",function(){b.items[0].arc.$donut.hasClass("active")?b.items[0].arc.$donut.removeClass("active"):null}),this.end.on("click",function(){var a=b.items.length-1;b.items[a].arc.$donut.click()}).on("mouseenter",function(){var a=b.items.length-1;b.items[a].arc.$donut.hasClass("active")?null:b.items[a].arc.$donut.addClass("active")}).on("mouseleave",function(){var a=b.items.length-1;b.items[a].arc.$donut.hasClass("active")?b.items[a].arc.$donut.removeClass("active"):null}),requestAnimationFrame(function(){b._renderStart(),b._renderEnd()}),this.setPosition(a),this.renderItems(),this.renderIcons(),this},renderIcons:function(){var a=this;return _.each(this.icons,function(b,c){a.renderIcon(c)}),this},renderIcon:function(a){var b=this,c=this.icons;return 0>a||a>=c.length?this:(this.$el.children().has(c[a].$icon).length?null:this.$el.append(c[a].$icon),requestAnimationFrame(function(){c[a].$icon.css(a%2?{top:20,right:b.options.arc.radius,opacity:1}:{top:20,left:b.options.arc.radius,opacity:1})}),this)},setPosition:function(a){return this.position.left=a.left||this.position.left,this.position.top=a.top||this.position.top,this.$el.css({left:this.position.left,top:this.position.top}),this},renderItems:function(){{var a=this;this.items.length}return _.each(this.items,function(b,c){a.renderItem(c)}),this},renderItem:function(a){var b=this.items;return this.isClosed(a)?this:0>a||a>=b.length?this:(this._renderArc(a),b[a].arc.$el.show(200),this)},reset:function(a){var b=this;return this.clear(),_.each(a,function(a){b.add(a)}),this},clear:function(){return this.clearItems(),this.clearIcons(),this},clearItems:function(){for(;0!==this.items.length;)this.removeItem(0);return this.closed=[],this},clearIcons:function(){for(;0!==this.icons.length;)this.removeIcon(0);return this},add:function(a){switch(a.type){case"icon":this.addIcon(a);break;case"arc":default:this.addItem(a)}return this},addIcon:function(a){var b=this;return a.$icon=$('<div class="zd-radial-icon" title="'+a.label+'"></div>'),a.$icon.append('<i class="zd-icon zd-icon-'+a.label.toLowerCase()+'"/>'),a.$icon.on("click",function(c){return"function"==typeof a.action?a.action.call(this,c,b.$el):null}),this.icons.push(a),this},addItem:function(a){var b=this,c=this.items,e=c[0],f=c[c.length-1];a.arc=new d.Arc(this.options.arcClosed),a.arc.$donut.on("click",function(c){return""!==a.group.group&&"function"==typeof a.action?a.action.call(this,c,b.$el):(""===a.group.group&&c.stopPropagation(),null)}),a.arc.$center.html(this.options.template(a)),f&&f.arc.$donut.off("mouseenter"),f&&f.arc.$donut.off("mouseleave"),a.arc.$donut.on("mouseenter",function(){b.end.hasClass("active")?null:b.end.addClass("active")}).on("mouseleave",function(){b.end.hasClass("active")?b.end.removeClass("active"):null}),e&&e.arc.$donut.on("mouseenter",function(){b.start.hasClass("active")?null:b.start.addClass("active")}).on("mouseleave",function(){b.start.hasClass("active")?b.start.removeClass("active"):null});var g=this.allOrUnFilterAll(a);return void 0!==a.disabled&&$.isFunction(a.disabled)&&a.disabled()===!0?this:(g!==a.name&&this.items.push(a),this)},allOrUnFilterAll:function(a){var c=b.main.currentSection.widgetGrid.childViews,d="un_filter_all";return("un_filter_all"===a.name||"filter_all"===a.name)&&_.each(c,function(b){if(b.controller.filtersIndicator){var c=b.controller.filtersIndicator.collection.models;_.each(c,function(b){b.get("value").indexOf(a.group.group)>=0?d="filter_all":null})}}),d},removeItem:function(a){var b=this.items[a];return this.isClosed(a)&&this.closed.splice(this.closed.indexOf(a),1),b.arc.$donut.off("click"),b.arc.$donut.off("mouseenter"),b.arc.$donut.off("mouseleave"),b.arc.remove(),this.items.splice(a,1),this},removeIcon:function(a){var b=this.icons[a];return b.$icon.off("click"),b.$icon.remove(),this.icons.splice(a,2),this},close:function(){var a=this,b={start:90,end:90,gap:0,radius:this.options.arc.radius,width:this.options.arc.width};return _.each(this.items,function(b,c){a.closeItem(c)}),_.each(this.icons,function(b,c){a.closeIcon(c)}),this.start&&(this._renderStart(b),this.start.one("transitionend",function(){a.start.hide(),a.empty()})),this.end&&(this._renderEnd(b),this.end.one("transitionend",function(){a.end.hide(),a.empty()})),this},open:function(){return this.closed=[],this.renderItems(),this.renderIcons(),this},closeItem:function(a){var b=this.items;return this.isClosed(a)?this:0>a||a>=b.length?this:(b[a].arc.set(this.options.arcClosed),b[a].arc.$el.fadeOut(200),this.closed.push(a),this)},closeIcon:function(a){var b=this.icons;return b[a].$icon.css({width:0,height:0,opacity:0}),this},openItem:function(a){var b=this.items;return this.isClosed(a)?0>a||a>=b.length?this:(this.closed.splice(this.closed.indexOf(a),1),this.renderItem(a),this):this},isClosed:function(a){return-1!==this.closed.indexOf(a)},_renderArc:function(a){var b=a,c=this.items.length-this.closed.length,d=this.items[a].arc,e={};return _.each(this.closed,function(c){a>c?b--:null}),e.gap=this.options.arc.gap,e.radius=this.options.arc.radius,e.angle=(this.options.arc.end-this.options.arc.start)/c,e.start=this.options.arc.start+e.angle*b,this.$el.children().has(d.$el).length?null:this.$el.append(d.$el),requestAnimationFrame(function(){d.set(e)}),this},_renderStart:function(a){var b=this.start,a=a||this.options.arc,c=a.end+90,d=a.width,e=a.radius-a.width,f=-a.width/2+a.gap/2;b.css({transform:"rotate("+c+"deg)",transformOrigin:-f+"px "+-e+"px",width:d/2,height:d,borderBottomLeftRadius:d/2,borderTopLeftRadius:d/2,top:e,left:f})},_renderEnd:function(a){var b=this.end,a=a||this.options.arc,c=a.start+90,d=a.width,e=a.radius-a.width,f=-a.gap/2;b.css({transform:"rotate("+c+"deg)",transformOrigin:-f+"px "+-e+"px",width:d/2,height:d,borderBottomRightRadius:d/2,borderTopRightRadius:d/2,top:e,left:f})}});var q='        <div class="color-picker-button" style="background: <%=color%>;"></div>     ';c.ColorPicker=b.MVC.View.extend({initialize:function(a){return b.MVC.View.prototype.initialize.apply(this,arguments),this.color=a.color,this.render()},render:function(){return this.button=$(_.template(q,{color:this.color})),this.$el.append(this.button),this.renderPopup(),this},setColor:function(a){this.color=a,this.button.css("background",this.color),this.button.spectrum("set",this.color)},renderPopup:function(){var a,c,d=this;this.button.spectrum({color:this.color,preferredFormat:"hex",showInput:!0,showInitial:!0,chooseText:"Apply",cancelText:"Cancel",change:function(a){d.color=a.toHexString(),d.button.css("background",d.color),d.trigger("change",d.color)},beforeShow:function(){d.trigger("beforeShow")},show:function(){c||(c=$(".sp-container:visible"),c.find(".sp-choose").addClass("zd btn btn-success btn-block"),c.find(".sp-cancel").addClass("zd btn btn-cancel btn-block").insertAfter(c.find(".sp-choose"))),a=new b.Controls.SmallPopup({containment:b.main.$section,customClass:"colorPickerPalette",pointerWidth:14}),a.render(c).position({of:d.button,my:"left+10 center+10",at:"right center",collision:"flipfit flipfit"})},hide:function(){c.appendTo("body"),a.hide()}})}}),b.Controls=c}(window,Zoomdata),function(a,b){"use strict";var c='        <table class="table table-striped">            <tr>                <td>Item No</td>                <td><%=index%></td>            </tr>            <%_.each(_.keys(attributes), function (key) {%>                <tr>                    <td><%=key%></td>                    <td><%=attributes[key]%></td>                </tr>            <%});%>        </table>         ';b.Views=b.Views||{},b.Views.ListItem=b.MVC.View.extend({tagName:"li",className:"zd-list-item",model:new b.MVC.Model,events:{click:"_onClick"},defaults:{template:_.template(c),selectedClass:"zd-item-selected",selectable:!1},initialize:function(a){return this.childViews=[],this.settings=$.extend({},this.defaults,a),this.$el.data("itemView",this),this.listenTo(this.model,"change",this.render),this},render:function(){return this.$el.html(this.settings.template({attributes:this.model.attributes,index:this.model.index})),this.delegateEvents(),this},_onClick:function(){if(this.settings.selectable)return this.toggle(),!1;var a=$(".widgetBody").has(".configure-palette");0!=a.length&&b.eventDispatcher.trigger("close:configurePalette")},toggle:function(){this.$el.toggleClass(this.settings.selectedClass),this.trigger("toggle",this.model)}})}(window,Zoomdata),function(a,b){"use strict";var c=b.Views.ListItem,d=b.Views.SearchBox,e=b.MVC.Collection,f=_.template('            <span class="zd-loader">Loading...</span>         ');b.Views=b.Views||{},b.Views.ListView=b.MVC.View.extend({tagName:"ul",className:"unstyled",defaults:{loaderTemplate:f,search:!1,sortable:!1,selectable:!1,sortOptions:{tolerance:"pointer"},sortbyOptions:null,sortOpened:!1,filter:function(){return!0},ItemView:c},events:{sortstop:"onSortstop",sortreceive:"onSortreceive",sortremove:"onSortremove"},initialize:function(a){var b=this;return this.childViews=[],this.options=$.extend({},this.defaults,a),this.collection=this.collection||new e,this.applyListeners(),this.options.sortable&&this.$el.sortable(this.options.sortOptions),this.options.search!==!1&&(this.searchBox=new d,this.listenTo(this.searchBox,"search",this._renderItems)),this.options.selectable&&(this.selected=[],this.listenTo(this.collection,"toggle",function(a){var c=b.selected.indexOf(a),d=b.childViews,e=b.selected;"checkbox"!==b.options.selectable&&(_.each(d,function(b){b.model!==a&&-1!==e.indexOf(b.model)?b.toggle():null}),c=b.selected.indexOf(a)),-1==c?e.push(a):e.splice(c,1)})),this},applyListeners:function(){this.listenTo(this.collection,"request:collection",this._showLoader),this.listenTo(this.collection,"remove reset sync:collection",this.render),this.listenTo(this.collection,"add",this._onAddItem)},removeListeners:function(){this.stopListening(this.collection,"request:collection"),this.stopListening(this.collection,"remove reset sync:collection"),this.stopListening(this.collection,"add")},getItemByModel:function(a){var b=this.childViews,c=null;return _.each(b,function(b){b.model==a?c=b:null}),c},getSelectedItems:function(){return this.selected},sortCollection:function(a){function b(a,b){_.each(a.models,function(d,e){var f=d.get("name");if(b&&b.indexOf(f)>=0){var g=a.models.splice(e,1);a.models.unshift(g[0])}else if(f===c.options.sortOpened){var g=a.models.splice(e,1);a.models.unshift(g[0])}})}{var c=this,d=this.collection.comparator,e=a&&a.sortby,f=a&&a.ascending;a&&a.limitShowCount?a.limitShowCount:null}if(a&&"Name"!==e&&"Filter Name"!==e){if("Author"===e){var g=_.sortBy(this.collection.models,function(b){var c=(b.get("userName")||"").toLowerCase();return a&&a.topValue===b.get("userName")&&(c=" "+c),a&&!a.ascending?c=_.map(c.split(""),function(a){return String.fromCharCode(-a.charCodeAt(0))}):c});this.collection.models=g}else if("Last Used"===e){var g=_.sortBy(this.collection.models,function(a){return f?-a.get("lastModified"):a.get("lastModified")});this.collection.models=g}else if("Popularity"===e){var g=_.sortBy(this.collection.models,function(a){return f?-a.get("viewsCount"):a.get("viewsCount")});this.collection.models=g}else if("Type"===e){var g=_.sortBy(this.collection.models,function(a){return a.get("type")});this.collection.models=f?g:g.reverse()}}else{var g=_.sortBy(this.collection.models,function(b){if(a&&!a.ascending){var c=b.get("name").toLowerCase();return c=c.split(""),c=_.map(c,function(a){return String.fromCharCode(-a.charCodeAt(0))})}return d?void 0:b.get("name")?b.get("name").toLowerCase():""});this.collection.models=g}this.options.sortOpened&&("string"==typeof this.options.sortOpened?b(this.collection):b(this.collection,this.options.openedSources)),this.collection.findWhere({selectAll:!0})&&(this.collection.models=_.sortBy(g,function(a){return a.get("selectAll")}))},onSortstop:function(){this.sortCollection()},onSortreceive:function(a,b){var c=b.item,d=c.data("itemView"),e=d.model;this.collection.add(e,{silent:!0}),this.sortCollection(),this.collection.trigger("add")},onSortremove:function(a,b){var c=b.item,d=c.data("itemView"),e=d.model;
this.collection.remove(e,{silent:!0}),this.childViews.splice(this.childViews.indexOf(d),1)},_onAddItem:function(a){return!a||this.searchBox&&!a.matchesSearch(this.options.search,this.searchBox.model.toJSON())?!1:(this._renderItem(a),!1)},_renderItem:function(a){var b=this,c={model:a,template:this.options.template,selectable:this.options.selectable};this.options.itemOption&&(c=$.extend({},this.options.itemOption,c));var d=new this.options.ItemView(c);this.sources&&d.model.set("sources",this.sources),this.$el.append(d.render().el),this.childViews.push(d),this.listenTo(d,"select",function(a,c){b.trigger("select",a,c)}),this.listenTo(d,"toggle",function(a){b.trigger("toggle",a)})},_renderItems:function(){var a=this,b=this.collection.models,c=a.options.sortbyOptions,d=c&&c.limitShowCount?c.limitShowCount:null;this._removeItems(),this.searchBox&&(b=this.collection.search(this.options.search,this.searchBox.model.toJSON())),_.each(_.filter(b,this.options.filter),function(b,c){d&&c>=d||a._renderItem(b)}),this.options.sortable&&this.$el.sortable("refresh")},_removeItems:function(){this._removeChildViews()},render:function(a){a=$.extend({},this.options.sortbyOptions,a);var b=this.options.sortbyOptions||a&&a.sortby?a:null;return this.empty(),b?this.sortCollection(b):this.sortCollection(),this.searchBox?this.$el.prepend(this.searchBox.render().el):null,this._renderItems(),this},_showLoader:function(){this.empty(),this.$el.html(this.options.loaderTemplate())},remove:function(){b.MVC.View.prototype.remove.apply(this,arguments),this.searchBox?this.searchBox.remove():null}})}(window,Zoomdata),function(a,b){"use strict";var c=b.Views.ListItem,d=b.Views.ListView,e=b.MVC.Collection,f='          <legend class="subhead"><%= label %></legend>    ';b.Views=b.Views||{},b.Views.GroupedListView=b.MVC.View.extend({className:"unstyled",defaults:{ItemView:c,ListView:d,groupClassName:"nav nav-tabs nav-stacked",selectable:!1,filter:function(){return!0}},events:{},initialize:function(){var a=this;return b.MVC.View.prototype.initialize.apply(this,arguments),this.childViews=[],this.groups={},this.collection=this.collection||new e,this.listenTo(this.collection,"add",function(b){var c=a.options.groupBy,d=b.get(c);"undefined"!=typeof d?this._addToGroup(b.get(c),b):null}),this.listenTo(this.collection,"remove",function(b){var c=b.get(a.options.groupBy);"undefined"!=typeof c?this._removeFromGroup(b.get(a.options.groupBy),b):null}),this.listenTo(this.collection,"reset",function(){this._resetGroups()}),this._resetGroups(),this},_createGroup:function(a,b){var c=this;"undefined"!=typeof this.groups[a]&&this._removeGroup(a);var d=new e(b);this.options.comparator&&(d.comparator=this.options.comparator,d.sort()),this.groups[a]=new this.options.ListView({className:this.options.groupClassName,ItemView:this.options.ItemView,itemOption:this.options.itemOption||null,selectable:this.options.selectable,template:this.options.template,collection:d,filter:this.options.filter}),this._renderGroup(a),this.childViews.push(this.groups[a]),this.listenTo(this.groups[a],"select",function(a){c.trigger("select",a)})},_removeGroup:function(a){"undefined"!=typeof this.groups[a]&&(this.groups[a].$el.prev().remove(),this.groups[a].remove(),this.childViews.splice(this.childViews.indexOf(this.groups[a]),1),delete this.groups[a])},_clearGroups:function(){var a=this;_.each(this.groups,function(b,c){a._removeGroup(c)})},_removeFromGroup:function(a,b){var c;"undefined"!=typeof this.groups[a]&&(c=this.groups[a].collection.findWhere(b.attributes),c?this.groups[a].collection.remove(c):null,0==this.groups[a].collection.length?this._removeGroup(a):null)},_addToGroup:function(a,b){"undefined"==typeof this.groups[a]&&this._createGroup(a),this.groups[a].collection.add(b,{merge:!0})},_resetGroups:function(){var a=this;this._clearGroups();var b=this.collection.groupBy(function(b){return b.get(a.options.groupBy)});_.each(b,function(b,c){a._createGroup(c,b)})},_renderGroup:function(a){var c=this.groups[a].render().el;c.childNodes.length&&(this.$el.append(_.template(f,{label:b.Utilities.toTitleCase(a)})),this.$el.append(this.groups[a].el))},_sortGroups:function(){var a=this.groups,b={},c=Object.keys(a).sort(function(b,c){return a[b]-a[c]});c.sort();for(var d in a)_.each(c,function(d,e){b[c[e]]=a[d]});this.groups=b},_sortGroupModels:function(a){var b=a.groups,c={};_.each(b,function(a,b){var d=[],e=[];_.each(a.collection.models,function(b,c){var b=a.collection.models[c].get("label");d.push([b,c,a.collection.models[c]])}),d.sort(),_.each(d,function(b,c){var f=d[c][2];a.collection.model[c]=f,e.push(f)}),c[b]=e,a.collection.models=e})},setFilter:function(a){this.options.filter=a,_.each(this.groups,function(b,c){c.options.filter=a})},render:function(){var a=this;return this.empty(),this._sortGroups(),_.each(this.groups,function(b,c){a._renderGroup(c)}),this},remove:function(){this._clearGroups(),b.MVC.View.prototype.remove.apply(this,arguments)}})}(window,Zoomdata),function(a,b){"use strict";var c=b.Models.Source,d=_.template('            <div class="object-field-container ">                <div title="<%= attributes.type.toLowerCase()%>" class="zd icon drag-icon <%= attributes.type.toLowerCase()%>"></div>                <div class="text"><%= attributes.label%></div>                <i class="zd icon right-chevron" style="display: none"></i>            </div>        '),e=_.template('            <div class="attributeItem">                <div class="text"><%= attributes.label%></div>            </div>        ');b.Views=b.Views||{},b.Views.ObjectFieldItem=b.Views.ListItem.extend({model:new c,className:"object-field",events:{click:"select"},defaults:{template:d},select:function(){this.model.collection.trigger("select",this.model),this.trigger("select",this.model)}}),b.Views.SmallObjectFieldItem=b.Views.ObjectFieldItem.extend({className:"",selectTemplate:'<span class="zd icon checkbox radio"><span class="zd checked <%=selected %>"></span></span>',defaults:{template:e,checkbox:!0},initialize:function(a){return b.Views.ObjectFieldItem.prototype.initialize.apply(this,arguments),this.options=$.extend({},this.defaults,a),this},render:function(){if(b.Views.ObjectFieldItem.prototype.render.apply(this,arguments),this.settings.checkbox){var a=this.model.get("selected"),c=this.model.get("disabled"),d=_.template(this.selectTemplate,{selected:a?" selected":""});this.$el.prepend(d),a?this.$el.addClass("selected"):null,c?this.$el.addClass("disabled"):null}else this.$el.addClass("minimal");return this}})}(window,Zoomdata),function(a,b){"use strict";var c=function(a){return new b.Components.MetricFormatter(a)},d=_.template('            <dt title="<%= label==="Count"?"Volume":label%> <%=func ? "("+func+")": ""%>"><%= label==="Count"?"Volume":label%> <%=func ? "("+func+")": ""%>:</dt>            <dd><%=value%></dd>        '),e=_.template('            <dt title="<%= label%>"><%= label%>:</dt>            <dd><%= from%></dd>            <dd><%= to%></dd>        '),f=_.template("            <legend><%= label%></legend>        "),g=_.template('            <button title="Show Details" value="button-details" class="zd btn btn-success btn-block">Details</button>         '),h=b.Utilities.time.getEndTimeWithinStep;b.Views=b.Views||{},b.Views.DataItem=b.MVC.View.extend({className:"zd-data-item",defaults:{dataItemTemplate:d,timeItemTemplate:e,groupDelimiter:f,detailsButton:g},events:{},initialize:function(a){return a=a||{},a.state&&(this.state=a.state,delete a.state),a.fields&&(this.fields=a.fields,delete a.fields),a.data?(this.data=a.data,delete a.data):this.data={},b.MVC.View.prototype.initialize.apply(this,arguments),this.options=$.extend({},this.defaults,a),this},render:function(a){this.state.get("timeTrendStep");a?this.data=a:a=this.data;var b=this.getCurrentTime(a);return this.$el.empty(),this.renderGroup("Current",a.current,b),a.historical&&this.renderGroup("Historical",a.historical,this.getHistoricalTime(a)),this.delegateEvents(),this},update:function(a){var b=this.data,c=b.group,d=_.where(a,{group:c})[0];return d&&this.render(d),this},isTrends:function(){var a=this;return function(){return a.state.isTimeTrends()}()},getCurrentTime:function(a){var b=this.isTrends(),c=this.state.config.get("source"),d=this.state.get("timeTrendStep");if("undefined"==typeof c.date||b){if(b){if("DAY"===this.state.config.get("source").dataResolution){var e=new Date(a.group),f=new Date(h(a.group,d));return{from:e.getUTCMonth()+1+"/"+e.getUTCDate()+"/"+e.getUTCFullYear(),to:f.getUTCMonth()+1+"/"+f.getUTCDate()+"/"+f.getUTCFullYear()}}return{from:new Date(a.group).toLocaleString(),to:new Date(h(a.group,d)).toLocaleString()}}return null}if("DAY"===this.state.config.get("source").dataResolution){var e=new Date(this.state.time.get("fromTime")),f=new Date(this.state.time.get("time"));return{from:e.getUTCMonth()+1+"/"+e.getUTCDate()+"/"+e.getUTCFullYear(),to:f.getUTCMonth()+1+"/"+f.getUTCDate()+"/"+f.getUTCFullYear()}}return{from:new Date(this.state.time.get("fromTime")).toLocaleString(),to:new Date(this.state.time.get("time")).toLocaleString()}},getHistoricalTime:function(a){var b=this.isTrends(),c=this.state.config.get("source"),d=this.state.get("timeTrendStep");return"undefined"==typeof c.date||b?b?{from:new Date(a.historical.group).toLocaleString(),to:new Date(h(a.historical.group,d)).toLocaleString()}:null:{from:new Date(this.state.time.get("historicalFrom")).toLocaleString(),to:new Date(this.state.time.get("historicalTo")).toLocaleString()}},renderGroup:function(a,b,e){var f=$("<dl></dl>"),g=(this.state.get("volume"),this.state.get("color"),this.fields);this.$el.append(this.options.groupDelimiter({label:a})).append(f),null!==e?f.append(this.options.timeItemTemplate({label:"Time Window",from:e.from||null,to:e.to||null})):null,f.append(this.options.dataItemTemplate({label:"Count",value:c("NUMBER").format(b.count),func:null})),b.metrics&&_.each(b.metrics,function(a,b){var e="";for(var h in a){e=h;var i=_.filter(g.models,function(a){return b===a.get("name")||a.distinctCount}),j=_.find(i,function(a){return a.get("func")&&"distinct_count"===e?a.get("distinctCount"):a.get("func")&&"distinct_count"!==e?e===a.get("func").toLowerCase():"avg"===e||"distinct_count"===e});j||(j=_.find(i,function(a){return a.get("name")===b}));var k=j.get("label"),l=j.get("type");f.append(d({label:k,value:"distinct_count"!==e?c(l).format(a[e]):a[e],func:e}))}})},_onShowDetails:function(){this.renderDetails()}})}(window,Zoomdata),function(a,b){"use strict";var c=b.Views.ListView,d=b.MVC.Model.extend({idAttribute:"_id",initialize:function(){var a=this;return b.MVC.Model.prototype.initialize.apply(this,arguments),this.fields=this.collection.fields,this.setFields(),this.on("change",function(){a.setFields()}),this},setFields:function(a){var b=this;this.fields=a||this.fields,_.each(_.keys(this.attributes),function(a){if("_zdFields"!==a){var c=b.fields.findWhere({name:a});b.attributes._zdFields=b.attributes._zdFields||{},b.attributes._zdFields[a]=c&&c.toJSON()||{label:a}}})}}),e=b.MVC.Collection.extend({model:d,initialize:function(a,c){return c.fields&&(this.fields=c.fields,delete c.fields),b.MVC.Collection.prototype.initialize.apply(this,arguments),this}}),f=function(a){return new b.Components.MetricFormatter(a)},g=_.template('            <button title="Get More Details" value="button-more" class="zd btn btn-success btn-block">                More            </button>         '),h=_.template('            <div class="progress progress-striped active">                <div class="bar" style="width: <%=value%>%"></div>             </div>        '),i=_.template('            <legend>                <h4 class="pull-left"><%=title%></h4>                <div class="clearfix"></div>             </legend>        '),j=_.template('            <div class="media minimized" data-role="item-holder">                <div class="media-body">                    <h4 class="media-heading">                        <%= attributes.time !== null ? new Date(attributes.time).toLocaleString(): ("Item " + index) %>                    </h4>                    <div class="media">                        <blockquote data-role="item-holder">                            <div class="zd-data-item-details-holder" data-role="details-holder">                                <table class="table table-striped">                                    <%_.each(_.keys(attributes), function (key, index) {%>                                        <% if (key !== "_id" && key !== "time" && key !== "_zdFields" && attributes._zdFields[key]) {%>                                            <tr>                                                <td><%=attributes._zdFields[key].label%></td>                                                <td>                                                    <% var imageLink = new RegExp("[/|.|w|s]*/(?:image)/");%>                                                    <% var imageExt = new RegExp("(http|https)"+".*?"+"(jpg|gif|png|jpeg|JPG|GIF|PNG|JPEG)");%>                                                    <% var imageLink = new RegExp("(http|https)"+".*?"+"(image)");%>                                                    <% var image = imageExt.test(attributes[key]) || imageLink.test(attributes[key]); %>                                                    <% if (image) { %>                                                        <img style="max-width: 300px" src="<%= attributes[key] %>"/>                                                     <% } else { %>                                                         <%= attributes[key] %>                                                    <% } %>                                                </td>                                            </tr>                                        <%}%>                                    <%});%>                                </table>                             </div>                            <button value="button-item-details" class="zd btn-link">                                Expand <i class="icon-chevron-down"></i>                            </button>                         </blockquote>                    </div>                 </div>             </div>         '),k=(_.template('            <div class="media minimized" data-role="item-holder">                <div class="media-body">                    <h4 class="media-heading">                        <span><%=attributes.rep_dn%></span>                        <small class="pull-right"><%=new Date(attributes._ts).toLocaleString()%></small>                        <div class="clearfix"></div>                     </h4>                    <div class="media">                        <blockquote>                            <%=attributes.text%>                            <br>                            <div data-role="details-holder" data-itemid="<%=attributes._id%>" style="display: none;" class="media">                                <div class="media-body">                                    <blockquote>                                    </blockquote>                                 </div>                             </div>                             <button value="button-item-details" class="zd btn-link">Expand <i class="icon-chevron-down"></i></button>                         </blockquote>                    </div>                 </div>             </div>         '),_.template('            <div data-role="item-holder" class="media">                <a class="zd pull-left thumbnail" target="_blank" href="https://twitter.com/<%=attributes.user_screen_name%>" class="pull-left">                    <img title="<%=attributes.user_name%>" class="media-object" src="<%=attributes.profile_image_url%>">                </a>                <div class="media-body">                    <h4 class="media-heading">                        <a title="<%=attributes.user_name%>" target="_blank" href="https://twitter.com/<%=attributes.user_screen_name%>">                        <%=attributes.user_name%>                        </a>                        <small class="pull-right"><%=new Date(attributes.created).toLocaleString()%></small>                        <div class="clearfix"></div>                     </h4>                    <blockquote>                        <a                             title="<%=attributes.user_name%>"                            target="_blank"                            href="https://twitter.com/<%=attributes.user_screen_name%>/status/<%=attributes.id%>"                        >                        <%=attributes.text%>                        </a>                         <small>                            <a title="<%=attributes.user_name%>" target="_blank" href="https://twitter.com/<%=attributes.user_screen_name%>">                                @<%=attributes.user_screen_name%>                            </a>                        </small>                    </blockquote>                </div>            </div>        '));b.Views=b.Views||{},b.Views.DataDetails=b.MVC.View.extend({className:"zd-data-item-details",defaults:{template:i,itemTemplate:j,filter:function(){return!0},search:!1,count:15,offset:0},events:{"click button[value='button-more']":"_onMoreClick","click button[value='button-item-details']":"_onItemDetailsClick"},initialize:function(a){a.state&&(this.state=a.state,delete a.state),a.fields&&(this.fields=a.fields,delete a.fields),a.data?(this.data=a.data,delete a.data):this.data={},b.MVC.View.prototype.initialize.apply(this,arguments),this.collection=this.collection||new e([],{fields:this.fields}),this.list=new c({collection:this.collection,filter:this.options.filter,search:this.options.search,template:this.options.itemTemplate}),this.childViews.push(this.list),this.$progressBar=$(h({value:100})),this.$moreButton=$(g());var d=this.state.config.get("streamType"),f=this.state.get("streamSourceId"),i=this.state.groupBy.getAttributes(),l=i[0],m=i.length>1,n=this.data.group,o=this.data.key,p=this.data.current.count,q=this.state.filters,r=a.fromTime,s=a.toTime,t=q.toJSON(),u={streamSourceId:f,fromTime:r,toTime:s,restrictions:t,itemTemplate:j,title:p+" Total Record"+(p>1?"s":"")};switch(l!==this.state.get("timestampField")&&(m?(t.push({path:i[1],operation:"EQUALS",value:n}),t.push({path:i[0],operation:"EQUALS",value:o})):t.push({path:l,operation:"EQUALS",value:n})),d){case"TWEET":u.itemTemplate=k,u.title=p+" Total Tweet"+(p>1?"s":"")}return this.setOptions(u),this.fields=b.sources.get(f).objectFields,this},setOptions:function(a){return a=a||{},this.options=$.extend({},this.options,a),this.options.itemTemplate?this.list.options.template=this.options.itemTemplate:null,this},render:function(){return this.$el.html(this.options.template({title:this.options.title})),this.$el.append(this.list.render().el),this.renderDetails(),this.delegateEvents(),this},renderDetails:function(a){var b=this;this.setOptions(a),this.forbidMore(),this.showLoader(),this.getDetails().done(function(a){var c=a.documents;_.each(c,function(a){var c,d,e;for(d in a)c=b.fields.findWhere({name:d}),e=c&&c.get("type"),!c||"MONEY"!==e&&"TIME"!==e&&"NUMBER"!==e||(a[d]=f(c.get("type")).format(a[d]))}),b.hideLoader(),b.allowMore(),b.collection.add(c,{silent:!0}),b.collection.forEach(function(a,b){a.index=b+1}),b.list.render(),a.hasNext?b.allowMore():b.forbidMore()}).fail(function(a){b.$el.append($('<div class="alert alert-error">Failed to fetch documents: '+a.statusText+"</div> "))})},getDetails:function(){var a=$.Deferred(),b={},c=0,d=this.state.get("timestampField");this.fields.bootstrap().done(function(){c++,2==c?a.resolve(b):null}).fail(function(b){a.reject(b)});var e={count:this.options.count,offset:this.options.offset,streamSourceId:this.options.streamSourceId,toTime:this.options.toTime},f=this.options.restrictions.filter(function(a){return a.path!==d});return e.restrictions=f,this.options.fromTime?e.fromTime=this.options.fromTime:null,d?e.timestampField=d:null,$.ajax({type:"POST",url:"service/stream/preview",data:JSON.stringify(e),contentType:"application/json"}).done(function(d){b=d,c++,2==c?a.resolve(b):null}).fail(function(b){a.reject(b)}),a.promise()},allowMore:function(){var a=this;return this.$el.on("scroll",function(){var b=a.$el.prop("scrollHeight"),c=a.$el.scrollTop(),d=a.$el.height();d>=b-c&&a.renderDetails({offset:a.collection.length})}),this},forbidMore:function(){return this.$el.off("scroll"),this},showLoader:function(){this.$el.append(this.$progressBar)},hideLoader:function(){this.$progressBar.remove()},toggleItemDetails:function(a){var b=this;a=a||this.$('[data-role="item-holder"]'),a.each(function(){var a=$(this),c=a.find('button[value="button-item-details"]'),d=a.find('[data-role="details-holder"]');a.hasClass("open")?(a.removeClass("open"),a.addClass("minimized"),c.html('Expand <i class="icon-chevron-down"></i>'),b.hideDetails(d)):(a.addClass("open"),a.removeClass("minimized"),c.html('Collapse <i class="icon-chevron-up"></i> '),b.showDetails(d))})},showDetails:function(){return this},hideDetails:function(){return this},_onItemDetailsClick:function(a){var b=$(a.currentTarget),c=b.parents('[data-role="item-holder"]');this.toggleItemDetails(c,b)}})}(window,Zoomdata),function(a,b){"use strict";function c(){var a=window.getComputedStyle(document.documentElement,""),b=(Array.prototype.slice.call(a).join("").match(/-(moz|webkit|ms)-/)||""===a.OLink&&["","o"])[1];return"-"+b+"-"}var d='            <div class="color-key">                 <div class="color-key-content">                     <div class="color-key-metric-label"><b><%= metricLabel %></b></div>                     <div class="color-key-linear-view">                         <div class="color-key-scale"></div>                         <div class="color-key-labels"></div>                     </div>                     <ul class="color-key-list-view unstyled" style="display: none;"></ul>                 </div>	            </div>	        ',e='<div class="color-item" style="background: <%= color %>;"></div>',f='<li class="color-list-item"><div class="color-item" style="background: <%= color %>;"></div></li>';b.Views=b.Views||{},b.Views.ColorKey=b.MVC.View.extend({defaults:{isDraggable:!0},initialize:function(a){if(_.bindAll(this,"render","remove"),!a.controller)throw new Error("controller must be defined");this.controller=a.controller,delete a.controller,this.controller.state.colorMetric&&(this.colorMetricLabel=this.controller.state.colorMetric.get("label")),this.autoShow=a.autoShow,a.type?(this.type=a.type,delete a.type):this.type="gradient",b.MVC.View.prototype.initialize.apply(this,arguments),this.options.isDraggable&&"undefined"!=typeof $.fn.draggable&&(this.$el.draggable({start:function(){$(this).css({bottom:"auto",right:"auto"})},cursor:"move",containment:this.$el.parent()}),this.$el.on("drag",function(a){a.stopPropagation()}))},render:function(){var a,b;return this.colorMetricLabel?(this.colorMetric=this.controller._controller.metrics[this.colorMetricLabel],this.colorMetric&&this.colorMetric[0]&&(this.colorMetric=this.colorMetric[0],this.multiMetric=!0),this.colorMetric?(this.multiMetric?a=this.colorMetric.metric.label:(a=this.colorMetric.get("label"),b=this.colorMetric.metric.func,b&&"none"!==this.colorMetric.metric.name&&(a+=" ("+b+")")),this.$el.empty().append(_.template(d,{metricLabel:a})),this.initScale(),this.initLabels(),this.autoShow&&this.show(),this.delegateEvents(),this):(this.hide(),this)):this},fixPosition:function(){var a=this.$el.parent().width()-this.$el.width()-5,b=this.$el.parent().height()-this.$el.height()-5,c=this.$el.position();c.top>b&&this.$el.css("top",b),c.left>a&&this.$el.css("left",a)},cloneTo:function(a){var b=this.$el.find(".color-key").clone().show();a.append(b)},initScale:function(){var a=c(),b=this.$el.find(".color-key-scale").empty(),d=this.$el.find(".color-key-list-view").empty(),g=this.colorMetric.colorRange()||[];g.length&&("none"===this.colorMetric.metric.name&&(g=[g[0],g[0]]),this.multiMetric||"gradient"!==this.controller.state.divergingColorRange&&"none"!==this.colorMetric.metric.name?!this.multiMetric&&g.length<=3?(this.$el.find(".color-key").css("width",""),d.hide(),b.show().css("width","85%").css("background","transparent"),$.each(g,function(a,c){b.append(_.template(e,{color:c}))}),b.find(".color-item").css("width",100/g.length+"%")):(this.$el.find(".color-key").css("width","auto"),b.hide(),d.show(),$.each(g,function(a,b){d.append(_.template(f,{color:b}))})):(this.$el.find(".color-key").css("width",""),d.hide(),b.show().css("width",null).css("background",a+"linear-gradient(left, "+g.join(",")+")").css("background","linear-gradient(to right, "+g.join(",")+")")))},initLabels:function(){var a=this.colorMetric.domain()||[],b=this.$el.find(".color-key-list-view li"),c=this.$el.find(".color-key-labels").empty();"gradient"===this.controller.state.divergingColorRange&&(a=[a[0],a[a.length-1]]),"none"===this.colorMetric.metric.name&&(a=[]),!this.multiMetric&&a&&"undefined"!=typeof a[0]?($.each(a,function(b,d){d>10?a[b]=d=d.toFixed(0):(100*d).toFixed(0)!==(100*d).toString()&&(a[b]=d=d.toFixed(2)),a.length<=4&&c.append('<span class="color-key-label">'+d+"</span>")}),a.length>4&&b.each(function(b,c){var d=a[b];d+=a[b+1]?" - "+a[b+1]:" +",c.innerHTML+=d})):this.multiMetric&&b.each(function(b,c){c.innerHTML+=a[b]}),"gradient"!==this.controller.state.divergingColorRange&&a.length<=4&&c.find(".color-key-label").css("width",100/a.length+"%")},show:function(){this.$el.show(),this.fixPosition()},hide:function(){this.$el.hide(),this.autoShow=!1},isVisible:function(){return this.$el.is(":visible")}})}(window,Zoomdata),function(a,b){"use strict";b.Components=b.Components||{};var c=b.Views.SmallObjectFieldItem,d=b.Views.GroupedListView,e=b.Views.MetricPalette,f=b.Views.TimeScaleControl,g=b.Views.DataItem,h=b.Views.DataDetails,i=b.eventDispatcher,j=b.Utilities.time.getEndTimeWithinStep;b.Components.InteractiveElementsMethods=function(){this.registerInteractiveElements=function(a,k,l,m){function n(a){J.push({name:"info",group:E(),label:"Info",type:"icon",action:function(c,d){function e(){D.on("thread:message",i),D.on("thread:timeline",k);var a=new b.Controls.InfoPopup({containment:b.main.$section,customClass:x?"":"zd-infopopup-hide-details"}),c=null;x&&(c=[{label:"Details",type:"success",callback:function(){a.hide(),f()}}]),a.setActions(c).render(w.render().el,C.state.isTimeTrends()?t:(l.key?l.key+", ":"")+l.group).position({of:d,my:"left top-30",at:"center center",collision:"flipfit flipfit"}),a.onHide=function(){D.off("thread:message",i),D.off("thread:timeline",k),w.remove()}}function f(){var a=new b.Controls.DetailsPopup({containment:b.main.$section,modal:!0,wide:!0}),c=o?m[1]:m[0];a.onHide=function(){x.remove()},a.render(x.render().el,C.state.isTimeTrends()?t:p.findWhere({name:c}).get("label")+": "+l.group).position({of:b.main.$section,my:"center top",at:"center top",collision:"flip flip"})}function i(a){w.update(a)}function k(){w.render()}var l=E(),m=C.state.groupBy.getAttributes(),n=m[0],o=m.length>1,p=(C.state.get("volume"),C.fields),q=C.state.time.get("fromTime"),r=C.state.time.get("time"),s=C.state.get("timeTrendStep"),t="";if(C.state.isTimeTrends()){var u=C._controller.fields.findWhere({name:n}).get("timestampGranularity"),v="DAY"===u;q=l.group,r=j(l.group,s,v),t=new b.Components.MetricFormatter(s,u).format(l.group)}var w=new g({state:C.state,fields:p,data:l}),x=null;a.hideDetails||(x=new h({state:C.state,fields:p,data:l,fromTime:q,toTime:r})),e()}})}function o(){J.push({name:"trend",group:E(),label:"Trend",disabled:function(){return void 0===C.config.attributes.source.date},action:function(){var a=function(a){var c=E(),d=C.state.groupBy.getAttributes(),e=C.state.filters,f={editable:!0,operation:"IN",path:d[0],value:[c.group]},g=e.findWhere({path:d});C.state.groupBy.length>1&&(f=[{editable:!0,operation:"IN",path:d[1],value:[c.group]},{editable:!0,operation:"IN",path:d[0],value:[c.key]}]),a.bootstrap().done(function(){g?g.hasAttribute(c.group)?g.set(f,{silent:!0}):g.addAttribute(c.group,{silent:!0}):$.isArray(f)?_.each(f,function(a){C.state.filters.add(a,{silent:!0})}):C.state.filters.add(f,{silent:!0}),C.setVisualization(a)}).fail(function(){var a=new b.Controls.Notification({type:"error"});a.render("Couldn't configure Time Trends visualization.")})};G.visualizations.bootstrap().done(function(){if(C._controller.trends){var b=C._controller.trends(G.visualizations.toJSON());b&&a(G.visualizations.findWhere({visId:b.visId}))}else a(G.visualizations.findWhere({type:"TRENDS"}))})}})}function p(){J.push({name:"filter_all",group:E(),disabled:function(){return b.Utilities.isSingleVizualization()},label:"Filter <br> all",action:function(){var a=E(),b=C.state.config.sourceId,c=C.state.groupBy.getAttributes(),d={editable:!0,operation:"IN",path:a.attr||c[0],value:[a.group]};C.state.groupBy.length>1&&(d=[{editable:!0,operation:"IN",path:c[1],value:[a.group]},{editable:!0,operation:"IN",path:c[0],value:[a.key]}]),i.trigger("visualization:filterAll",b,C.UUID,d,{timestampField:C.state.get("timestampField"),timeTrendStep:C.state.get("timeTrendStep")})}})}function q(){J.push({name:"un_filter_all",group:E(),disabled:function(){return b.Utilities.isSingleVizualization()},label:"Un<br>Filter <br> all",action:function(){var a=E(),b=C.state.config.sourceId,c=C.state.groupBy.getAttributes(),d={editable:!0,operation:"NOTIN",path:c[0],value:[a.group]};C.state.groupBy.length>1&&(d=[{editable:!0,operation:"IN",path:c[1],value:[a.group]},{editable:!0,operation:"IN",path:c[0],value:[a.key]}]),i.trigger("visualization:unfilterAll",b,C.UUID,d)}})}function r(){J.push({name:"filter",group:E(),label:"Filter",action:function(a,b){var c=E(),d=C.state.config.sourceId,e=C.state.groupBy.getAttributes(),f={editable:!0,operation:"IN",path:c.attr||e[0],value:[c.group]};C.state.groupBy.length>1&&(f=[{editable:!0,operation:"IN",path:e[1],value:[c.group]},{editable:!0,operation:"IN",path:e[0],value:[c.key]}]),i.trigger("visualization:filter",d,C.UUID,f,b,{timestampField:C.state.get("timestampField"),timeTrendStep:C.state.get("timeTrendStep")})}})}function s(){J.push({name:"attribute",group:E(),label:"Attribute",action:function(e){var f=E();if(C.state.isTimeTrends()){var g=C.state.get("timeTrendStep"),h=new Date(f.group),i=new Date(b.Utilities.time.getEndTimeWithinStep(h,g)),j=b.Utilities.time.getRoundedDateRange(h,i),k=C.state.config.get("source").dataResolution;if(k&&g===k||"MINUTE"===g)return;return C.state.time.set({time:i.getTime()},{silent:!0}),C.state.set({timeTrendStep:j.step,limit:j.amount+1},{silent:!0}),void C.state.trigger("change")}var l=new b.Controls.PalettePopup({containment:b.main.$section,customClass:"attributePalette",pointerWidth:14}),n=new d({className:"nav nav-tabs nav-stacked",ItemView:c,collection:C.fields,groupBy:"type",filter:function(b){var c=!!b.get("visible"),d="ATTRIBUTE"==b.get("type"),e=["SIDE_BY_SIDE_BARS","HORIZONTAL_SIDE_BY_SIDE_BARS","STACKED_BARS","VERTICAL_100PCT_STACKED_BARS","VERTICAL_STACKED_BARS"],g=C.config.get("type");if(b.get("label")===f?b.set({selected:!0},{silent:!0}):b.set({selected:!1},{silent:!0}),-1!=e.indexOf(g)){var h="";a.hasClass("groupBy1")?h=C._controller.variables["Second Group By"]:a.hasClass("groupBy2")&&(h=C._controller.variables["First Group By"]),b.get("name")===h?b.set({disabled:!0},{silent:!0}):b.set({disabled:!1},{silent:!0})}return c&&d},comparator:function(a){return a.get("label")}});l.render(n.render().el,m),l.position({of:e,my:"left+20 top-30",at:"right center",collision:"flipfit flipfit"}),C.listenToOnce(n,"select",function(b){if(!b.get("disabled")){var c=C.config.get("type"),d=C.config.get("templateType"),e=["SIDE_BY_SIDE_BARS","STACKED_BARS"];-1!=e.indexOf(c)||-1!=e.indexOf(d)?(a.hasClass("groupBy1")&&C.state.groupBy.at(0).setAttribute(b.get("name")),a.hasClass("groupBy2")&&C.state.groupBy.at(1).setAttribute(b.get("name"))):C.state.groupBy.setAttribute(b.get("name")),l.remove(),n.remove()}})}})}function t(){var f=(l.pivot(),l.callbacks()),g=E(),h=g.get&&"ATTRIBUTE"===g.get("type")||"ATTRIBUTE"===g.type?"attribute":"metric";
J.push("attribute"===h?{name:"attribute",group:E(),label:"Attribute",action:function(a){var e=a.closest('[data-zd-interactive-type="pivotLabel"]');a.is('[data-zd-interactive-type="pivotLabel"]')&&(e=a),e.addClass("active");var h=new b.Controls.PalettePopup({containment:b.main.$section,customClass:"attributePalette",pointerWidth:14,handlers:f&&f.attribute&&f.attribute.onRemove?f.attribute.onRemove(g,"attributePalette"):null}),i=new d({className:"nav nav-tabs nav-stacked",ItemView:c,collection:C.fields,groupBy:"type",filter:f&&f.attribute&&f.attribute.filter?function(a){return f.attribute.filter(a,g)}:function(){return!0},comparator:function(a){return a.get("label")}});h.onHide=function(){e.removeClass("active")},h.render(i.render().el,m),h.position({of:a,my:"left+20 top-30",at:"right center",collision:"flipfit flipfit"}),C.listenToOnce(i,"select",function(a){f&&f.attribute&&f.attribute.onClick?f.attribute.onClick(g,h,a):function(){return!0}})}}:{name:"metric",group:E(),label:"Metric",action:function(a,c){var d=a.closest('[data-zd-interactive-type="pivotLabel"]');a.is('[data-zd-interactive-type="pivotLabel"]')&&(d=a),d.addClass("active");var h=new b.Controls.PalettePopup({containment:b.main.$section,customClass:"metricPalette",pointerWidth:14,handlers:f&&f.metric&&f.metric.onRemove?f.metric.onRemove(g,"attributePalette"):null}),i=new e({collection:C.fields,currentItem:g.attributes,filter:f&&f.metric&&f.metric.filter?function(a){return f.metric.filter(a,g)}:function(){return!0}});h.onHide=function(){d.removeClass("active")},h.render(i.render().el,m),h.position({of:c,my:"left+5 center",at:"center center",collision:"flipfit flipfit"}),C.listenTo(i,"select:metric",function(a){f&&f.metric&&f.metric.onClick?f.metric.onClick(g,h,a):function(){return!0}})}}),C.elementsManager.register(a,{actions:J})}function u(){J.push({name:"timeScale",group:E(),label:"Time Scale",action:function(a){var c=(E(),new b.Controls.PalettePopup({containment:b.main.$section,customClass:"timeScalePaletteContainer",pointerWidth:14})),d=new f({className:"timeScalePalette",currentItem:E()});c.render(d.render().el,m),c.position({of:a,my:"left+20 top-30",at:"right center",collision:"flipfit flipfit"}),C.listenToOnce(d,"select",function(a){var e=[{name:"MINUTE",title:"Minutes",limit:60,time:60},{name:"HOUR",title:"Hours",limit:24,time:3600},{name:"DAY",title:"Days",limit:7,time:86400},{name:"WEEK",title:"Weeks",limit:5,time:604800},{name:"MONTH",title:"Months",limit:12,time:2678400},{name:"YEAR",title:"Years",limit:4,time:31536e3}],f=e.filter(function(b){return a.toUpperCase()===b.name})[0],g=this._controller.state.get("timeTrendStep"),h=this._controller.state.get("limit"),i=new Date(this._controller.state.time.get("min")),j=new Date(this._controller.state.time.get("max")),k={MINUTE:b.Utilities.time.getRoundedDateRange(i,j,"MINUTE"),HOUR:b.Utilities.time.getRoundedDateRange(i,j,"HOUR"),DAY:b.Utilities.time.getRoundedDateRange(i,j,"DAY"),WEEK:b.Utilities.time.getRoundedDateRange(i,j,"WEEK"),MONTH:b.Utilities.time.getRoundedDateRange(i,j,"MONTH"),YEAR:b.Utilities.time.getRoundedDateRange(i,j,"YEAR")},l=k[f.name].amount+1;f.limit=b.Utilities.time.recalculateLimit(g,h,f.name),f.limit=f.limit>l?l:f.limit,this._controller.state.set({timeTrendStep:f.name,limit:f.limit},{silent:!0}),this._controller.state.trigger("change"),c.remove(),d.remove()})}})}function v(){J.push({name:"metric",group:E().label,label:"Metric",action:function(a,c){var d=(E(),new b.Controls.PalettePopup({autohide:!1,containment:b.main.$section,customClass:"metricPalette",pointerWidth:14})),f=new e({collection:C.visualizationController.fields,currentItem:$.extend({},C.field.toJSON(),C.metric.toJSON())});C.childViews.push(d),C.childViews.push(f),d.render(f.render().el,C.options.popoverTitle).position({of:c,my:"left+5 center",at:"center center",collision:"flipfit flipfit"}),d.onHide=function(){f.trigger("hide"),C.childViews.splice(C.childViews.indexOf(d),1),C.childViews.splice(C.childViews.indexOf(f),1)},C.listenTo(f,"select:metric",function(a){C.state.metrics.at(0).set(a)})}})}function w(){J.push({name:"radius",group:E().label,label:"Radius",action:function(a,c){var d=E(),f=new b.Controls.PalettePopup({containment:b.main.$section,customClass:"metricPalette",pointerWidth:14}),g=new e({collection:C.fields,currentItem:d});f.render(g.render().el,m),f.position({of:c,my:"left top-30",at:"center center",collision:"flipfit flipfit"}),f.onHide=function(){g.trigger("hide")},C.listenTo(g,"select:metric",function(a){C.state.config.get("source").variables["_metric-radius"]=a.name+":"+a.func,C.state.trigger("change")})}})}function x(){J.push({name:"zoom",group:E(),label:"Zoom",action:function(a,e){function f(a){var b=C.state.groupBy.getAttributes(),c=[{editable:!0,operation:"IN",path:b[1],value:[g.group]},{editable:!0,operation:"IN",path:b[0],value:[g.key]}];G.visualizations.bootstrap().done(function(){var b=G.visualizations.findWhere({type:"VERTICAL_BARS"});b.bootstrap().done(function(){b.get("source").variables.Comparison="Off",C.setVisualization(b),C.state.groupBy.setAttribute(a.get("name"),{silent:!0}),_.each(c,function(a){C.state.filters.add(a,{silent:!0})})})})}var g=E(),h=C.state.groupBy.getAttributes(),i=h[0],j=h.length>1;if(C.state.isTimeTrends()){var k=C.state.get("timeTrendStep"),l=new Date(g.group),m=new Date(b.Utilities.time.getEndTimeWithinStep(l,k)),n=b.Utilities.time.getRoundedDateRange(l,m),o=C.state.config.get("source").dataResolution;if(o&&k===o||"MINUTE"===k)return;return C.state.time.set({time:m.getTime()},{silent:!0}),C.state.set({timeTrendStep:n.step,limit:n.amount+1},{silent:!0}),void C.state.trigger("change")}var p={editable:!0,operation:"IN",path:i,value:[g.group]},q=new b.Controls.PalettePopup({containment:b.main.$section,customClass:"attributePalette"}),r=new d({className:"nav nav-tabs nav-stacked",ItemView:c,itemOption:{checkbox:!1},collection:C.fields,groupBy:"type",filter:function(a){var b=!!a.get("visible"),c="ATTRIBUTE"==a.get("type"),d=a.get("name")==i;return b&&c&&!d},comparator:function(a){return a.get("label")}});q.render(r.render().el,"Zoom Into"),q.position({of:e,my:"left+20 top-30",at:"center center",collision:"flipfit flipfit"}),C.listenToOnce(r,"select",function(a){j?f(a):(C.state.addFilter(p,{silent:!0}),C.state.groupBy.setAttribute(a.get("name"))),q.remove(),r.remove(),b.eventDispatcher.trigger("zoomItem:select")})}})}function y(){J.push({name:"search_details",group:E(),label:"Details",action:function(a,c){function d(){var a=new b.Controls.InfoPopup({containment:b.main.$section,customClass:"searchResultsDetails"}),d=null,f=C.fields,g={};f.each(function(a){g[a.get("name")]=a.get("label")});var h=b.MVC.View.extend({itemTemplate:"<tr>\n                                    <td><%= name %></td>\n                                    <td><%= value %></td>\n                                </tr>",tagName:"table",initialize:function(a){b.MVC.View.prototype.initialize.call(this,a),_.bindAll(this,"render"),this.data=a.data||{},this.query=a.query||""},preg_quote:function(a){return(a+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")},highlightMatchedWords:function(a){var b=a;return"string"==typeof b&&this.query&&""!==this.query&&(b=a.replace(new RegExp("("+this.preg_quote(this.query).replace(" ","|")+")","gi"),"<span class='selected-result'>$1</span>")),b},render:function(){var a="";for(var b in this.data)if(this.data.hasOwnProperty(b)){var c=g[b],d=this.highlightMatchedWords(this.data[b]);a+=_.template(this.itemTemplate,{name:c,value:d})}return this.$el.html(a),this}}),i=new h({data:e.metadata,query:e.query});a.setActions(d).render(i.render().el,"Search Result Detail").position({of:c,my:"left top-30",at:"center center",collision:"flipfit flipfit"}),a.onHide=function(){i.remove()}}var e=E();d()}})}function z(){J.push({name:"exclude",group:E(),label:"Exclude",type:"icon",action:function(){var a=E(),b=C.config.get("type"),c=C.state.groupBy.getAttributes(),d=Array.isArray(c)?c[0]:c,e=a.group;"STACKED_BARS"===b?e=a.key:"SIDE_BY_SIDE_BARS"===b&&(d=Array.isArray(c)?c[1]:c);var f={editable:!0,operation:"NOTIN",path:d,value:[e]},g=C.state.filters.findWhere({path:d,operation:"NOTIN"});if(g){var h=g.get("value");if(-1!==h.indexOf(e))return;f.value=h.concat([e])}C.state.addFilter(f)}})}function A(c){K={scope:c,over:function(){},drop:function(c){var d=$(a),e=d.attr("data-zd-interactive-type"),f=E();if(e)switch(e){case"group":case"multi-group":case"attribute":"ATTRIBUTE"==c.get("type")&&null!==C.fields.findWhere({name:c.get("name")})&&C.state.groupBy.setAttribute(c.get("name"));break;case"metric":if(b.Utilities.isNumericAttributeType(c.get("type"))&&null!==C.fields.findWhere({name:c.get("name")})){var g=new b.Components.Metric({name:c.get("name"),func:c.get("func")?c.get("func").toLowerCase():"avg",type:c.get("type"),label:c.get("label")});C.state.set("volume",g)}}else if("ATTRIBUTE"==c.get("type")&&null!==C.fields.findWhere({name:c.get("name")})){if("TRENDS"===C.config.get("type"))return void b.eventDispatcher.trigger("TimeTrendsZoomIn",f.group);var h=C.state.groupBy.getAttribute(),i={editable:!0,operation:"IN",path:h,value:[f.group]};C.state.addFilter(i,{silent:!0}),C.state.groupBy.setAttribute(c.get("name"))}},out:function(){}}}function B(){K={scope:"objectField",over:function(){},drop:function(a){l.droppable.drop(a)},out:function(){}}}"object"==typeof k?l=k:$(a).attr("data-zd-interactive-type",k);var C=this,D=this.thread,E=l.data,F=this.config.get("source"),G=this.source,H="undefined"!==F.date,I=this.state.isTimeTrends(),J=[],K=null;if("function"==typeof E)switch(k){case"searchDetails":y(),A("search");break;case"search":y(),p(),q(),r(),A("search");break;case"timeScale":u(),A("timeScale");break;case"attribute":s(),A("objectField");break;case"metric":v(),A("metric");break;case"groupBy1":s(),A("objectField");break;case"groupBy2":s(),A("objectField");break;case"radius":w(),A("metric");break;case"objectFieldAcceptor":B();break;case"pivotLabel":t(),B();break;default:n(l),p(),q(),r(),x(),H&&!I&&o(),I||z(),A("objectField")}C.elementsManager.register(a,{actions:J,droppable:K,data:E})},this.releaseInteractiveElement=function(a,b){return this.isRemote?null:void this.elementsManager.release(a,b)}}}(window,Zoomdata),function(a,b){function c(){return!1}function d(a){var b=this._manager,c=this.options.droppable=$.extend({},this.defaults.droppable,a);return c.over=function(){var d=b.getElementInAction("drag");d&&c.scope&&c.scope==d.options.draggable.scope&&(console.log("hover options",c.scope),$(this).css({opacity:.7}),"function"==typeof a.over?a.over.apply(this,d.$el.data(c.scope)):null)},c.drop=function(){var d=b.getElementInAction("drag");d&&c.scope&&c.scope==d.options.draggable.scope&&($(this).css({opacity:1}),"function"==typeof a.drop?a.drop.apply(this,d.$el.data(c.scope)):null)},c.out=function(){var d=b.getElementInAction("drag");d&&c.scope&&c.scope==d.options.draggable.scope&&($(this).css({opacity:1}),"function"==typeof a.out?a.out.apply(this,d.$el.data(c.scope)):null)},this.$el.droppable(c),this.$el.data("droppable")}function e(){this.droppable?this.droppable.destroy():null}function f(a){var b=this._manager,d=this.options.droppable=$.extend({},this.defaults.droppable,a);this.$el.on("mouseenter",function(){var c=b.getElementInAction("drag");if(c&&d.scope&&d.scope==c.options.draggable.scope){var e=this.getAttribute("data-zd-interactive-type");"attribute"===e||"metric"===e?$(this).addClass("over"):$(this).css({opacity:.7}),"function"==typeof a.over?a.over.apply(this,c.$el.data(d.scope)):null}}),this.$el.on("mouseup",function(){var e=b.getElementInAction("drag");if(e&&d.scope&&d.scope==e.options.draggable.scope){var f=this.getAttribute("data-zd-interactive-type");"attribute"===f||"metric"===f?$(this).removeClass("over"):$(this).css({opacity:1}),e.$el.draggable("option","revert",c),"function"==typeof a.drop?a.drop.call(this,e.$el.data(d.scope)):null}}),this.$el.on("mouseleave",function(){var c=b.getElementInAction("drag");if(c&&d.scope&&d.scope==c.options.draggable.scope){var e=this.getAttribute("data-zd-interactive-type");"attribute"===e||"metric"===e?$(this).removeClass("over"):$(this).css({opacity:1}),"function"==typeof a.out?a.out.apply(this,c.$el.data(d.scope)):null}})}function g(){}function h(){var a;return a=-1!=navigator.appVersion.indexOf("MSIE 10.")?b.Utilities.detectTouchDevice()?"MSPointerDown click":"MSPointerUp click":"click"}b.eventDispatcher;b.Components=b.Components||{},b.Components.InteractiveElementController=function(a,b,c){var d="function"==typeof c.data,e=!!c.actions,h=!!c.draggable,i=!!c.droppable;if(_.bindAll(this,"_onInteractionStart","_onInteraction","_onInteractionEnd"),"undefined"!=typeof $(b).data("interactiveElement")&&null!==$(b).data("interactiveElement"))throw new Error("An element already is an instance of interactiveElement");this._manager=a,this.element=b,this.$el=$(this.element),this.gestureTimeOut=null,this.isSVG()&&(this._createDroppable=f,this._destroyDroppable=g),c.actionList&&(this.actionList=c.actionList,delete c.actionList),this.options={},this.options.interactions=$.extend({},this.defaults.interactions,c.interactions),this.data=d?c.data:null,e?this.options.actions=c.actions:null,this.droppable=i?this._createDroppable(c.droppable):null,this.draggable=h?this._createDraggable(c.draggable):null,this._allowed=[],this._prevented=[],this._allow(this.options.interactions.start),this._allow(this.options.interactions.action),this._allow(this.options.interactions.end),this.$el.data("interactiveElement",this)},b.Components.InteractiveElementController.prototype={defaults:{interactions:{start:"mousedown",action:h(),end:"mouseup"},draggable:{containment:"body",appendTo:"body",helper:"clone",revert:"invalid",addClasses:!1,dragClass:"zd-interactive-draggable",cursor:"pointer",cursorAt:{left:25,top:25},zIndex:2e3,scope:"default"},droppable:{addClasses:!1,tolerance:"pointer",activeClass:"zd-interactive-droppable-accepts",scope:"default"}},get:function(){var a=[];if(0==arguments.length)a=this.options;else if(1==arguments.length)a=this.options[arguments[0]]||null;else for(var b=0;b<arguments.length;b++)a[arguments[b]]=this.options[arguments[b]]||null;return a},set:function(){},showActionsList:function(a){var b=this;return null!==this.gestureTimeOut?this:("undefined"!=typeof this.actionList&&(a=a||{},a.left="number"!=typeof a.left?this.$el.offset().left+this.$el.width()/2:a.left,a.top="number"!=typeof a.top?this.$el.offset().top+this.$el.height()/2:a.top,-1!=navigator.appVersion.indexOf("MSIE 10.")?(setTimeout(function(){b.actionList.close()},100),setTimeout(function(){b.actionList.reset(b.options.actions)},200),setTimeout(function(){b.actionList.render(a)},300),this.gestureTimeOut=setTimeout(function(){b.gestureTimeOut=null},600)):this.actionList.close().reset(this.options.actions).render(a)),this)},isSVG:function(){return!("svg"!=this.element.tagName&&null===this.element.ownerSVGElement)},_notify:function(a,b){this._manager._notify(a,this,b)},_createDroppable:d,_destroyDroppable:e,_createDraggable:function(a){var b=this,c=this.options.draggable=$.extend({},this.defaults.draggable,a);return c.start=function(d,e){var f=e.helper;b._dragHelper=f,b._notify("drag:start"),f.css("pointer-events","none"),f.hasClass(c.dragClass)?null:f.addClass(c.dragClass),"function"==typeof a.start?a.start.apply(this,arguments):null},c.drag=function(){"function"==typeof a.drag?a.drag.apply(this,arguments):null},c.stop=function(d,e){var f=e.helper;b._notify("drag:stop"),b.$el.draggable("option","revert",c.revert),f.css("pointer-events","all"),f.hasClass(c.dragClass)?f.removeClass(c.dragClass):null,"function"==typeof a.stop?a.stop.apply(this,arguments):null},this.$el.on("touchend",function(a){var b=document.elementFromPoint(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY);$(b).trigger("mouseup")}),this.$el.draggable(c),this.$el.data("draggable")},_destroyDraggable:function(){this.draggable?this.draggable.destroy():null,this._dragHelper instanceof jQuery?this._dragHelper.remove():null},_isAllowed:function(a){return-1!==this._allowed.indexOf(a)},_allow:function(a){function b(){f.$el.on(e.start,f._onInteractionStart)}function c(){f.$el.on(e.action,f._onInteraction)}function d(){f.$el.on(e.end,f._onInteractionEnd)}var e=this.options.interactions,f=this;if(!this._isAllowed(a))switch(this._allowed.push(a),a){case e.start:b();break;case e.action:c();break;case e.end:d()}},_restrict:function(a){function b(){f.$el.off(e.start,f._onInteractionStart)}function c(){f.$el.off(e.action,f._onInteraction)}function d(){f.$el.off(e.end,f._onInteractionEnd)}var e=this.options.interactions,f=this;if(this._isAllowed(a))switch(this._allowed.splice(this._allowed.indexOf(a),1),a){case e.start:b();break;case e.action:c();break;case e.end:d()}},_isPrevented:function(a){return-1!==this._prevented.indexOf(a)},_prevent:function(a){var b=this.options.interactions;if(!this._isPrevented(a))switch(this._prevented.push(a),a){case b.start:this.$el.on(b.start,c);break;case b.action:this.$el.on(b.action,c);break;case b.end:this.$el.on(b.end,c)}},_release:function(a){var b=this.options.interactions;if(this._isPrevented(a))switch(this._prevented.splice(this._allowed.indexOf(a),1),a){case b.start:this.$el.off(b.start,c);break;case b.action:this.$el.off(b.action,c);break;case b.end:this.$el.off(b.end,c)}},_onInteractionStart:function(){this.options,this.options.interactions;return this._notify("interaction:start"),null},_onInteraction:function(a){if($(a.target).hasClass("prevent-click-element")||$(a.target).closest(".prevent-click").get(0))return null;var b,c=this.options;if(this._notify("interaction"),c.actions&&c.actions.length){if(1!==c.actions.length)return b=d3.select(this.element).data()[0]||{},this.showActionsList({left:a.pageX||a.originalEvent.pageX,top:a.pageY||a.originalEvent.pageY,group:b.group}),!1;c.actions[0].action($(a.target),a)}return null},_onInteractionEnd:function(){return this._notify("interaction:stop"),null},destroy:function(){var a=this.options.interactions;this._destroyDroppable(),this._destroyDraggable(),this._restrict(a.action),this._restrict(a.start),this._restrict(a.end),this.$el.data("interactiveElement",null)}}}(window,Zoomdata),function(a,b){var c=b.Components.InteractiveElementController,d=_.clone(b.MVC.Events);b.Components=b.Components||{},b.Components.InteractiveElementsManager=function(a){a||(a={}),a.actionList&&(this.actionList=a.actionList,delete a.actionList),this.options=$.extend({},this.defaults,a),this.elements=[],this._interactions={}},b.Components.InteractiveElementsManager.prototype=_.extend({defaults:{},register:function(a,b){function c(a,b){b.actionList=d.actionList,d.registered(a)?d.updateElement(a,b):d._addToRegistry(a,b)}var d=this;a instanceof Array?_.each(a,function(a){c(a,b)}):c(a,b)},release:function(a,b){function c(a){var b=d.getInteractiveElementFor(a);b?d._removeFromRegistry(b):null}var d=this;a instanceof Array?_.each(a,function(a){c(a,b)}):c(a,b)},getInteractiveElementFor:function(a){return _.find(this.elements,function(b){return b.element==a})},registered:function(a){return!!this.getInteractiveElementFor(a)},updateElement:function(a,b){var c=this.getInteractiveElementFor(a);c&&c.set(b)},inProgress:function(a){return!!this._interactions[a]},getElementInAction:function(a){var b;return b=this.inProgress(a)?this._interactions[a]:null},_notify:function(a,b,c){c||(c={});var d=a.split(":")[0],e=a.split(":")[1]||"action";switch(e){case"start":this.inProgress(d)?this._stop(d,c):null,this._start(d,b,c);break;case"stop":this._stop(d,c);break;case"action":this._trigger(d,b,c)}},_start:function(a,b){this._interactions[a]=b},_stop:function(a){delete this._interactions[a]},_trigger:function(a,b,c){var d=!!c.silent;d||this.trigger(a,b)},_removeFromRegistry:function(a){var b=this;_.each(_.keys(this._interactions),function(c){a==b.getElementInAction(c)?b._stop(c):null}),a.destroy(),this.elements.splice(this.elements.indexOf(a),1)},_addToRegistry:function(a,b){this.elements.push(new c(this,a,b))},destroy:function(){for(;this.elements.length>0;)this._removeFromRegistry(this.elements[0])}},d)}(window,Zoomdata),function(a,b){b.Components=b.Components||{};var c=b.eventDispatcher,d=b.Components.Thread=function(a){if(a=a||{},_.bindAll(this,"_onStreamError","_onViewport","_onMessage","_onTimeLine","_onStartFromTimeDone","_onStartVisDone","_onNoDataFound","_onDirtyData","_onNotDirtyData"),!a.dataStream)throw new Error("dataStream must be defined");this.dataStream=a.dataStream,this.tuneTo(a),this._progress=0,this.status("idle"),this.onStreamError=$.noop,this.onMessage=$.noop,this.onTimeLine=$.noop,this.onStartFromTimeDone=$.noop,this.onStartVisDone=$.noop,this.onNoDataFound=$.noop,this.onPauseDone=$.noop,this.onSpeedUpdatedDone=$.noop,this.onDirtyData=$.noop,this.onNotDirtyData=$.noop,this.onPagination=$.noop,this.onPivotPaging=$.noop,this.onViewport=$.noop,this.onExeption=$.noop,this.listenTo(c,"stream:error",this._onStreamError),this.listenTo(c,"stream:message",this._onMessage),this.listenTo(c,"stream:TIME_LINE",this._onTimeLine),this.listenTo(c,"stream:START_FROM_TIME_DONE",this._onStartFromTimeDone),this.listenTo(c,"stream:START_VIS_DONE",this._onStartVisDone),this.listenTo(c,"stream:STOP_VIS_DONE",this._onStopVisDone),this.listenTo(c,"stream:NO_DATA_FOUND",this._onNoDataFound),this.listenTo(c,"stream:PAUSE_DONE",this._onPauseDone),this.listenTo(c,"stream:UPDATE_SPEED_DONE",this._onSpeedUpdatedDone),this.listenTo(c,"stream:DIRTY_DATA",this._onDirtyData),this.listenTo(c,"stream:NOT_DIRTY_DATA",this._onNotDirtyData),this.listenTo(c,"stream:PAGINATION",this._onPagination),this.listenTo(c,"stream:PAGING",this._onPivotPaging),this.listenTo(c,"stream:VIEWPORT",this._onViewport),this.listenTo(c,"stream:EXCEPTION",this._onExeption)};_.extend(d.prototype,b.MVC.Events,{tuneTo:function(a){if(this.stopListening(this.time),a.state)this.state=a.state,this.time=this.state.time;else{if(!a.config)throw new Error("state or config must be defined");this.state=new b.Models.State({streamSourceId:config.source.sourceId},{config:new b.MVC.Model(config)}),this.time=this.state.time}this.state.config.options={},this.listenTo(this.time,"change:time",this._onTimeChange),this.listenTo(this.time,"change:speed",this._onSpeedChange),this.listenTo(this.time,"change:paused",this._onPausedChange)},resetProgress:function(){this.progress(0)},progress:function(a){function b(a){return d._progress=a,d}function c(){return d._progress}var d=this;return"undefined"==typeof a?c():b(a)},destroy:function(){this.stop(),this.stopListening()},setUUID:function(){return this.UUID=b.Utilities.generateUUID(),this.UUID},getUUID:function(){return this.UUID},status:function(a){return"string"==typeof a?(this._status=a,this.trigger("status:change",a,this),this):this._status},start:function(a){var c=this.state.toRequest(a),d=JSON.stringify({type:"START_VIS",cid:this.UUID,request:c});"idle"!==this.status()?this.stop():null,console.log("Thread: start ",JSON.parse(d)),this.dataStream.send(d),this.resetProgress(),this.status("start"),this.trigger("thread:start",JSON.parse(d)),b.eventDispatcher.trigger("thread:start",JSON.parse(d))},stop:function(){var a=JSON.stringify({type:"STOP_VIS",cid:this.UUID});this.dataStream.send(a),this.resetProgress(),this.trigger("thread:stop",JSON.parse(a)),console.log("Thread: stop",JSON.parse(a)),this.status("idle")},pause:function(){var a=JSON.stringify({type:"PAUSE",cid:this.UUID});this.dataStream.send(a),console.log("Thread: pause",JSON.parse(a))},unpause:function(){var a=JSON.stringify({type:"UNPAUSE",cid:this.UUID});this.dataStream.send(a),console.log("Thread: unpause",JSON.parse(a))},request_data:function(a){var a=a||{records:1e3},b=JSON.stringify({type:"REQUEST_DATA",cid:this.UUID,request:a});this.dataStream.send(b),console.log("Thread: request_data",JSON.parse(b))},togglePause:function(){var a=this.time.get("paused");a?this.unpause():this.pause()},startFromTime:function(a){var c,d,e=(new Date).getTime(),f=this.time;a>e&&"LIVE"===this.config.get("source").startFrom&&(a=null),c={speed:f.get("speed"),time:a,pauseAfterRead:f.get("paused")},d={type:"START_FROM_TIME",cid:this.UUID,request:c},console.log("Thread: startFromTime",d),this.dataStream.send(JSON.stringify(d)),this.resetProgress(),this.trigger("thread:time",d),b.eventDispatcher.trigger("thread:time",d)},startFromTimeTo:function(a){var b=(new Date).getTime(),c=this.time,d={},e=c.get("time");a>b&&(a=null),d={speed:c.get("speed"),timeWindow:a,pauseAfterRead:c.get("paused")},e&&null!==e&&(d.time=e);var f={type:"START_FROM_TIME",cid:this.UUID,request:d};this.dataStream.send(JSON.stringify(f)),this.resetProgress()},updateSpeed:function(a){var b=JSON.stringify({type:"UPDATE_SPEED",cid:this.UUID,request:{speed:a|this.time.get("speed")}});this.dataStream.send(b),console.log("Thread: updateSpeed",b)},_onTimeChange:function(a,b){this.startFromTime(b)},_onSpeedChange:function(a,b){this.updateSpeed(b)},_onPausedChange:function(a,b){b?this.pause():this.unpause()},_onStreamError:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&(this.status("error"),"function"==typeof this.onStreamError?this.onStreamError(b.data):null,this.trigger("thread:error",a))},_onDirtyData:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&(this.status("dirtydata"),"function"==typeof this.onDirtyData?this.onDirtyData(b.data):null,"number"==typeof b.progress?this.progress(b.progress):this.resetProgress(),this.trigger("thread:dirtyData",b))},_onNotDirtyData:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&(this.status("running"),"function"==typeof this.onNotDirtyData?this.onNotDirtyData(b.data):null,this.progress(100),this.trigger("thread:notDirtyData",b))},_onMessage:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&(this.status("progress"),"function"==typeof this.onMessage?this.onMessage(b.data):null,this.trigger("thread:message",b.data))},_onTimeLine:function(a){var b=JSON.parse(a.data);if(b.cid==this.UUID){if("HISTORICAL"===b.source)return void this.time.set({historicalFrom:b.fromTime,historicalTo:b.toTime});this.stopListening(this.time,"change:time",this._onTimeChange);var c={fromTime:b.fromTime,time:b.toTime,min:b.minTime&&"-1"!==b.minTime?b.minTime:void 0,max:b.maxTime&&"-1"!==b.maxTime?b.maxTime:void 0,live:b.live,speed:b.speed};this.time.set(c),this.listenTo(this.time,"change:time",this._onTimeChange),this.status("progress"),"function"==typeof this.onTimeLine?this.onTimeLine(b.data):null,this.trigger("thread:timeline",b.data)}},_onStartFromTimeDone:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&(this.status("progress"),"function"==typeof this.onStartFromTimeDone?this.onStartFromTimeDone(b.data):null,this.trigger("thread:startFromTimeDone",b.data))},_onStartVisDone:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&(this.status("progress"),"function"==typeof this.onStartVisDone?this.onStartVisDone(b.data):null,this.trigger("thread:startVisDone",b.data))},_onStopVisDone:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&("function"==typeof this.onStopVisDone?this.onStopVisDone(b.data):null,this.trigger("thread:stopVisDone",b.data))},_onNoDataFound:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&(this.status("nodata"),"function"==typeof this.onNoDataFound?this.onNoDataFound(b.data):null,this.trigger("thread:noData",b.data))},_onPauseDone:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&(this.time.set("paused",!0),"function"==typeof this.onPauseDone?this.onPauseDone(b):null,this.trigger("thread:pauseDone",b))},_onSpeedUpdatedDone:function(a){var b=JSON.parse(a.data);b.cid==this.UUID&&("function"==typeof this.onSpeedUpdatedDone?this.onSpeedUpdatedDone(b.data):null,this.trigger("thread:updateSpeedDone",b.data))},_onPagination:function(a){var b=JSON.parse(a.data);b.cid===this.UUID&&(this.state.set("nextPageAvailable",b.nextPageAvailable,{silent:!0}),this.state.set("pages",b.pages,{silent:!0}),this.state.set("precise",b.precise,{silent:!0}),this.state.trigger("pages"),"function"==typeof this.onPagination?this.onPagination(b):null,this.trigger("thread:pagination",b))},_onPivotPaging:function(a){var b=JSON.parse(a.data);b.cid===this.UUID&&(this.state.pagesCount=b.pagesCount,this.state.precise=b.precise,this.state.set("pageIndex",b.pageIndex,{silent:!0}),"function"==typeof this.onPivotPaging?this.onPivotPaging(b):null,this.trigger("thread:pivotPaging",b))},_onViewport:function(a){var b=JSON.parse(a.data);b.cid===this.UUID&&("function"==typeof this.onViewport?this.onViewport(b):null,this.trigger("thread:viewport",b))},_onExeption:function(a){var b=JSON.parse(a.data);this.trigger("thread:exeption",b)}})}(window,Zoomdata),function(a,b){var c=_.clone(b.MVC.Events),d=["TRENDS","MULTI_METRIC_TREND"],e="PIVOT_TABLE";b.Components=b.Components||{},b.Components.StateInheritanceManager=function(a){if(a||(a={}),this.options=$.extend({},this.defaults,a),!this.options.controller)throw new Error("Controller must be defined");this.controller=this.options.controller,delete this.options.controller,this.history=[],this.addToHistory(this.controller.state,this.controller.config)},b.Components.StateInheritanceManager.prototype=_.extend({defaults:{},merge:function(a){var b=this.controller.config,c=(this.controller.state,a.oldConfig),d=a.oldState;return this.addToHistory(d,c),this.mergeTime(d,c),this.mergeFilters(d,c),this.isType(b,e)?(this.mergeToPivot(d,c),this):this.isType(c,e)?(this.mergeFromPivot(d,c),this):(this.mergeMetrics(d,c),this.mergeGroupBy(d,c),this.mergeClientSort(d),this)},mergeFilters:function(a){var b=(this.controller.config,this.controller.state);return a.filters.length>0&&b.filters.set(a.filters.toJSON(),{silent:!0}),this},mergeToPivot:function(a,b){var c,e,f,g=this.controller.config,h=this.controller.state,i="Columns"===g.attributes.source.variables["Metric Direction"],j={};i?(c="Column Attributes",e="Row Attributes"):(c="Row Attributes",e="Column Attributes"),f=a.metrics.toJSON().filter(function(a){var b=a.name,c=a.func,d=b+c,e=!1;return"none"===b&&(e=!0),j[d]===!0&&(e=!0),e?!1:(j[d]=!0,!0)}).map(function(a,b){return{name:a.name,func:a.func,label:"Metrics",id:"Metrics-"+b}}),h.metrics.reset(f,{silent:!0});var k=this.getOriginalType(b);return _.contains(d,k)||0===a.groupBy.length?this:(a.groupBy.length>0&&(g.attributes.source.variables[e]=[a.groupBy.getAttribute()],g.attributes.source.variables[c]=a.groupBy.getAttributes().slice(1)),this)},mergeFromPivot:function(a,c){var d,e,f=(this.controller.config,this.controller.state,"Columns"===c.attributes.source.variables["Metric Direction"]);f?(d="Column Attributes",e="Row Attributes"):(d="Row Attributes",e="Column Attributes"),this.mergeMetrics(a,c);var g=new b.Collections.GroupBy(c.attributes.source.variables[e].concat(c.attributes.source.variables[d]).map(function(a){return{name:a}}));this.mergeGroupBy(a,c,g)},mergeTime:function(a,b){var c=this.controller.config,e=this.controller.state,f=this.getOriginalType(b),g=this.getOriginalType(c);return f!==g&&(_.contains(d,g)||_.contains(d,f))?this:(e.time&&a.time&&e.time.get("timeWindow")===a.time.get("timeWindow")&&e.time.set(a.time.toJSON(),{silent:!0}),this)},mergeClientSort:function(a){var b=this.controller.state;return b.set({clientSort:a.get("clientSort")},{silent:!0}),this},mergeGroupBy:function(a,b,c){var e=this.controller.config,f=this.controller.state;c&&(a.groupBy=c);var g=a.groupBy.models,h=f.groupBy.models,i=a.groupBy.toJSON(),j=f.groupBy.toJSON(),k=this.getOriginalType(b),l=this.getOriginalType(e);if(k!==l&&(_.contains(d,l)||_.contains(d,k)))return this;if(j.length>i.length){var m=a.groupBy.getAttributes(),n=f.groupBy.getAttributes(),o=(j.slice(i.length),n.slice(i.length)),p=_.difference(n,m);i.forEach(function(a,b){var c=h[b];c.setAttribute(a.name,{silent:!0}),c.setSort(a.sort,{silent:!0})});var q=0;_.intersection(o,m).length>0&&o.forEach(function(a,b){var c=b+i.length;if(_.contains(m,a)){var d=h[c],e=_.findWhere(j,{name:p[q]});e&&(d.setAttribute(e.name,{silent:!0}),d.setSort(e.sort,{silent:!0})),q++
}})}else h.forEach(function(a,b){var c=g[b];if(c){var d=c.toJSON();a.setAttribute(d.name,{silent:!0}),a.setSort(d.sort,{silent:!0})}});return this},mergeMetrics:function(a){function b(a,b){var c=[];return c=b?a.metrics.models.filter(function(a){return a.get("label")!==b.name}):a.metrics.models}function c(a){return _.findWhere(a.config.attributes.variables,{metricType:"color"})}var d=this.controller.state;if(0!==d.metrics.length&&0!==a.metrics.length){var e=c(d),f=c(a),g=b(d,e),h=b(a,f);if(g.forEach(function(a,b){var c,d,e=h[b];e&&(c=e.get("name"),d="count"===c?null:e.get("func"),"none"!==c&&a.set({name:c,func:d},{silent:!0}))}),e&&f){var i=d.metrics.findWhere({id:e.name}),j=a.metrics.findWhere({id:f.name}),k=j.get("name"),l="count"===k?null:j.get("func");"none"!==k&&i.set({name:k,func:l},{silent:!0})}return this}},addToHistory:function(a,b){return this.history.push({state:a,config:b}),this},getPrev:function(){var a=this.history.pop();return a},getOriginalType:function(a){var b=a.get("type");return b="CUSTOM"===b?a.get("templateType"):b},isType:function(a,b){var c=Array.isArray(b)?b:[b],d=!1,e=this.getOriginalType(a);return _.contains(c,e)&&(d=!0),d}},c)}(window,Zoomdata),function(a,b){"use strict";b.Components=b.Components||{};var c=b.Collections.ComponentSources,d=b.Collections.LibrariesSources,e=b.Views.AxisLabel,f=b.Views.ColorKey,g=b.eventDispatcher,h=b.Components.Thread,i=b.Components.InteractiveElementsMethods,j=b.Components.MetricAccessor,k=b.Components.StateInheritanceManager,l="$Source";b.Components.VisualizationController=b.MVC.View.extend({defaults:{},remove:function(){this.stopVisualization(),this.removeVisualization(),b.MVC.View.prototype.remove.apply(this,arguments)},initialize:function(a){var e;if(this.dfd=null,this.axisLabels=[],this.metrics={},this.progress=0,this.data=[],"undefined"==typeof a.interactiveElements)throw new Error("interactiveElements must be defined");if(this.elementsManager=a.interactiveElements,delete a.interactiveElements,"object"!=typeof a.config)throw new Error("config must be defined");if(this.config=a.config,delete a.config,"object"!=typeof a.source)throw new Error("source must be defined");this.source=a.source,delete a.source,e=this.source,this.isRemote="object"==typeof a.host?!0:!1,this.worker=window.Worker&&this.isRemote===!1?new Worker("/zoomdata/js/components/Zoomdata.Workers.ProcessSocketData.js"):null,this._assemblyMethods(),b.MVC.View.prototype.initialize.apply(this,arguments),this.state=new b.Models.State({streamSourceId:this.config.get("source").sourceId},{config:this.config,objectFields:this.source.objectFields}),this.thread=new h({state:this.state,dataStream:b.dataStream}),this.fields=e.objectFields,this.formulas=e.formulaList,this._configureMetricAccessors(),this.time=this.state.time,this.$el.attr("data-visid",this.config.get("visId")).removeAttr("id"),this.components=new c(this.config.get("components"),{visId:this.config.get("visId"),name:this.config.get("name"),remote:this.isRemote&&this.options.host.remote,secure:this.isRemote&&this.options.host.secure,apiKey:this.isRemote&&this.options.host.apiKey}),this.libraries=new d(this.config.get("libs"),{remote:this.isRemote&&this.options.host.remote,secure:this.isRemote&&this.options.host.secure,apiKey:this.isRemote&&this.options.host.apiKey}),this.inheritanceManager=new k({controller:this}),this.resetIndicators()},_configureMetricAccessors:function(){var a,b,c,d=this,e=d.config.get("variables"),f=[],g=this.metrics={},h=this.fields;$(e).each(function(e,g){if("metric"===g.type||"multi-metric"===g.type)switch(g.metricType){case"color":a=g,d.autoShowColorLegend=g.autoShowColorLegend,"string"==typeof g.colors&&(g.colors=JSON.parse(g.colors)),g.savedColors&&"string"==typeof g.savedColors&&(g.savedColors=JSON.parse(g.savedColors)),c=g.colors?g.colors.length:0,g.colors&&$.each(g.colors,function(b,c){f.push(a.savedColors&&"string"==typeof a.savedColors[b]?a.savedColors[b]:c.color||c)});break;case"general":b=g}}),this.state.divergingColorRange="gradient",this.state.metrics.each(function(i){var k,l=i.get("name"),m=i.get("label"),n=_.where(e,{name:m})[0],o=n?n.type:"metric",p=i.isNone()?h.noneField:i.isCount()?h.volumeField:h.findWhere({name:l});"multi-metric"==o?g[m]instanceof Array?g[m].push(new j(i.toJSON(),p.toJSON())):g[m]=[new j(i.toJSON(),p.toJSON())]:g[m]=new j(i.toJSON(),p.toJSON()),a&&m===a.name?(d.state.colorMetric&&d.state.colorMetric.get("label")===m||(d.state.colorMetric=i),d.state.colorNumb=c,k=d.metrics[a.name][0]||d.metrics[a.name],k.metric.colors&&"string"!=typeof k.metric.colors||(d.state.legendType=a.legendType||"range",d.state.divergingColorRange=a.divergingColorRange||"gradient",k.setColorRangeType(d.state.divergingColorRange),k.metric.colors=f,k.domainValue=a.domain),d.metrics[a.name][0]&&(d.state.divergingColorRange=null,k.objectFields=[],d.source.objectFields.forEach(function(b){var c=b.get("type");("FORMULA"===c||-1!==a.attributeType.indexOf(c))&&k.objectFields.push(b),k.objectFields.length>k.metric.colors&&k.metric.colors.push("#ffffff")}),k.metric.colors.splice(k.objectFields.length,k.metric.colors.length),d.state.colorNumb=k.metric.colors.length),k.metric.colorsData=a.colors):b&&m===b.name&&(d.state.generalMetric=i)}),this._controller&&(this._controller.metrics=this.metrics)},_onGroupByChange:function(){this.clearVisualization(),this.restartVisualization()},_onMetricChange:function(a){function b(a,b){var c=_.find(a,function(a){var c=a.metric.name==("undefined"!=typeof b.changed.name?b.previous("name"):b.get("name"))&&a.metric.func==("undefined"!=typeof b.changed.func?b.previous("func"):b.get("func"));return c});c.setAccessTo(b.toJSON(),f.toJSON())}var c=a.get("label"),d=a.get("name"),e=this.metrics[c],f=a.isNone()?this.fields.noneField:a.isCount()?this.fields.volumeField:this.fields.findWhere({name:d});e instanceof Array?b(e,a):e.setAccessTo(a.toJSON(),f.toJSON()),this.restartVisualization()},_onMetricReset:function(){this.restartVisualization()},_onMetricAdd:function(a){var b=a.get("label"),c=a.get("name"),d=this.metrics[b],e=a.isCount()?this.fields.volumeField:this.fields.findWhere({name:c});d instanceof Array?null:d=[].concat(d),d.push(new j(a.toJSON(),e.toJSON())),this.restartVisualization()},_onMetricRemove:function(a){var b=a.get("label"),c=a.get("func"),d=a.get("name"),e=this.metrics[b]instanceof Array?this.metrics[b]:[].concat(this.metrics[b]),f=_.find(e,function(a){return a.metric.name==d&&a.metric.func==c});f&&e.splice(e.indexOf(f),1),this.restartVisualization()},_onMessage:function(a){"function"==typeof this._controller.processData?this._controller.processData(a,this.thread.progress()):this.processSocketData(a)},_onNoDataFound:function(){this.clearVisualization(),this._controller.onNoDataFound()},_onStartFromTimeDone:function(){this.data=[]},_assemblyMethods:function(){_.extend(this,new i)},_createAxisLabel:function(a){if(this.isRemote)return null;var b=new e($.extend({},a,{controller:this})),c=b.render().$el,d=$(this.el.parentElement),f=$(this.el);switch(a.position){case"left":var g=d.find(".widgetLabel.left").eq(0);g&&0!==g.length||(g=$('<div class="widgetLabel left"/>'),d.prepend(g)),f.css({left:"50px"}),g.append(c);break;case"right":var h=d.find(".widgetLabel.right").eq(0);h&&0!==h.length||(h=$('<div class="widgetLabel right"/>'),d.prepend(h)),f.css({right:"50px"}),h.append(c);break;case"top":var i=d.find(".widgetLabel.top").eq(0);i&&0!==i.length||(i=$('<div class="widgetLabel top"/>'),d.prepend(i)),f.css({top:"50px"}),i.append(c);break;case"bottom":var j=d.find(".widgetLabel.bottom").eq(0);j&&0!==j.length||(j=$('<div class="widgetLabel bottom"/>'),d.prepend(j)),f.css({bottom:"50px"}),j.append(c)}return b.position(),c.hide().show(0),this.axisLabels.push(b),c},resetIndicators:function(){},setVisualization:function(a,c,d){var e=this,f=this.state,g=c&&d?d:new b.Models.State({streamSourceId:a.get("source").sourceId},{config:a,objectFields:this.source.objectFields,oldTimeWindowScale:this.state.time.get("timeWindow")}),h=this.config;a&&(this.config=a,this.config.sourceId=h.sourceId),this.stopVisualization(),this.removeVisualization(),this.state=g,this.thread.tuneTo({state:this.state,config:this.config}),this.time=this.state.time,this.$el.attr("data-visid",this.config.get("visId")).removeAttr("id"),this.libraries.reset(this.config.get("libs")),this.components.reset(this.config.get("components")),this.components.setVisId(this.config.get("visId")),this.components.setVisName(this.config.get("name")),c||this.inheritanceManager.merge({oldState:f,oldConfig:h}),this._configureMetricAccessors(),this.loadVisualization().done(function(){e.initVisualization(),e.startVisualization()}),this.trigger("visualization:change")},applyEvents:function(){var a=this;this.listenTo(g,"visualization:showpopup",a.showPopup),this.listenTo(this.thread,"thread:message",this._onMessage),this.listenTo(this.thread,"thread:start",this._onStart),this.listenTo(this.thread,"thread:error",this._onStreamError),this.listenTo(this.thread,"thread:notDirtyData",this._onNotDirtyData),this.listenTo(this.thread,"thread:noData",this._onNoDataFound),this.listenTo(this.thread,"thread:startFromTimeDone",this._onStartFromTimeDone),this.listenTo(this.thread,"thread:viewport",this._onViewport),this.listenTo(this.thread,"thread:stop",this._onStop),this.listenTo(this.thread,"thread:exeption",this._onExeption),this.listenTo(this.state,"change",this.restartVisualization),this.listenTo(this.state,"change:clientSort",this.refreshVisualization),this.listenTo(this.state.filters,"add remove change reset",this.restartVisualization),this.listenTo(this.state.metrics,"change",this._onMetricChange),this.listenTo(this.state.metrics,"add",this._onMetricAdd),this.listenTo(this.state.metrics,"remove",this._onMetricRemove),this.listenTo(this.state.metrics,"reset",this._onMetricReset),this.listenTo(this.state.groupBy,"change reset",this._onGroupByChange),this.listenTo(b.eventDispatcher,"restart",function(){a.startVisualization()}),this.on("resize",this._onResize)},muteEvents:function(){this.stopListening(g,"visualization:showpopup",this.showPopup),this.stopListening(this.thread,"thread:message",this._onMessage),this.stopListening(this.thread,"thread:start",this._onStart),this.stopListening(this.thread,"thread:error",this._onStreamError),this.stopListening(this.thread,"thread:notDirtyData",this._onNotDirtyData),this.stopListening(this.thread,"thread:noData",this._onNoDataFound),this.stopListening(this.thread,"thread:startFromTimeDone",this._onStartFromTimeDone),this.stopListening(this.thread,"thread:viewport",this._onViewport),this.stopListening(this.thread,"thread:stop",this._onStop),this.stopListening(this.thread,"thread:exeption",this._onExeption),this.stopListening(this.state,"change",this.restartVisualization),this.stopListening(this.state,"change:clientSort",this.refreshVisualization),this.stopListening(this.state.filters,"add remove change reset",this.restartVisualization),this.stopListening(this.state.metrics,"change",this._onMetricChange),this.stopListening(this.state.metrics,"add",this._onMetricAdd),this.stopListening(this.state.metrics,"remove",this._onMetricRemove),this.stopListening(this.state.metrics,"reset",this._onMetricReset),this.stopListening(this.state.groupBy,"change reset",this._onGroupByChange),this.off("resize",this._onResize),this._controller&&($(this._controller.element).off("resize"),this._controller.element.resize=null)},initVisualization:function(){var a=this,c=this.components.getComponentsNamespace(),d=b.Utilities.MODE.WIDGET===b.Utilities.mode();this._controller&&this._controller.toolbar().remove(),this.axisLabels=[],this._controller={element:this.el,state:this.getVisualizationState(),config:this.getSourceConfiguration(),scope:{},labels:this.axisLabels,metrics:this.metrics,fields:this.fields,onAdd:$.noop,onRemove:$.noop,onChange:$.noop,update:$.noop,onNoDataFound:$.noop,resize:$.noop,onStreamError:$.noop,onViewport:$.noop,onExeption:$.noop,onNotDirtyData:$.noop,onStart:$.noop,onStop:$.noop,registerInteractiveElements:function(b,c,d,e){a.registerInteractiveElements(b,c,d,e)},releaseInteractiveElement:function(b,c){a.releaseInteractiveElement(b,c)},registered:function(b){return a.elementsManager.registered(b)},requestData:function(){return a.thread.request_data.bind(a.thread)},customReadyStatusDelay:!1,setVisualization:function(b,c){a.setVisualization(b,c)},createAxisLabel:function(b){var c=a.state.config.get("variables"),d=c.filter(function(a){return a.name===b.picks})[0];return!d||"multi-group"!==d.type&&"group"!==d.type?a._createAxisLabel(b):a.state.groupBy.map(function(c,d){var e;return b.popoverTitle?(e=b.popoverTitle,a.state.groupBy.length>1&&(e+=" "+(d+1))):e=c.getLabel()||"Group "+(d+1),a._createAxisLabel($.extend({},b,{picks:c,popoverTitle:e}))})},toolbar:function(){var c=a._controller.toolbar;if(!c.$_toolbar){c.$_toolbar=$('                            <div class="zd-visualization-toolbar navbar">                                 <div class="navbar-inner">                                      <div class="container">                                         <ul class="nav pull-left"/>                                          <ul class="nav pull-right"/>                                     </div>                                  </div>                            </div>').prependTo($(a._controller.element).parent());var e=function(){return c.$_toolbar.find(".nav.pull-left")},f=function(){return c.$_toolbar.find(".nav.pull-right")};c.append=function(g,h){if(g.item&&void 0!==g.item.availableForMode&&"function"==typeof g.item.availableForMode){var i=g.item.availableForMode(b.Utilities.mode());if(!i)return}var j=g.side||g.item&&g.item.side||"left",k=g.el||g.item&&g.item.render().el;if(!k){var l=new b.VisualizationControls.ToolbarItem(g);k=l.render().el}"left"===j?h?e().prepend(k):e().append(k):h?f().prepend(k):f().append(k),g.item&&g.name&&(c._items||(c._items={}),c._items[g.name]=g.item);var m=a.$el.parent().find(".zd-visualization-toolbar");return d&&"list"!==g.item.icon?$(k).remove():m.length>0?$(a._controller.element).css({height:"87%"}):$(a._controller.element).css("height","calc(100% - 42px)"),c},c.get=function(a){return c._items&&c._items[a]||null},c.remove=function(){c._items=null,c.$_toolbar.remove(),c.$_toolbar=null}}return c}},$.each(this.metrics,function(b,c){return c.colorMetric?(a._controller.colorMetric=c,!1):void 0});var e=_.filter(this.config.get("controls"),function(a){return a.indexOf("ToolbarItem")>=0?a:null});if(e.length>0){var f=[];e.forEach(function(c){if(b.VisualizationToolbar[c]){var d=new b.VisualizationToolbar[c]({controller:a._controller});d.name=c,f.push(d)}}),f=_.sortBy(f,function(a){return a.order||Number.MAX_VALUE}),f.forEach(function(b){a._controller.toolbar().append({item:b,name:b.name})})}this._controller.variables=this.config.get("source").variables,this.components.where({type:"text/javascript"}).forEach(function(d){var e=d.getConstructorName();b.Visualizations[c][e](a._controller,b)}),this._controller.update=this._controller.update||$.noop,this._controller.onAdd=this._controller.onAdd||$.noop,this._controller.onRemove=this._controller.onRemove||$.noop,this._controller.onChange=this._controller.onChange||$.noop,this._controller.clear=this._controller.clear||$.noop,this._controller.resize=this._controller.resize||$.noop,this._controller.onStreamError=this._controller.onStreamError||$.noop,this._controller.onNotDirtyData=this._controller.onNotDirtyData||$.noop,this._controller.onStart=this._controller.onStart||$.noop,this._controller.onViewport=this._controller.onViewport||$.noop,this._controller.onExeption=this._controller.onExeption||$.noop;var g=this.config.get("type");d&&"PIVOT_TABLE"!==g&&this._controller.toolbar().remove(),this.initColorKey(),this.applyEvents()},removeVisualization:function(){var a=this.config.get("visId"),b={},c=$("script"),d=this.$el.parents(".widgetBody, .fullScreenContainer").eq(0);this.$el.appendTo(d),this.components.each(function(d){if("text/javascript"===d.get("type")){var e=d.get("id");c.each(function(c,d){d.getAttribute("src")&&d.getAttribute("src").indexOf(a)>-1&&d.getAttribute("src").indexOf(e)>-1&&(b[e]=$(d))})}}),d.children().not(".widgetContent").remove(),d.removeAttr("id"),this.clearVisualization(!0),this.data=[],this._controller&&($(this._controller.element).children().not(".zd-legend").remove(),this._controller.labels.length>0&&this._controller.labels.forEach(function(a){a.remove(),a=null})),this.$el.removeAttr("style data-visid"),this.muteEvents(),this.trigger("visualization:removed");for(var e in b)b.hasOwnProperty(e)&&b[e].remove()},initColorKey:function(){this.colorKey=new f({el:this.$el.find(".zd-legend"),controller:this,isDraggable:!0,autoShow:this.autoShowColorLegend})},loadVisualization:function(){var a=this,c=this.components.getComponentsNamespace();return this.dfd=$.Deferred(),b.Visualizations instanceof Array?(a.trigger("visualization:loaded"),this.dfd.resolve()):(b.Visualizations[c]||(b.Visualizations[c]={}),this.trigger("visualization:loading"),this.$el.attr("data-visid",this.config.get("visId")).removeAttr("id"),this.libraries.load().done(function(){a.components.load().done(function(){a.trigger("visualization:loaded"),a.dfd.resolve()}).fail(function(a){throw a.message})}).fail(function(a){throw a.message})),this.dfd.promise()},setUUID:function(){this.thread.setUUID(),this.UUID=this.thread.getUUID(),this.config.set("id",this.UUID),this._controller.UUID=this.UUID},applyScope:function(){var a,b=this,c=this._controller.state.config.attributes.components,d=document.styleSheets,e=null,f="uuid_",g=document.createElement("style"),h=b.config.attributes.visId;if(document.body.appendChild(g),a=g.scoped+"",g.parentNode.removeChild(g),a){var i=$('style[data-visid="'+h+'"]');return i.appendTo(b.$el),i.attr("scoped",""),void i.scopedPolyFill()}c.map(function(a){try{if("text/css"===a.type){for(var c=0,g=d.length;g>c;c++){var i=d[c],j=a.id;if(h&&i.ownerNode.attributes["data-visid"]&&h===i.ownerNode.attributes["data-visid"].value&&j&&i.ownerNode.attributes["data-componentid"]&&j===i.ownerNode.attributes["data-componentid"].value&&void 0===i.UUID){e=i;break}}if(e){var k=b._controller.UUID;for(b.$el.attr("id",f+k),c=0,g=e.cssRules.length;g>c;c++){var l=e.cssRules?e.cssRules[c].selectorText.split(","):e.rules[c].selectorText.split(","),m="";if(l.forEach(function(a,b){m+="#"+f+k+" "+a+(b!==l.length-1?",":"")}),e.cssRules){e.cssRules[c].selectorText=m;var n=_.extend({},e.cssRules[c]);e.removeRule?e.removeRule(c):e.deleteRule(c)}else{e.rules[c].selectorText=m;var n=_.extend({},e.rules[c]);e.removeRule?e.removeRule(c):e.deleteRule(c)}e.insertRule?e.insertRule(n.cssText,c):e.addRule(m,n.style.cssText,c)}}}}catch(o){throw console.log("Scoped error",o),o}})},startVisualization:function(){return this.setUUID(),this._controller.delayedStart&&this._controller.delayedStart===!0?void 0:(this.thread.start(),this)},stopVisualization:function(){return this.thread.stop(),this.trigger("visualization:stop",this),g.trigger("visualization:stop",this),this},restartVisualization:function(){this.data=[],this.stopVisualization(),this.startVisualization(!0)},refreshVisualization:function(){var a=this.state.get("clientSort"),b=this.state.metrics.at(0);b&&a&&this.state.config.set("clientSort",a);var c=this.data;"function"==typeof this._controller.processData&&this._controller.processData(c,this.progress),this._updateMetricsDomain(c),this.processSocketData(c,this.progress),this.colorKey.render()},clearVisualization:function(a){a||(this.data=[],this.refreshVisualization()),this._controller?"function"==typeof this._controller.clear?this._controller.clear():null:this.dfd&&this.dfd.reject()},getControlsList:function(){return this.getSourceConfiguration().controls||[]},getSourceConfiguration:function(){return this.config.toJSON()},getVisualizationState:function(){return this.state},updateVisualizationState:function(a){return this.state.set(a),this},processSocketData:function(a){var b=(this.worker,this._controller.state.groupBy.at(0)),c=b&&b.get?b.get("sort").name:"count";if("count"===c&&this.state.metrics.length>0){var d=this.config.get("variables").filter(function(a){return"metric"===a.type&&"color"!==a.metricType})[0],e=d&&d.name?d.name:!1;c=this.metrics&&this.metrics[e]?this.metrics[e].metric.name:"count"}if(a instanceof Array&&a.length>0){var f=[],g={},h={},i=this.data,j=a;if(0===i.length)f=j;else if(0===j.length)f=i;else{i.forEach(function(a){var b=Array.isArray(a.group)?a.group.join():a.group;g[b]=a}),j.forEach(function(a){var b=Array.isArray(a.group)?a.group.join():a.group;h[b]=a});for(var k in h)h.hasOwnProperty(k)&&(-1===h[k].current.count?g[k]&&delete g[k]:g[k]=h[k]);for(var k in g)g.hasOwnProperty(k)&&f.push(g[k])}this.data=this._sortData(f),g=null,h=null}var l=JSON.parse(JSON.stringify(this.data));this._updateMetricsDomain(l),this._controller.update(l,this.thread.progress(),{original_data:a})},_mergeData:function(a,b){function c(a){for(var b in a)if(-1===d.indexOf(a[b].group))d.push(a[b].group),e.push(a[b]);else{var c=_.findWhere(e,{group:a[b].group});c=a[b]}}var d=[],e=[];return c(a),c(b),e=this._sortData(e)},_sortData:function(a){var b=this.state.get("clientSort"),c=[];if(b&&this.state.metrics.size()>0){var d=null,e=this.metrics[this.state.metrics.at(0).get("label")];switch(e instanceof Array?e=e[0]:null,b){case"valueDescending":d=function(a,b){var c=e.raw(b)-e.raw(a);if(0===c){var d=a.group.join?a.group.join(""):a.group,f=b.group.join?b.group.join(""):b.group;return d.localeCompare(f)}return c};break;case"valueAscending":d=function(a,b){var c=e.raw(a)-e.raw(b);if(0===c){var d=a.group.join?a.group.join(""):a.group,f=b.group.join?b.group.join(""):b.group;return f.localeCompare(d)}return c};break;case"alphabetical":d=function(a,b){var c=a.group.join?a.group.join(""):a.group,d=b.group.join?b.group.join(""):b.group;return c.localeCompare(d)};break;case"reverseAlphabetical":d=function(a,b){var c=a.group.join?a.group.join(""):a.group,d=b.group.join?b.group.join(""):b.group;return d.localeCompare(c)};break;default:d=null}c=a.sort(d)}else c=a;return c},_updateMetricsDomain:function(a){function b(d){$.each(d,function(d,e){e instanceof Array?b(e):(e._updateDomain(a,c.state.colorNumb),c.state.colorMetricDomain=e.domain())})}var c=this;b(this.metrics)},_updateMetricsDivergingColorRange:function(a){function b(c){$.each(c,function(c,d){d instanceof Array?b(d):d.setColorRangeType(a)})}this.state.divergingColorRange=a,b(this.metrics)},calculateBottomMargin:function(a){var b;switch(a){case"large":b=10;break;case"medium":b=40;break;case"small":b=50}return b},_onResize:function(){var a=$(this._controller.element),c=a.parents(".widget, .fullScreenContainer").eq(0),d=c.width(),e=c.height(),f=a.width(),g=a.height(),h=b.Utilities.getWidgetSizeClass(d,e),i=this.$el.parent().find(".zd-visualization-toolbar"),j=0;i.length>0&&(j=this.calculateBottomMargin(h)),a.trigger("resize",[f,g]),f=a.width(),g=a.height()-j,this.colorKey.fixPosition(),this._controller.resize(f,g,h)},_onStreamError:function(a){this._controller.onStreamError(a)},_onStart:function(a){this._controller.onStart(a),this.trigger("visualization:start")},_onNotDirtyData:function(a){this._controller.onNotDirtyData(a)},_onViewport:function(a){this._controller.onViewport(a)},_onExeption:function(a){this._controller.onExeption(a)},_onStop:function(a){this._controller.onStop(a)},startFromTime:function(a,b){this.thread.startFromTime(b)},startFromTimeTo:function(a,b){this.thread.startFromTimeTo(b)},updateSpeed:function(a,b){this.thread.updateSpeed(b)},togglePause:function(a){var b=this.thread;void 0!==a?a?b.unpause():b.pause():this.thread.togglePause()},getRestrictions:function(a){var b=a.restrictions,c=_.map(b,function(a){return{path:a.path,operation:a.operation,value:a.value}});return _.filter(c,function(b){return b.path!=a.tsField})},getDefaultTemplate:function(){return l},getVisualizationName:function(){var a=this.state.metrics,b=a.at(0),c=(b?this.metrics[b.get("label")]:null,this.config.get("source")),d=this.config.get("type"),e=(this.config.get("name"),this.state.groupBy.getAttribute()),f=this.fields.findWhere({name:e}),g=(f?f.get("label"):e,c.sourceName),h=c.variables["Visualization Name"]||this.getDefaultTemplate(d),i=h||g;return h&&(i=i.replace(l,g)),i}})}(window,Zoomdata),function(a,b){function c(a,c,d){var e="/websocket/";return a&&(e=a+e+"?key="+c,e=d?"wss://"+e:"ws://"+e),b.dataStream=b.DataStreamProvider.getStream(e),b.dataStream.publish(b.eventDispatcher),b.dataStream}function d(b){function c(a,b){var c={remote:l.host,secure:l.secure,apiKey:l.apiKey},d=g(a,b,k,c);l.visualizations.push(d),d.controller.loadVisualization().done(function(){d.controller.initVisualization(),d.controller.startVisualization(),m.resolve(d)})}function d(a,b){var c="string"==typeof a?a:null;console.warn(c||b+": "+a.statusText),m.reject(a,b)}function e(a){console.log(a),m.notify(a)}b=b||{};var h,i,j,k,l=this,m=$.Deferred(),n=this.sources;if("string"!=typeof b.visualization||!b.visualization)throw new Error("Invalid visualization name");if(h=b.visualization,"string"!=typeof b.source||!b.source)throw new Error("Invalid source name");if(i=b.source,!(b.element instanceof a.HTMLElement))throw new Error("Invalid element");return k=b.element,j=n.findWhere({name:i}),j?f(h,j).then(c,d,e):(m.notify("Loading Source"),n.fetch({data:{name:i}}).then(function(a){var b,g;a[0]?(b=a[0].id,g=n.get(b),f(h,g).then(c,d,e)):m.reject("source doesn't exist")})),m.promise()}function e(a){a=a||{};var b,c,d,e=$.Deferred();if("string"!=typeof a.visualization||!a.visualization)throw new Error("Invalid visualization name");if(b=a.visualization,"string"!=typeof a.source||!a.source)throw new Error("Invalid source name");return c=a.source,d=_.where(this.visualizations,{name:b,source:c})[0],d?(e.notify("Closing visualization "+b),d.controller.remove(),d.controller.elementsManager.destroy(),$(d.root).remove(),this.visualizations.splice(this.visualizations.indexOf(d),1),e.resolve()):e.reject("Visualization doesn't exist"),e.promise()}function f(a,b){var c=b.visualizations.findWhere({name:a}),d=$.Deferred();return c?(d.notify("fetching visualization config for "+a),c.fetch().done(function(){d.resolve(c,b)}).fail(function(a,b){d.reject(a,b)})):(d.notify("fetching visualizations for "+b.get("name")),b.visualizations.fetch().done(function(){var c=b.visualizations.findWhere({name:a});c?(d.notify("fetching visualization config for "+a),c.fetch().done(function(){d.resolve(c,b)}).fail(function(a,b){d.reject(a,b)})):d.reject("visualization doesn't exist")}).fail(function(a,b){d.reject(a,b)})),d}function g(a,b,c,d){var e=$('<div style="position: relative; height: 100%;"></div>').appendTo(c),f=$('<div class="widgetContent" style="position: relative; height: 100%;"></div>').append('<div class="zd-legend" style="display: none;"></div>').appendTo(e)[0],g=new k,h=new j({config:a,source:b,interactiveElements:g,el:f,host:d}),i={name:a.get("name"),source:b.get("name"),root:e[0],controller:h};return console.log(i),i}b.Components=b.Components||{};var h={secureHost:!1},i=b.Collections.Sources,j=b.Components.VisualizationController,k=b.Components.InteractiveElementsManager,l=function(a){if(this.visualizations=[],"undefined"==typeof a.apiKey)throw new Error("An apiKey must be defined");if(this.apiKey=a.apiKey,this.secure="undefined"!=typeof a.secure?a.secure:h.secure,"undefined"==typeof a.host)throw new Error("An url must be defined");this.host=a.host,this.sources=new i([],{secure:this.secure,remote:this.host,apiKey:this.apiKey}),this.stream=c(this.host,this.apiKey,this.secure)};l.prototype={visualize:d,stop:e},b.Components.StandaloneClient=l,a.ZoomdataClient=l}(window,Zoomdata);